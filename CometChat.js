!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var s in n)("object"==typeof exports?exports:e)[s]=n[s]}}(window,function(){return function(n){var s={};function r(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=43)}([function(e,t,n){"use strict";t.__esModule=!0;var s,r,o,i=n(2);t.constants={DEFAULT_STORE:"cometchat",MSG_VER_PRE:"store-ver-pre",MSG_VER_POST:"store-ver-post"},t.DEFAULT_VALUES={ZERO:0,MSGS_LIMIT:30,MSGS_MAX_LIMIT:100,USERS_LIMIT:30,USERS_MAX_LIMIT:100,GROUPS_LIMIT:30,GROUPS_MAX_LIMIT:100,CONVERSATION_MAX_LIMIT:50,CALL_TIMEOUT:45,DEFAULT_MSG_ID:0,DEFAULT_MAX_TYPING_INDICATOR_LIMIT:5,REGION_DEFAULT:"eu",REGION_DEFAULT_EU:"eu",REGION_DEFAULT_US:"us",REGION_DEFAULT_IN:"in",REGION_DEFAULT_PRIVATE:"private"},t.CALLING_COMPONENT_VERSION=4,(s=t.GroupType||(t.GroupType={})).Public="public",s.Private="private",s.Protected="protected",s.Password="password",t.GROUP_TYPE={PUBLIC:"public",PRIVATE:"private",PROTECTED:"password",PASSWORD:"password"},(r=t.GroupMemberScope||(t.GroupMemberScope={})).Admin="admin",r.Moderator="moderator",r.Member="member",t.GROUP_MEMBER_SCOPE={ADMIN:"admin",MODERATOR:"moderator",PARTICIPANT:"participant"},t.APPINFO={platform:"WEB",sdkVersion:"v2.4.1-beta1",apiVersion:"v2.0",sdkVersionWithUnderScore:"2_4_1_beta1"},t.SDKHeader={platform:"javascript",sdkVersion:"2.4.1-beta1",sdk:"%s@%s"},t.XMPP={host:"encke.cometchat.com",port:7443,ws_url:"/ws/",bind_url:"/http-bind/",deafult_password:"CometChat",PUBSUB_CHANNEL:"pubsub",jid_string:"[%s]%s@%s/%s",bare_jid_string:"[%s]%s@%s",username_string:"[%s]%s",muc_jid_string:"[%s]%s@%s.%s",pubsub_global_string:"[%s]global_presence",pubsub_default_string:"[%s]default",pubsub_role_string:"[%s]%s",xmpp_resource:"javascripts_"+(new Date).getTime(),CONVERSATION:{TYPE:{CHAT:"chat",GROUP_CHAT:"groupchat"}}},t.ANALYTICS={analyticsHost:"metrics-%s.cometchat.io",analyticsVersion:"v1"},t.LOCAL_STORE={COMMON_STORE:"common_store",MESSAGE_LISTENERS_LIST:"message_listeners_list",USERS_STORE:"users_store",MESSAGES_STORE:"messages_store",KEYS_STORE:"keys_store",STORE_STRING:"%s:%s"},t.ResponseConstants={RESPONSE_KEYS:{KEY_DATA:"data",KEY_META:"meta",KEY_CURSOR:"cursor",KEY_ACTION:"action",KEY_MESSAGE:"message",KEY_ERROR:"error",KEY_ERROR_DETAILS:"details",KEY_ERROR_CODE:"code",KEY_ERROR_MESSAGE:"message",KEY_AUTH_TOKEN:"authToken",KEY_WS_CHANNEL:"wsChannel",KEY_IDENTITY:"identity",KEY_SERVICE:"identity",KEY_ENTITIES:"entities",KEY_ENTITITY:"entity",KEY_ENTITYTYPE:"entityType",KEY_ATTACHMENTS:"attachments",CODE_REQUEST_OK:200,CODE_BAD_REQUEST:401,UNREAD_UNDELIVERED_KEYS:{ENTITY:"entity",ENTITY_TYPE:"entityType",ENTITY_Id:"entityId",COUNT:"count"},GROUP_MEMBERS_RESPONSE:{SUCCESS:"success",ERROR:"error",MESSAGE:"message"},KEY_ENTITY_TYPE:{USER:"user",GROUP:"group"}}},t.DELIVERY_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",RECEIVED:"delivered",DELIVERED_AT:"deliveredAt",ID:"id",TIME:"time",DELIVERED_TO_ME_AT:"deliveredToMeAt"},t.READ_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",READ:"read",READ_AT:"readAt",ID:"id",TIME:"time",READ_BY_ME_AT:"readByMeAt"},t.MessageConstatnts={XMPP_KEYS:{FROM:"from",TO:"to",TYPE:"type",TYPE_USER:"chat",TYPE_GROUP:"groupchat"},TYPE:{TEXT:"text",MEDIA:"media",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file",CUSTOM:"custom"},CATEGORY:{MESSAGE:"message",ACTION:"action",CALL:"call",CUSTOM:"custom"},RECEIVER_TYPE:{USER:"user",GROUP:"group"},KEYS:{ATTATCHMENT:"attatchment",ATTATCHMENTS:"attachments",ACTION:"action",TYPE:"type",DATA:"data",ID:"id",MUID:"muid",SENDER:"sender",RECEIVER:"receiver",RECEIVER_ID:"receiverId",CATEGORY:"category",RECEIVER_TYPE:"receiverType",SENT_AT:"sentAt",STATUS:"status",TEXT:"text",URL:"url",METADATA:"metadata",RECEIPTS:"receipts",MY_RECEIPTS:"myReceipt",CUSTOM_DATA:"customData",CUSTOM_SUB_TYPE:"subType",RESOURCE:"resource"},KNOWN_MEDIA_TYPE:{IMAGE:[],VIDEO:[],AUDIO:[],FILE:[]},PAGINATION:{AFFIX:{APPEND:"append",PREPEND:"prepend"},CURSOR_FILEDS:{ID:"id",SENT_AT:"sentAt"},CURSOR_AFFIX_DEFAULT:"prepend",CURSOR_FIELD_DEFAULT:"sentAt",KEYS:{PER_PAGE:"per_page",CURSOR_AFFIX:"cursorAffix",AFFIX:"affix",CURSOR_FIELD:"cursorField",CURSOR_VALUE:"cursorValue",UID:"uid",SENT_AT:"sentAt",ID:"id",CURRENT_PAGE:"page",UNREAD:"unread",HIDE_MESSAGES_FROM_BLOCKED_USER:"hideMessagesFromBlockedUsers",SEARCH_KEY:"searchKey",ONLY_UPDATES:"onlyUpdates",UPDATED_AT:"updatedAt",CATEGORY:"category",CATEGORIES:"categories",TYPE:"type",TYPES:"types",HIDE_REPLIES:"hideReplies",HIDE_DELETED_MESSAGES:"hideDeleted"}}},t.ATTACHMENTS_CONSTANTS={KEYS:{EXTENSION:"extension",MIME_TYPE:"mimeType",NAME:"name",SIZE:"size",URL:"url"}},(o=t.MessageCategory||(t.MessageCategory={})).ACTION="action",o.MESSAGE="message",o.CALL="call",o.CUSTOM="custom",t.TYPING_NOTIFICATION={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"receiverType",META:"metadata",KEYS:{TYPING_NOTIFICATION:"typingNotification",TIMESTAMP:"timestamp"},ACTIONS:{STARTED:"started",ENDED:"ended"}},t.ActionConstatnts={ACTION_SUBJECTS:{ACTION_ON:"on",ACTION_BY:"by",ACTION_FOR:"for"},ACTION_ENTITY_TYPE:{GROUP_USER:"groupuser",USER:"user",GROUP:"group",MESSAGE:"message"},ACTION_KEYS:{ACTION_CREATED:"created",ACTION_UPDATED:"updated",ACTION_DELETED:"deleted",ENTITIES:"entities",ENTITY:"entity",ENTITY_TYPE:"entityType",TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_ADDED:"added",ACTION_SCOPE_CHANGED:"scopeChanged",ACTION_TYPE_USER:"user",ACTION_TYPE_GROUP:"group",ACTION_TYPE_GROUP_MEMBER:"groupMember",TYPE_MESSAGE_EDITED:"edited",TYPE_MESSAGE_DELETED:"deleted",ACTION_TYPE_CALL:"call",EXTRAS:"extras",SCOPE:"scope",NEW:"new",OLD:"old"},ActionMessages:{ACTION_GROUP_JOINED_MESSAGE:"%s joined",ACTION_GROUP_LEFT_MESSAGE:"%s left",ACTION_MEMBER_KICKED_MESSAGE:"%s kicked %s",ACTION_MEMBER_BANNED_MESSAGE:"%s banned %s",ACTION_MEMBER_UNBANNED_MESSAGE:"%s unbanned %s",ACTION_MEMBER_INVITED_MESSAGE:"%s banned %s",ACTION_MESSAGE_EDITED_MESSAGE:" Message Edited",ACTION_MESSAGE_DELETED_MESSAGE:"Message Deleted",ACTION_MEMBER_SCOPE_CHANGED:"%s made %s %s",ACTION_MEMBER_ADDED_TO_GROUP:"%s added %s"},ACTION_TYPE:{TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_SCOPE_CHANGED:"scopeChanged",TYPE_MESSAGE:"message",TYPE_MESSAGE_EDITED:"edited",TYPE_MESSAGE_DELETED:"deleted",TYPE_MEMBER_ADDED:"added"},ACTIONS:{MEMBER_ADDED:"added",MEMBER_JOINED:"joined",MEMBER_LEFT:"left",MEMBER_KICKED:"kicked",MEMBER_BANNED:"banned",MEMBER_UNBANNED:"unbanned",MEMBER_INVITED:"invited",MEMBER_SCOPE_CHANGED:"scopeChanged",MESSAGE_EDITED:"edited",MESSSAGE_DELETED:"deleted",TYPE_USER:"user",TYPE_GROUP:"group",TYPE_GROUP_MEMBER:"groupMember"}},t.BlockedUsersConstants={REQUEST_KEYS:{DIRECTIONS:{BOTH:"both",HAS_BLOCKED_ME:"hasBlockedMe",BLOCKED_BY_ME:"blockedByMe"}}},t.CallConstants={CALL_MODE:{DEFAULT:"DEFAULT",SPOTLIGHT:"SPOTLIGHT",SINGLE:"SINGLE",TILE:"TILE",GRID:"GRID"},CALL_TYPE:{AUDIO:"audio",VIDEO:"video"},RECEIVER_TYPE_GROUP:"group",RECEIVER_TYPE_USER:"user",CALL_KEYS:{CALL_DATA:"data",CALL_ID:"id",CALL_SESSION_ID:"sessionid",CALL_RECEIVER:"receiver",CALL_SENDER:"sender",CALL_RECEIVER_TYPE:"receiverType",CALL_STATUS:"status",CALL_TYPE:"type",CALL_INITIATED_AT:"initiatedAt",CALL_JOINED_AT:"joinedAt",CALL_LEFT_AT:"leftAt",CALL_METADATA:"metadata",CALL_ENTITIES:"entities",CALL_ENTITY_TYPE:"entityType",CALL_ENTITY:"entity",CALL_ENTITY_USER:"user",CALL_ENTITY_GROUP:"group"},CALL_STATUS:{INITIATED:"initiated",ONGOING:"ongoing",UNANSWERED:"unanswered",REJECTED:"rejected",BUSY:"busy",CANCELLED:"cancelled",ENDED:"ended"},AUDIO_INPUT_DEVICES:"audioInputDevices",AUDIO_OUTPUT_DEVICES:"audioOutputDevices",VIDEO_INPUT_DEVICES:"videoInputDevices",POST_MESSAGES:{TYPES:{ACTION_MESSAGE:"cometchat_action_message",HANGUP:"hangup",COMETCHAT_RTC_SETTINGS:"cometchat_rtc_settings"},ACTIONS:{USER_JOINED:"onUserJoined",USER_LEFT:"onUserLeft",USER_LIST_CHANGED:"onUserListChanged",INITIAL_DEVICE_LIST:"initialDeviceList",DEVICE_CHANGE:"onDeviceChange",LOAD:"LOAD",CHANGE_AUDIO_INPUT:"changeAudioInput",CHANGE_AUDIO_OUTPUT:"changeAudioOutput",CHANGE_VIDEO_INPUT:"changeVideoInput",MUTE_AUDIO:"muteAudio",UNMUTE_AUDIO:"unMuteAudio",PAUSE_VIDEO:"pauseVideo",UNPAUSE_VIDEO:"unPauseVideo",SWITCH_MODE:"switchMode",START_SCREENSHARE:"startScreenShare",STOP_SCREENSHARE:"stopScreenShare",END_CALL:"endCall",START_RECORDING:"startRecording",STOP_RECORDING:"stopRecording",RECORDING_TOGGLED:"onRecordingToggled",USER_MUTED:"onUserMuted"}},MEDIA_DEVICE:{ID:"id",NAME:"name",ACTIVE:"active"}},t.GroupConstants={KEYS:{NAME:"name",GUID:"guid",TYPE:"type",PASSWORD:"password",ICON:"icon",DESCRIPTION:"description",OWNER:"owner",METADATA:"metadata",CREATED_AT:"createdAt",UPDATED_AT:"updatedAt",HAS_JOINED:"hasJoined",WS_CHANNEL:"wsChannel",TAGS:"tags"}},t.GroupMemersConstans={KEYS:{SCOPE:"scope",UID:"uid",GUID:"guid",USER:"user",NAME:"name"}},t.UserConstants={UID:"uid",NAME:"name",AUTH_TOKEN:"authToken",AVATAR:"avatar",LAST_ACTIVE_AT:"lastActiveAt",LINK:"link",META_DATA:"metadata",ROLE:"role",STATUS:"status",STATUS_MESSAGE:"statusMessage",USER_NAME:"user_name",TAGS:"tags"},t.Errors={ERROR_IO_EXCEPTION:"ERROR_IO_EXCEPTION",ERROR_JSON_EXCEPTION:"ERROR_JSON_EXCEPTION",ERROR_PASSWORD_MISSING:"ERROR_PASSWORD_MISSING",ERROR_LIMIT_EXCEEDED:"ERROR_LIMIT_EXCEEDED",ERROR_USER_NOT_LOGGED_IN:"ERROR_USER_NOT_LOGGED_IN",ERROR_INVALID_GUID:"ERROR_INVALID_GUID",ERROR_PASSWORD_MISSING_MESSAGE:"Password is mandatory for a password group",ERROR_LIMIT_EXCEEDED_MESSAGE:"Limit Exceeded Max limit of %s",ERROR_USER_NOT_LOGGED_IN_MESSAGE:"Please log in to CometChat before calling this method",ERROR_INVALID_GUID_MESSAGE:"Please provide a valid GUID",ERROR_DEFAULT_MESSAGE:"Something went wrong",ERR_SETTINGS_HASH_OUTDATED:"ERR_SETTINGS_HASH_OUTDATED",ERR_NO_AUTH:"ERR_NO_AUTH",ERR_XMPP_CONFLICT:"conflict"},t.CALL_ERROR={CALL_ALREADY_INITIATED:{code:"CALL_ALREADY_INITIATED",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}},ERROR_IN_CALLING:{code:"CALL_IN_PROGRESS",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}},CANNOT_ACCEPT_CALL:{code:"CALL_IN_PROGRESS",name:"CALL_IN_PROGRESS",message:"There is already a call in progress",details:{}},NOT_INITIALIZED:{code:"NOT_INITIALIZED",name:"NOT_INITIALIZED",message:"Please call the CometChat.init() method before calling any other methods related to CometChat.",details:{}},NOT_LOGGED_IN:{code:"NOT_LOGGED_IN",name:"NOT_LOGGED_IN",message:"Please login before starting a call.",details:{}},SESSION_ID_REQUIRED:{code:"SESSION_ID_REQUIRED",name:"SESSION_ID_REQUIRED",message:"Please make sure you are passing correct session id.",details:{}},CALL_SETTINGS_REQUIRED:{code:"CALL_SETTINGS_REQUIRED",name:"CALL_SETTINGS_REQUIRED",message:"Please make sure you are passing the call settings object.",details:{}},JWT_NOT_FOUND:{code:"JWT_NOT_FOUND",name:"JWT_NOT_FOUND",message:"There was some issue while fetching JWT from API.",details:{}}},t.PARAMETER_ERROR={PARAMETER_REQUIRED:{code:"%s_NOT_PROVIDED",name:"%s_NOT_PROVIDED",message:"please provide the %s.",details:{}}},t.GENERAL_ERROR={MUST_BE_A_STRING:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a string.",details:{}},MUST_BE_A_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a number.",details:{}},MUST_BE_A_OBJECT:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a object.",details:{}},MUST_BE_AN_ARRAY:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be an array.",details:{}},MUST_BE_A_BOOLEAN:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a boolean.",details:{}},MUST_BE_A_BLOB:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a blob.",details:{}},INVALID:{code:"INVALID_%s",name:"INVALID_%s",message:"Invalid %s. Please provide a valid %s.",details:{}},METHOD_COMPULSORY:{code:"%s_IS_COMPULSORY",name:"%s_IS_COMPULSORY",message:"%s is required.",details:{}},LIMIT_EXCEEDED:{code:"ERROR_%s_EXCEEDED",name:"ERROR_%s_EXCEEDED",message:"Limit exceeded max limit of %s.",details:{}},MUST_BE_A_POSITIVE_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a postive integer greater than 0.",details:{}},INVALID_MEDIA_FILE:{code:"INVALID_%s",name:"INVALID_%s",message:"The message type does not match the file's mime type.",details:{}},EMPTY_STRING:{code:"INVALID_%s",name:"INVALID_%s",message:"%s cannot be empty.",details:{}},MISSING_KEY:{code:"MISSING_KEY",name:"MISSING_KEY",message:"The key %s is missing from the %s object.",details:{}},EMPTY_ARRAY:{code:"INVALID_%s",name:"INVALID_%s",message:"The parameter %s should be an array and it cannot be empty.",details:{}},INVALID_SEARCH_KEYWORD:{code:"INVALID_SEARCH_KEYWORD",name:"INVALID_SEARCH_KEYWORD",message:"Invalid search keyword. Please provide a valid search keyword.",details:{}},INVALID_GROUP_PROPERTY:{code:"INVALID_%s",name:"INVALID_%s",message:"Invalid %s provided for the group. Please provide a valid %s.",details:{}},INVALID_USER_PROPERTY:{code:"INVALID_%s",name:"INVALID_%s",message:"Invalid %s provided for a user. Please provide a valid %s.",details:{}},PARAMETER_MUST_BE_A_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s method accepts parameter as a number.",details:{}},PARAMETER_MUST_BE_AN_ARRAY:{code:"INVALID_%s",name:"INVALID_%s",message:"%s method accepts parameter as an array.",details:{}},PARAMETER_MUST_BE_A_BOOLEAN:{code:"INVALID_%s",name:"INVALID_%s",message:"%s method accepts parameter as a boolean.",details:{}},PARAMETER_MUST_BE_A_POSITIVE_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s method accepts parameter to be a positive number greater than 0.",details:{}},PARAMETER_MUST_BE_A_STRING:{code:"INVALID_%s",name:"INVALID_%s",message:"%s method accepts parameter as a string.",details:{}},PARAMETER_COMPULSORY:{code:"%s_IS_COMPULSORY",name:"%s_IS_COMPULSORY",message:"%s cannot be blank. Please provide a valid %s.",details:{}},PASSWORD_COMPULSORY:{code:"%s_IS_COMPULSORY",name:"%s_IS_COMPULSORY",message:"Password is mandatory for a password group.",details:{}},INVALID_ARRAY:{code:"INVALID_%s",name:"INVALID_%s",message:"%s",details:{}}},t.UserErrors={INVALID_STATUS:new i.CometChatException({code:"INVALID_STATUS_VALUE",name:"INVALID_STATUS_VALUE",message:"The `status` parameter accepts only `online` or `offline`.",details:""}),INVALID_DIRECTION:new i.CometChatException({code:"INVALID_DIRECTION_VALUE",name:"INVALID_DIRECTION_VALUE",message:"The `direction` parameter accepts only `both`, `blockeyByMe` or `hasBlockedMe`.",details:""}),USER_NOT_LOGGED_IN:new i.CometChatException({code:"USER_NOT_LOGGED_IN",name:"USER_NOT_LOGGED_IN",message:"Please log in to CometChat before calling this method.",details:""})},t.GroupErrors={NOT_A_GROUP:new i.CometChatException({code:"NOT_A_GROUP",message:"Please use group class to construct a new group."}),INVALID_SCOPE:new i.CometChatException({code:"INVALID_SCOPE_VALUE",name:"INVALID_SCOPE_VALUE",message:"Scope can be `admin`, `moderator` or `participant`.",details:""}),INVALID_GROUP_TYPE:new i.CometChatException({code:"INVALID_GROUP_TYPE",name:"INVALID_GROUP_TYPE",message:"Group type can be `public`, `private`, `protected` or `password`.",details:""})},t.ConversationErrors={INVALID_CONVERSATION_TYPE:{code:"INVALID_CONVERSATION_TYPE",name:"INVALID_CONVERSATION_TYPE",message:"Conversation type can be `user` or `group`.",details:"Please check the value of conversationType."},CONVERSATION_NOT_FOUND:{code:"CONVERSATION_NOT_FOUND",name:"CONVERSATION_NOT_FOUND",message:"Conversation for %s %s not found.",details:"Please check the value of conversationWith and conversationType."}},t.ExtensionErrors={INVALID_EXTENSION:{code:"ERROR_INVALID_EXTENSION",name:"ERROR_INVALID_EXTENSION",message:"The provided extension cannot be null or empty. Please provide a valid extension.",details:{}},EXTENSION_NOT_FOUND:{code:"ERROR_EXTENSION_NOT_FOUND",name:"ERROR_EXTENSION_NOT_FOUND",message:"The provided extension could not be found.",details:{}}},t.MessageErrors={INVALID_RECEIVER_TYPE:{code:"INVALID_RECEIVER_TYPE",name:"INVALID_RECEIVER_TYPE",message:"Receiver type can be `user` or `group`.",details:"Please check the value of receiverType."}},t.FeatureRestrictionErrors={INVALID_FEATURE:{code:"ERROR_INVALID_FEATURE",name:"ERROR_INVALID_FEATURE",message:"The provided feature cannot be null or empty. Please provide a valid feature.",details:{}},FEATURE_NOT_FOUND:{code:"ERROR_FEATURE_NOT_FOUND",name:"ERROR_FEATURE_NOT_FOUND",message:"The provided feature could not be found.",details:{}}},t.PresenceConstatnts={XMPP_KEYS:{FROM:"from",STATUS:"status",LAST_ACTIVE_AT:"lastActiveAt",TYPE:"type"},STATUS:{ONLINE:"online",AVAILABLE:"available",OFFLINE:"offline",JOINED:"JOINED",LEFT:"LEFT"}},t.APP_SETTINGS={APP_SETTINGS:"app_settings",KEYS:{CHAT_HOST:"CHAT_HOST",CHAT_USE_SSL:"CHAT_USE_SSL",GROUP_SERVICE:"GROUP_SERVICE",CALL_SERVICE:"CALL_SERVICE",CHAT_WS_PORT:"CHAT_WS_PORT",CHAT_WSS_PORT:"CHAT_WSS_PORT",CHAT_HTTP_BIND_PORT:"CHAT_HTTP_BIND_PORT",CHAT_HTTPS_BIND_PORT:"CHAT_HTTPS_BIND_PORT",ADMIN_API_HOST:"ADMIN_API_HOST",CLIENT_API_HOST:"CLIENT_API_HOST",WEBRTC_HOST:"WEBRTC_HOST",WEBRTC_USE_SSL:"WEBRTC_USE_SSL",WEBRTC_WS_PORT:"WEBRTC_WS_PORT",WEBRTC_WSS_PORT:"WEBRTC_WSS_PORT",WEBRTC_HTTP_BIND_PORT:"WEBRTC_HTTP_BIND_PORT",WEBRTC_HTTPS_BIND_PORT:"WEBRTC_HTTPS_BIND_PORT",EXTENSION_LIST:"extensions",EXTENSION_KEYS:{ID:"id",NAME:"name"},JID_HOST_OVERRIDE:"JID_HOST_OVERRIDE",CHAT_HOST_OVERRIDE:"CHAT_HOST_OVERRIDE",CHAT_HOST_APP_SPECIFIC:"CHAT_HOST_APP_SPECIFIC",MODE:"MODE",DEFAULT_MODE:"DEFAULT",HIGH_VOL_MODE:"HIGH_VOL",FLAKY_MODE:"FLAKY",POLLING_ENABLED:"POLLING_ENABLED",POLLING_INTERVAL:"POLLING_INTERVAL",ANALYTICS_PING_DISABLED:"ANALYTICS_PING_DISABLED",ANALYTICS_HOST:"ANALYTICS_HOST",ANALYTICS_VERSION:"ANALYTICS_VERSION",ANALYTICS_USE_SSL:"ANALYTICS_USE_SSL",SETTINGS_HASH:"settingsHash",SETTINGS_HASH_RECEIVED_AT:"settingsHashReceivedAt",DENY_FALLBACK_TO_POLLING:"DENY_FALLBACK_TO_POLLING"}},t.COMMON_UTILITY_CONSTANTS={TYPE_CONSTANTS:{BOOLEAN:"boolean",STRING:"string",OBJECT:"object",NUMBER:"number"}},t.CONNECTION_STATUS={CONNECTED:"connected",CONNECTING:"connecting",DISCONNECTED:"disconnected",FEATURE_THROTTLED:"featureThrottled"},t.SESSION_STORE={SESSION_ID:"sessionId"},t.API_ERROR_CODES={AUTH_ERR_AUTH_TOKEN_NOT_FOUND:"AUTH_ERR_AUTH_TOKEN_NOT_FOUND"},t.PROSODY_API={DOMAIN_PREFIX:"xmpp",PATH:{ROOM:"room",ROOM_SIZE:"room-size",SESSIONS:"sessions"},RESPONSE:{PARTICIPANTS:"participants"},QUERY_PARAMETERS:{DOMAIN:"domain",ROOM:"room"}},t.ProsodyApiErrors={INVALID_SESSIONID:{code:"ERROR_INVALID_SESSIONID",name:"ERROR_INVALID_SESSIONID",message:"The provided sessionId cannot be null or empty. Please provide a valid sessionId.",details:""},INVALID_TYPE:{code:"ERROR_INVALID_TYPE",name:"ERROR_INVALID_TYPE",message:"The provided type cannot be null or empty. Please provide a valid type.",details:""}},t.JWT_API={KEYS:{PASSTHROUGH:"passthrough",EXPAND:"expand"}}},function(e,o,t){"use strict";o.__esModule=!0;var s=t(9),i=t(0),r=t(5),a=t(2),c=t(17),u=t(18),l=t(20),E=t(3),n=t(13);function d(e){return null!=e&&("string"==typeof e&&(e=e.trim()),"object"==typeof e&&0===Object.keys(e).length&&(e=void 0)),["",0,"0",!1,null,"null",void 0,"undefined"].includes(e)}function h(e){for(var s=[],t=1;t<arguments.length;t++)s[t-1]=arguments[t];return e.split("%s").reduce(function(e,t,n){return e+t+(s[n]||"")},"")}o.getChatHost=function(e){return e[i.APP_SETTINGS.KEYS.CHAT_HOST_OVERRIDE]?e[i.APP_SETTINGS.KEYS.CHAT_HOST_OVERRIDE]:e[i.APP_SETTINGS.KEYS.CHAT_HOST_APP_SPECIFIC]?e[i.APP_SETTINGS.KEYS.CHAT_HOST_APP_SPECIFIC]:e[i.APP_SETTINGS.KEYS.CHAT_HOST]},o.getJidHost=function(e){return e[i.APP_SETTINGS.KEYS.JID_HOST_OVERRIDE]?e[i.APP_SETTINGS.KEYS.JID_HOST_OVERRIDE]:e[i.APP_SETTINGS.KEYS.CHAT_HOST]},o.isObject=function(e){return e instanceof Object&&e.constructor===Object},o.isTruthy=function(e){return[!0,1,"1","true","TRUE"].includes(e)},o.isFalsy=d,o.getOrdinalSuffix=function(e){var t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"},o.format=h,o.createUidFromJid=function(e){return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))};var p=function(){function e(){}return e.log=function(e,t){},e.error=function(e,t){},e.info=function(e,t){},e}();function S(){return new Promise(function(t,n){r.makeApiCall("appSettings").then(function(e){s.LocalStorage.getInstance().set("app_settings",e.data),e.data.MODE&&E.CometChat.setMode(e.data.MODE),t(e.data)},function(e){n(new a.CometChatException(e.error))})})}o.Logger=p,o.getCurrentTime=function(){return(new Date).getTime()},o.getAppSettings=function(){return new Promise(function(t,n){s.LocalStorage.getInstance().get(i.APP_SETTINGS.APP_SETTINGS).then(function(e){d(e)?S().then(function(e){t(e)},function(e){n(e)}):t(e)},function(e){n(e)})})},o.getUpdatedSettings=S,o.isImage=function(e){var t;return e.type&&e.type.toLowerCase().includes("image")&&(t=!0),t},o.isVideo=function(e){var t;return e.type&&e.type.toLowerCase().includes("video")&&(t=!0),t},o.isAudio=function(e){var t;return e.type&&e.type.toLowerCase().includes("audio")&&(t=!0),t},o.validateScope=function(e){return typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"SCOPE","SCOPE","Scope"))):d(e)?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"SCOPE","SCOPE","scope","scope"))):e!=E.CometChat.GROUP_MEMBER_SCOPE.ADMIN&&e!=E.CometChat.GROUP_MEMBER_SCOPE.MODERATOR&&e!=E.CometChat.GROUP_MEMBER_SCOPE.PARTICIPANT?new a.CometChatException(i.GroupErrors.INVALID_SCOPE):void 0},o.validateUpdateGroup=function(e){return e.hasOwnProperty(i.GroupConstants.KEYS.GUID)?typeof e[i.GroupConstants.KEYS.GUID]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","GUID"))):d(e[i.GroupConstants.KEYS.GUID])?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GUID","GUID","GUID","GUID"))):e.hasOwnProperty(i.GroupConstants.KEYS.NAME)&&""===e[i.GroupConstants.KEYS.NAME]?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"GROUP_NAME","GROUP_NAME","Group name"))):void 0:new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GUID","GUID","GUID","GUID")))},o.validateJoinGroup=function(e,t,n){if(typeof e==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.OBJECT){if(!e.hasOwnProperty(i.GroupConstants.KEYS.GUID))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GUID","GUID","GUID","GUID")));if(typeof e[i.GroupConstants.KEYS.GUID]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","GUID")));if(d(e[i.GroupConstants.KEYS.GUID]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GUID","GUID","GUID","GUID")));if(!e.hasOwnProperty(i.GroupConstants.KEYS.TYPE))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GROUP_TYPE","GROUP_TYPE","Group type","Group type")));if(typeof e[i.GroupConstants.KEYS.TYPE]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","Group type")));if(d(e[i.GroupConstants.KEYS.TYPE]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GROUP_TYPE","GROUP_TYPE","type","type")));if(e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(i.GroupErrors.INVALID_GROUP_TYPE);if(e[i.GroupConstants.KEYS.TYPE].toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(!e.hasOwnProperty(i.GroupConstants.KEYS.PASSWORD))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PASSWORD_COMPULSORY),"PASSWORD","PASSWORD")));if(typeof e[i.GroupConstants.KEYS.PASSWORD]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","Password")));if(d(e[i.GroupConstants.KEYS.PASSWORD]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"PASSWORD","PASSWORD","password","password")))}}else{if(void 0!==e){if(typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","GUID")));if(d(e))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GUID","GUID","GUID","GUID")))}if(void 0!==t){if(typeof t!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","Group type")));if(d(t))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GROUP_TYPE","GROUP_TYPE","type","type")));if(t.toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&t.toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&t.toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&t.toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(i.GroupErrors.INVALID_GROUP_TYPE);if(t.toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(typeof n!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","Password")));if(d(n))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"PASSWORD","PASSWORD","password","password")))}}}},o.validateCreateGroup=function(e){if(!e.hasOwnProperty(i.GroupConstants.KEYS.GUID))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GUID","GUID","GUID","GUID")));if(typeof e[i.GroupConstants.KEYS.GUID]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","GUID")));if(d(e[i.GroupConstants.KEYS.GUID]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GUID","GUID","GUID","GUID")));if(!e.hasOwnProperty(i.GroupConstants.KEYS.NAME))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GROUP_NAME","GROUP_NAME","Group name","Group name")));if(typeof e[i.GroupConstants.KEYS.NAME]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_NAME","GROUP_NAME","Group name")));if(d(e[i.GroupConstants.KEYS.NAME]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GROUP_NAME","GROUP_NAME","name","name")));if(!e.hasOwnProperty(i.GroupConstants.KEYS.TYPE))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"GROUP_TYPE","GROUP_TYPE","Group type","Group type")));if(typeof e[i.GroupConstants.KEYS.TYPE]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","Group type")));if(d(e[i.GroupConstants.KEYS.TYPE]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"GROUP_TYPE","GROUP_TYPE","type","type")));if(e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&e[i.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(i.GroupErrors.INVALID_GROUP_TYPE);if(e[i.GroupConstants.KEYS.TYPE].toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(!e.hasOwnProperty(i.GroupConstants.KEYS.PASSWORD))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PASSWORD_COMPULSORY),"PASSWORD","PASSWORD")));if(typeof e[i.GroupConstants.KEYS.PASSWORD]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","Password")));if(d(e[i.GroupConstants.KEYS.PASSWORD]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_GROUP_PROPERTY),"PASSWORD","PASSWORD","password","password")))}if(e.hasOwnProperty(i.GroupConstants.KEYS.TAGS)){if(!Array.isArray(e[i.GroupConstants.KEYS.TAGS]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_AN_ARRAY),"GROUP_TAGS","GROUP_TAGS","Group tags")));if(0===e[i.GroupConstants.KEYS.TAGS].length)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_ARRAY),"GROUP_TAGS","GROUP_TAGS","Group tags")))}},o.validateId=function(e,t){if("user"===t){if(typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","UID")));if(d(e))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"UID","UID","UID","UID")))}if("group"===t){if(typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","GUID")));if(d(e))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"GUID","GUID","GUID","GUID")))}},o.validateHideMessagesFromBlockedUsers=function(e){if(typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"HIDE_MESSAGES_FROM_BLOCKED_USERS","HIDE_MESSAGES_FROM_BLOCKED_USERS","hideMessagesFromBlockedUsers")))},o.validateArray=function(e,t){var n="List should be an array.";return n="blockUsers"===t?"blockUsers() method accepts an array of users.":"unblockUsers"===t?"unblockUsers() method accepts an array of users.":"groupMembers"===t?"addMembersToGroup() method accepts members list as an array of users.":"addMembersToGroup() method accepts bannedMembers list as an array of users.",typeof e!=i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.OBJECT?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_ARRAY),"USER_LIST","USER_LIST",n))):Array.isArray(e)?void 0:new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_ARRAY),"USER_LIST","USER_LIST",n)))},o.validateMsgId=function(e){return isNaN(e)?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_NUMBER),"MESSAGE_ID","MESSAGE_ID","Message Id"))):d(e)?new a.CometChatException(n.ERRORS.PARAMETER_MISSING):void 0},o.validateChatType=function(e){return typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver type"))):d(e)?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","receiver type","receiver type"))):e!=i.MessageConstatnts.RECEIVER_TYPE.GROUP&&e!=i.MessageConstatnts.RECEIVER_TYPE.USER?new a.CometChatException(i.MessageErrors.INVALID_RECEIVER_TYPE):void 0},o.validateMessage=function(e){var t=e;if(typeof t.getReceiverId()!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_ID","RECEIVER_ID","Receiver Id")));if(d(t.getReceiverId()))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"RECEIVER_ID","RECEIVER_ID","receiver id","receiver id")));if(typeof t.getReceiverType()!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver Type")));if(d(t.getReceiverType()))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","receiver type","receiver type")));if(t.getReceiverType()!=i.MessageConstatnts.RECEIVER_TYPE.GROUP&&t.getReceiverType()!=i.MessageConstatnts.RECEIVER_TYPE.USER)return new a.CometChatException(i.MessageErrors.INVALID_RECEIVER_TYPE);if(e instanceof c.TextMessage){var n=e;if(typeof n.getText()!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"MESSAGE_TEXT","MESSAGE_TEXT","Message text")));if(""===n.getText().trim())return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"MESSAGE_TEXT","MESSAGE_TEXT","Message text")))}if(e instanceof u.MediaMessage){var s=e;if(s.getData()&&s.getData().hasOwnProperty("attachments")){var r=s.getAttachment();if(!r.getExtension())return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MISSING_KEY),"extension","Attachment")));if(!r.getMimeType())return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MISSING_KEY),"mimeType","Attachment")));if(!r.getName())return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MISSING_KEY),"name","Attachment")));if(!r.getUrl())return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MISSING_KEY),"url","Attachment")))}else{if(!(s.file instanceof Blob))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_BLOB),"MEDIA_OBJECT","MEDIA_OBJECT","Media object")));if("image"==s.getType()){if(!o.isImage(s.file))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_MEDIA_FILE),"IMAGE_FILE","IMAGE_FILE")))}else if("video"==s.getType()){if(!o.isVideo(s.file))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_MEDIA_FILE),"VIDEO_FILE","VIDEO_FILE")))}else if("audio"==s.getType()&&!o.isAudio(s.file))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_MEDIA_FILE),"AUDIO_FILE","AUDIO_FILE")))}}if(e instanceof l.CustomMessage&&d(e.getCustomData()))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"CUSTOM_DATA","CUSTOM_DATA","custom data","custom data")))},o.validateCreateUser=function(e){if(!e.hasOwnProperty(i.UserConstants.UID))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"UID","UID","UID","UID")));if(typeof e[i.UserConstants.UID]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","UID")));if(d(e[i.UserConstants.UID]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_USER_PROPERTY),"UID","UID","UID","UID")));if(!e.hasOwnProperty(i.UserConstants.NAME))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"USER_NAME","USER_NAME","User name","User name")));if(typeof e[i.UserConstants.NAME]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"USER_NAME","USER_NAME","User name")));if(d(e[i.UserConstants.NAME]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_USER_PROPERTY),"USER_NAME","USER_NAME","name","name")));if(e.hasOwnProperty(i.UserConstants.AVATAR)&&""===e[i.UserConstants.AVATAR])return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_AVATAR","USER_AVATAR","User avatar")));if(e.hasOwnProperty(i.UserConstants.META_DATA)&&""===e[i.UserConstants.META_DATA])return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_METADATA","USER_METADATA","User metadata")));if(e.hasOwnProperty(i.UserConstants.LINK)&&""===e[i.UserConstants.LINK])return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_LINK","USER_LINK","User link")));if(e.hasOwnProperty(i.UserConstants.STATUS_MESSAGE)&&""===e[i.UserConstants.STATUS_MESSAGE])return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_STATUS_MESSAGE","USER_STATUS_MESSAGE","User status message")));if(e.hasOwnProperty(i.UserConstants.ROLE)&&""===e[i.UserConstants.ROLE])return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_ROLE","USER_ROLE","User role")));if(e.hasOwnProperty(i.UserConstants.TAGS)){if(!Array.isArray(e[i.UserConstants.TAGS]))return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_AN_ARRAY),"USER_TAGS","USER_TAGS","User tags")));if(0===e[i.UserConstants.TAGS].length)return new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_ARRAY),"USER_TAGS","USER_TAGS","User tags")))}},o.validateUpdateUser=function(e){return e.hasOwnProperty(i.UserConstants.UID)?typeof e[i.UserConstants.UID]!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","UID"))):d(e[i.UserConstants.UID])?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID_USER_PROPERTY),"UID","UID","UID","UID"))):e.hasOwnProperty(i.UserConstants.NAME)&&""===e[i.UserConstants.NAME]?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.EMPTY_STRING),"USER_NAME","USER_NAME","User name"))):void 0:new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.PARAMETER_COMPULSORY),"UID","UID","UID","UID")))},o.validateConversationType=function(e){return typeof e!==i.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.MUST_BE_A_STRING),"CONVERSATION_TYPE","CONVERSATION_TYPE","Conversation type"))):d(e)?new a.CometChatException(JSON.parse(h(JSON.stringify(i.GENERAL_ERROR.INVALID),"CONVERSATION_TYPE","CONVERSATION_TYPE","conversation type","conversation type"))):(e=e.toLowerCase())!=E.CometChat.RECEIVER_TYPE.USER&&e!=E.CometChat.RECEIVER_TYPE.GROUP?new a.CometChatException(i.ConversationErrors.INVALID_CONVERSATION_TYPE):void 0}},function(e,t,n){"use strict";t.__esModule=!0;var s=function(e){null!==e.code&&void 0!==e.code&&""!==e.code&&(this.code=e.code),null!==e.name&&void 0!==e.name&&""!==e.name&&(this.name=e.name),null!==e.message&&void 0!==e.message&&""!==e.message&&(this.message=e.message),null!==e.details&&void 0!==e.details&&""!==e.details&&(this.details=e.details)};t.CometChatException=s},function(e,ee,te){"use strict";(function(t){var h=this&&this.__assign||function(){return(h=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},E=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};ee.__esModule=!0;var d=te(29),L=te(1),D=te(2),p=te(5),S=te(4),g=te(14),r=te(15),C=te(9),_=te(18),f=te(17),T=te(7),n=te(22),c=te(8),U=te(0),a=te(6),u=te(16),s=te(39),i=te(50),e=te(21),o=te(24),w=te(33),m=te(13),A=te(23),I=te(51),R=te(52),N=te(54),O=te(55),y=te(56),P=te(25),M=te(35),b=te(36),G=te(20),Y=te(40),x=te(57),F=te(37),B=te(26),K=te(58),H=te(38),k=te(59),V=te(41),J=te(27),X=te(19),j=te(60),q=te(61),W=te(62),Q=te(30),z=te(34),$=te(63),Z=g.XMPPConnectionHelper.getInstance(),v=function(){function v(e){try{"undefined"!=typeof document?L.Logger.info("This is browser","we have everything"):"undefined"!=typeof navigator&&"ReactNative"==navigator.product?(L.Logger.info("This is react-native","we do not have dom"),t.DOMParser=te(66).DOMParser,t.document=(new t.DOMParser).parseFromString("<?xml version='1.0'?>","text/xml"),v.isNative=!0):L.Logger.info("This is node","we do not have anything"),v.typingTimer(),v.appId=e,v.messagesStore=n.MessagesStore.getInstance(),v.localStorage=C.LocalStorage.getInstance(),v.userStore=s.UserStore.getInstance(),v.keyStore=i.KeyStore.getInstance(),v.messageListnerMaping=P.MessageListnerMaping.getInstance()}catch(e){L.Logger.error("CometChat: constructor",e)}}return v.setAuthToken=function(e){try{v.authToken=e}catch(e){L.Logger.error("CometChat: setAuthToken",e)}},v.prototype.getAuthToken=function(){try{return v.authToken}catch(e){L.Logger.error("CometChat: getAuthToken",e)}},v.getAppId=function(){try{return v.appId}catch(e){L.Logger.error("CometChat: getAppId",e)}},v.prototype.getApiKey=function(){try{return v.apiKey}catch(e){L.Logger.error("CometChat: getApiKey",e)}},v.getMode=function(){try{return v.mode}catch(e){L.Logger.error("CometChat: getMode",e)}},v.setMode=function(e){try{v.mode=e}catch(e){L.Logger.error("CometChat: getMode",e)}},v.getSessionId=function(){try{return v.sessionId}catch(e){L.Logger.error("CometChat: getAppId",e)}},v.getLastMessageId=function(){try{return v.lastMessageId}catch(e){L.Logger.error("CometChat: getLastMessageId",e)}},v.setLastMessageId=function(e){try{v.lastMessageId=e}catch(e){L.Logger.error("CometChat: getLastMessageId",e)}},v.setSuccessfulTimeStamp=function(e){try{v.successfulPingTimeStamp=e}catch(e){L.Logger.error("CometChat: setSuccessfulTimeStamp",e)}},v.getSuccessfultTimeStamp=function(){try{return v.successfulPingTimeStamp}catch(e){L.Logger.error("CometChat: getSuccessfultTimeStamp",e)}},v.onStorageEvent=function(e){var n=this;if(document&&!document.hasFocus()){var t=v.appId+":common_store/user";e.key===t&&null===e.newValue&&(v.authToken=void 0,v.didAnalyticsPingStart()&&v.clearAnalyticsPingTimer(),v.didMessagesPollingStart()&&v.clearMessagesTimer(),g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),v.pushToLoginListener("","Logout_Success")),e.key===t&&null===e.oldValue&&C.LocalStorage.getInstance().get("user").then(function(e){e&&(v.user=new S.Me(e),v.setAuthToken(v.user.getAuthToken()),e.jwt&&(v.jwt=e.jwt),C.LocalStorage.getInstance().get("app_settings").then(function(e){if(e)if(e[U.APP_SETTINGS.KEYS.MODE]&&(v.mode=e[U.APP_SETTINGS.KEYS.MODE]),e[U.APP_SETTINGS.KEYS.SETTINGS_HASH]&&(v.settingsHash=e[U.APP_SETTINGS.KEYS.SETTINGS_HASH]),e[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]&&(v.settingsHashReceivedAt=e[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]),e[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]&&(v.analyticsHost=e[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]),e[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]&&(v.analyticsVersion=e[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]),v.isAnalyticsDisabled=!!e[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED],e.hasOwnProperty(U.APP_SETTINGS.KEYS.DENY_FALLBACK_TO_POLLING)&&(v.shouldFallBackToPolling=!1),v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),e[U.APP_SETTINGS.KEYS.POLLING_ENABLED])n.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.pollingEnabled=!0,v.pollingInterval=e[U.APP_SETTINGS.KEYS.POLLING_INTERVAL],v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.fetchMessages(),v.startMessagesTimer());else if(v.getConnectionStatus()!==U.CONNECTION_STATUS.CONNECTED){var t=new S.User(v.user);v.pushToLoginListener(t,"Login_Success"),v.XMPPLogin(v.user,function(){},function(){})}}))})}},v.beforeUnload=function(e){var t=v.getDataFromSessionStorage(U.SESSION_STORE.SESSION_ID);v.removeDataFromSessionStorage(U.SESSION_STORE.SESSION_ID),C.LocalStorage.getInstance().set(U.SESSION_STORE.SESSION_ID,t)},v.isPollingEnabled=function(){try{return v.pollingEnabled}catch(e){L.Logger.error("CometChat: isPollingEnabled",e)}},v.didMessagesPollingStart=function(){try{return v.isMessagesPollingStarted}catch(e){L.Logger.error("CometChat: didMessagesPollingStart",e)}},v.didAnalyticsPingStart=function(){try{return v.isAnalyticsPingStarted}catch(e){L.Logger.error("CometChat: didAnalyticsPingStart",e)}},v.getDataFromSessionStorage=function(e){if(window.sessionStorage)return window.sessionStorage.getItem(e)},v.addDataToSessionStorage=function(e,t){window.sessionStorage&&window.sessionStorage.setItem(e,t)},v.removeDataFromSessionStorage=function(e){window.sessionStorage&&window.sessionStorage.removeItem(e)},v.init=function(r,e){var o=this;return void 0===r&&(r=""),void 0===e&&(e={}),new Promise(function(n,s){try{v.pollingMessagesId=0,"object"==typeof r&&(r.hasOwnProperty("appId")&&(r=r.appId),r.hasOwnProperty("appSettings")&&(e=r.appSettings)),L.isFalsy(e)?e=(new H.AppSettingsBuilder).setRegion(H.AppSettings.REGION_EU).build():e.getRegion()==H.AppSettings.REGION_PRIVATE&&(e.region=r),o.appSettings=e,L.isFalsy(r)?s(new D.CometChatException(m.INIT_ERROR.NO_APP_ID)):(v.setSuccessfulTimeStamp((new Date).getTime()),window.addEventListener&&(window.addEventListener("storage",v.onStorageEvent,!1),window.addEventListener("beforeunload",v.beforeUnload,!1)),o.initialzed=!0,v.appId=r,v.getInstance(r),v.setLastMessageId(0),v.shouldFallBackToPolling=!0,C.LocalStorage.getInstance().get(U.SESSION_STORE.SESSION_ID).then(function(e){null==e||null==e?(v.sessionId=U.APPINFO.platform+"-"+U.APPINFO.sdkVersionWithUnderScore+"-"+$()+"-"+(new Date).getTime(),v.addDataToSessionStorage(U.SESSION_STORE.SESSION_ID,v.getSessionId()),C.LocalStorage.getInstance().remove(U.SESSION_STORE.SESSION_ID)):(v.sessionId=e.toLocaleString(),C.LocalStorage.getInstance().remove(U.SESSION_STORE.SESSION_ID),v.addDataToSessionStorage(U.SESSION_STORE.SESSION_ID,v.getSessionId())),C.LocalStorage.getInstance().get("appId").then(function(e){if(null==e||null==e)v.appId=r,v.getInstance(r),C.LocalStorage.getInstance().set("appId",r),n(!0);else{var t=e.toLocaleString();t===r?(v.appId=t,v.getInstance(t),C.LocalStorage.getInstance().get("user").then(function(e){e?(v.isLoggedOut=!1,v.user=new S.Me(e),v.setAuthToken(v.user.getAuthToken()),e.jwt&&(v.jwt=e.jwt),n(!0),C.LocalStorage.getInstance().get("app_settings").then(function(e){e&&(e[U.APP_SETTINGS.KEYS.MODE]&&(v.mode=e[U.APP_SETTINGS.KEYS.MODE]),e[U.APP_SETTINGS.KEYS.SETTINGS_HASH]&&(v.settingsHash=e[U.APP_SETTINGS.KEYS.SETTINGS_HASH]),e[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]&&(v.settingsHashReceivedAt=e[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]),e[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]&&(v.analyticsHost=e[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]),e[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]&&(v.analyticsVersion=e[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]),v.isAnalyticsDisabled=!!e[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED],e.hasOwnProperty(U.APP_SETTINGS.KEYS.DENY_FALLBACK_TO_POLLING)&&(v.shouldFallBackToPolling=!1),v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),e[U.APP_SETTINGS.KEYS.POLLING_ENABLED]?(v.pollingEnabled=!0,e[U.APP_SETTINGS.KEYS.POLLING_INTERVAL]&&(v.pollingInterval=e[U.APP_SETTINGS.KEYS.POLLING_INTERVAL]),o.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.pollingMessagesTimestamp=Math.floor((new Date).getTime()/1e3),v.fetchMessages(),v.startMessagesTimer())):Z&&!Z.connection&&(v.pollingEnabled=!1,v.isConnectingFromInit=!0,v.XMPPLogin(v.user,function(){n(!0)},function(){s("error in connecting to xmpp server")})))})):n(!0)})):o.clearCache().then(function(){v.apiKey=void 0,v.user=void 0,v.authToken=void 0,v.cometChat=void 0,v.mode=void 0,g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),v.appId=r,C.LocalStorage.getInstance().set("appId",r),v.getInstance(r),n(!0)})}i.KeyStore.getInstance().get("deviceId").then(function(e){if(null==e){var t=$(),n=(new Date).getTime(),s=r+"_"+t+"_"+n;i.KeyStore.getInstance().set("deviceId",s)}})})}))}catch(e){s(new D.CometChatException(e))}})},v.isInitialized=function(){try{return this.initialzed}catch(e){L.Logger.error("CometChat: isInitialized",e)}},v.getInstance=function(e){try{return this.cometChat||(this.cometChat=new v(e)),this.cometChat}catch(e){L.Logger.error("CometChat: getInstance",e)}},v.registerTokenForPushNotification=function(E,d){var h=this;return new Promise(function(u,l){try{v.keyStore.get("deviceId").then(function(e){var t="",n=e,s=U.APPINFO.platform,r=U.APPINFO.sdkVersion,o=U.APPINFO.apiVersion;if(navigator&&(t=navigator.userAgent),null==n){var i=$(),a=(new Date).getTime();n=h.appId+"_"+i+"_"+a,v.keyStore.set("deviceId",n)}var c={platform:s,deviceId:n,appInfo:{version:r,apiVersion:o,userAgent:t,pushNotification:{fcmDeviceToken:E,settings:d}}};p.makeApiCall("updateMyDetails",{},c,!1).then(function(e){u("Token Registration successful")},function(e){l(new D.CometChatException(e.error))}).catch(function(e){l(new D.CometChatException(e))})})}catch(e){l(new D.CometChatException(e))}})},v.pushToLoginListener=function(t,n){Z.loginHandlers.map(function(e){try{if(e._eventListener)switch(n){case"Login_Success":L.isFalsy(e._eventListener.loginSuccess)||e._eventListener.loginSuccess(t);break;case"Login_Failure":L.isFalsy(e._eventListener.loginFailure)||e._eventListener.loginFailure(t);break;case"Logout_Success":L.isFalsy(e._eventListener.logoutSuccess)||e._eventListener.logoutSuccess()}}catch(e){L.Logger.error("XMPPConnectionHandlers: onConnected Status",e)}})},v.login=function(){for(var c=this,u=[],e=0;e<arguments.length;e++)u[e]=arguments[e];return new Promise(function(i,a){try{if(v.isLoggedOut=!1,v.pollingMessagesId=0,v.loginInProgress){var t=new D.CometChatException(m.LOGIN_ERROR.REQUEST_IN_PROGRESS);return a(t)}v.loginInProgress=!0,v.isConnectingFromInit=!1,v.localStorage.get("appId").then(function(e){if(null==e||null==e){var t=new D.CometChatException(m.LOGIN_ERROR.NOT_INITIALIZED);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}var n=e.toLocaleString();if(c.getInstance(n),v.appId=n,C.LocalStorage.getInstance().set("appId",n),"object"==typeof u[0]){var s=u[0];u[0].hasOwnProperty("authToken")?u[0]=s.authToken:u[0].hasOwnProperty("username")&&u[0].hasOwnProperty("apiKey")&&(u[0]=s.username,u[1]=s.apiKey)}if(2==u.length){if(L.isFalsy(u[0])||L.isFalsy(u[1])){t=new D.CometChatException(m.ERRORS.PARAMETER_MISSING);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}}else{if(1!=u.length){t=new D.CometChatException(m.ERRORS.PARAMETER_MISSING);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}if(L.isFalsy(u[0])){var t=new D.CometChatException(m.ERRORS.PARAMETER_MISSING);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}}if(L.isFalsy(c.getAppId())){t=new D.CometChatException(m.LOGIN_ERROR.NOT_INITIALIZED);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}return v.localStorage.get("user").then(function(o){if(2==u.length){v.isSecure=!1,v.apiKey=u[1];var e=u[0];if(null!=o&&o.uid!==u[0])v.messagesStore.clearStore().then(function(){v.userStore.clearStore().then(function(){v.localStorage.clearStore().then(function(){g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),v.generateAuthToken(e).then(function(e){v.user=new S.Me(e),v.setAuthToken(v.user.getAuthToken()),v.getLoggedInUser().then(function(e){(v.user=new S.Me(e)).setAuthToken(v.authToken),v.setAuthToken(v.user.getAuthToken()),B.ExtensionController.hookOnLogin(v.user);var t=v.user;t.setStatus(U.PresenceConstatnts.STATUS.ONLINE),v.localStorage.set("user",t);var n=new S.User(t);i(n),v.isConnectingFromInit||v.internalRestart||v.pushToLoginListener(n,"Login_Success"),v.loginInProgress=!1,v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),v.isPollingEnabled()?(v.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.pollingMessagesTimestamp=Math.floor((new Date).getTime()/1e3),v.fetchMessages(),v.startMessagesTimer())):v.XMPPLogin(v.user,i,a)},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})})})});else{if(!L.isFalsy(v.authToken)){B.ExtensionController.hookOnLogin(v.user);var t=new S.User(c.user);return v.internalRestart||v.pushToLoginListener(t,"Login_Success"),v.loginInProgress=!1,i(t)}if(!L.isFalsy(e)){if(L.isFalsy(v.apiKey)){var n=new D.CometChatException(m.LOGIN_ERROR.UNAUTHORISED);return v.internalRestart||v.pushToLoginListener(n,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(n)}c.generateAuthToken(e).then(function(e){c.user=new S.Me(e),c.setAuthToken(v.user.getAuthToken()),c.getLoggedInUser().then(function(e){c.user=new S.Me(e),c.user.setAuthToken(v.authToken),c.setAuthToken(c.user.getAuthToken()),B.ExtensionController.hookOnLogin(v.user),g.XMPPConnectionHelper.getInstance().XMPPDisconnect();var t=c.user;t.setStatus(U.PresenceConstatnts.STATUS.ONLINE),c.localStorage.set("user",t);var n=new S.User(t);i(n),v.isConnectingFromInit||v.internalRestart||v.pushToLoginListener(n,"Login_Success"),v.loginInProgress=!1,v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),v.isPollingEnabled()?(c.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.pollingMessagesTimestamp=Math.floor((new Date).getTime()/1e3),v.fetchMessages(),v.startMessagesTimer())):c.XMPPLogin(c.user,i,a)},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})}}}else v.authToken=u[0],v.isSecure=!0,c.getLoggedInUser().then(function(e){if(e.authToken!=u[0]){var s=c;s.messagesStore.clearStore().then(function(){s.userStore.clearStore().then(function(){s.localStorage.clearStore().then(function(){g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),s.getLoggedInUser().then(function(e){(v.user=new S.Me(e)).setAuthToken(v.authToken),v.setAuthToken(v.user.getAuthToken());var t=v.user;t.setStatus(U.PresenceConstatnts.STATUS.ONLINE),s.localStorage.set("user",t);var n=new S.User(t);i(n),v.isConnectingFromInit||v.internalRestart||v.pushToLoginListener(n,"Login_Success"),v.loginInProgress=!1,v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),v.isPollingEnabled()?(s.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.pollingMessagesTimestamp=Math.floor((new Date).getTime()/1e3),v.fetchMessages(),v.startMessagesTimer())):v.XMPPLogin(new S.Me(e),i,a)},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})})})})}else{if(o){var t=new S.User(e);return v.internalRestart||v.pushToLoginListener(t,"Login_Success"),v.loginInProgress=!1,i(t)}(v.user=new S.Me(e)).setAuthToken(v.authToken),v.setAuthToken(v.user.getAuthToken());var n=v.user;n.setStatus(U.PresenceConstatnts.STATUS.ONLINE),v.localStorage.set("user",n);var r=new S.User(n);i(r),v.isConnectingFromInit||v.internalRestart||v.pushToLoginListener(r,"Login_Success"),v.loginInProgress=!1,v.didAnalyticsPingStart()||v.isAnalyticsDisabled||(v.pingAnalytics(),v.startAnalyticsPingTimer()),v.isPollingEnabled()?(v.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,v.didMessagesPollingStart()||(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}}),v.pollingMessagesTimestamp=Math.floor((new Date).getTime()/1e3),v.fetchMessages(),v.startMessagesTimer())):v.XMPPLogin(new S.Me(e),i,a)}},function(e){return v.internalRestart||v.pushToLoginListener(e,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(e)})})})}catch(e){t=new D.CometChatException(e);return v.internalRestart||v.pushToLoginListener(t,"Login_Failure"),v.loginInProgress=!1,v.isLoggedOut=!0,a(t)}})},v.sendMessage=function(u){var e=this;return new Promise(function(a,c){return l(e,void 0,void 0,function(){var t,n,s,r,o,i=this;return E(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),u instanceof f.TextMessage||u instanceof _.MediaMessage||u instanceof G.CustomMessage||(u=u[U.MessageConstatnts.KEYS.ATTATCHMENT]?(t=U.MessageConstatnts.TYPE.FILE,L.isImage(u[U.MessageConstatnts.KEYS.ATTATCHMENT])?t=U.MessageConstatnts.TYPE.IMAGE:L.isAudio(u[U.MessageConstatnts.KEYS.ATTATCHMENT])?t=U.MessageConstatnts.TYPE.AUDIO:L.isVideo(u[U.MessageConstatnts.KEYS.ATTATCHMENT])&&(t=U.MessageConstatnts.TYPE.VIDEO),new _.MediaMessage(u[U.MessageConstatnts.KEYS.RECEIVER_ID],u[U.MessageConstatnts.KEYS.ATTATCHMENT],t,u[U.MessageConstatnts.KEYS.RECEIVER_TYPE])):new f.TextMessage(u[U.MessageConstatnts.KEYS.RECEIVER_ID],u[U.MessageConstatnts.KEYS.TEXT],u[U.MessageConstatnts.KEYS.RECEIVER_TYPE])),[4,B.ExtensionController.hookBeforeMessageSent(u)];case 1:return n=e.sent(),u=n,(s=L.validateMessage(u))instanceof D.CometChatException?(c(s),[2]):(u.receiver=u.receiverId,delete u.receiverId,r=u.parentMessageId,[2,p.makeApiCall(r?"sendMessageInThread":"sendMessage",r?{parentId:r}:{},u,u instanceof _.MediaMessage).then(function(s){return l(i,void 0,void 0,function(){var t,n;return E(this,function(e){switch(e.label){case 0:return t=T.MessageController.trasformJSONMessge(s.data),[4,B.ExtensionController.hookAfterMessageSent(t)];case 1:return n=e.sent(),v.setLastMessageId((t=n).id),a(t),[2]}})})},function(e){c(new D.CometChatException(e.error))})]);case 2:return o=e.sent(),c(new D.CometChatException(o)),[3,3];case 3:return[2]}})})})},v.sendDirectMessage=function(e){try{return Object.assign(e,{receiverType:U.MessageConstatnts.RECEIVER_TYPE.USER}),this.sendMessage(e)}catch(e){L.Logger.error("CometChat: sendDirectMessage",e)}},v.sendGroupMessage=function(e){try{return Object.assign(e,{receiverType:U.MessageConstatnts.RECEIVER_TYPE.GROUP}),this.sendMessage(e)}catch(e){L.Logger.error("CometChat: sendGroupMessage",e)}},v.sendMediaMessage=function(e){try{return this.sendMessage(e)}catch(e){L.Logger.error("CometChat: sendMediaMessage",e)}},v.sendCustomMessage=function(e){try{return this.sendMessage(e)}catch(e){L.Logger.error("CometChat: sendCustomMessage",e)}},v.getLastDeliveredMessageId=function(){return l(this,void 0,void 0,function(){var t;return E(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,P.MessageListnerMaping.getInstance().get("all")];case 1:return[2,e.sent()];case 2:return t=e.sent(),L.Logger.error("CometChat: getLastDeliveredMessageId",t),[3,3];case 3:return[2]}})})},v.startTyping=function(e){try{if(L.isFalsy(e))return;var n,s=this.RECEIVER_TYPE.USER,r={};if(e instanceof M.TypingIndicator)n=e.getReceiverId(),s=e.getReceiverType(),r=e.getMetadata();else{if(!e.hasOwnProperty(U.TYPING_NOTIFICATION.RECEIVER_ID))return;n=e[U.TYPING_NOTIFICATION.RECEIVER_ID],e.hasOwnProperty(U.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(s=e[U.TYPING_NOTIFICATION.RECEIVER_TYPE]),e.hasOwnProperty(U.TYPING_NOTIFICATION.META)&&(r=e[U.TYPING_NOTIFICATION.META])}if(L.isFalsy(n))return;s=s==this.RECEIVER_TYPE.USER?U.XMPP.CONVERSATION.TYPE.CHAT:U.XMPP.CONVERSATION.TYPE.GROUP_CHAT,(b.TypingNotificationController.getTypingStartedMap(n)&&L.getCurrentTime()-b.TypingNotificationController.getTypingStartedMap(n)>=1e3*U.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==b.TypingNotificationController.getTypingStartedMap(n))&&L.getAppSettings().then(function(e){var t=v.getMode();if(L.isFalsy(t)||t&&t===U.APP_SETTINGS.KEYS.DEFAULT_MODE){switch(s){case U.XMPP.CONVERSATION.TYPE.CHAT:Z.sendTypingStarted(L.format(U.XMPP.bare_jid_string,v.getAppId(),n,L.getJidHost(e)),s,r);break;case U.XMPP.CONVERSATION.TYPE.GROUP_CHAT:Z.sendTypingStarted(L.format(U.XMPP.muc_jid_string,v.getAppId(),n,e[U.APP_SETTINGS.KEYS.GROUP_SERVICE],L.getJidHost(e)),s,r)}return b.TypingNotificationController.addTypingStarted(n),void b.TypingNotificationController.removeTypingEnded(n)}},function(e){})}catch(e){L.Logger.error("CometChat: startTyping",e)}},v.endTyping=function(e){try{if(!L.isFalsy(e)){var n,s=this.RECEIVER_TYPE.USER,r={};if(e instanceof M.TypingIndicator)n=e.getReceiverId(),s=e.getReceiverType(),r=e.getMetadata();else{if(!e.hasOwnProperty(U.TYPING_NOTIFICATION.RECEIVER_ID))return;n=e[U.TYPING_NOTIFICATION.RECEIVER_ID],e.hasOwnProperty(U.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(s=e[U.TYPING_NOTIFICATION.RECEIVER_TYPE]),s=s==this.RECEIVER_TYPE.USER?U.XMPP.CONVERSATION.TYPE.CHAT:U.XMPP.CONVERSATION.TYPE.GROUP_CHAT,e.hasOwnProperty(U.TYPING_NOTIFICATION.META)&&(r=e[U.TYPING_NOTIFICATION.META])}if(L.isFalsy(n))return;s=s==this.RECEIVER_TYPE.USER?U.XMPP.CONVERSATION.TYPE.CHAT:U.XMPP.CONVERSATION.TYPE.GROUP_CHAT,b.TypingNotificationController.getTypingStartedMap(n)&&L.getCurrentTime()-b.TypingNotificationController.getTypingStartedMap(n)<1e3*U.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(b.TypingNotificationController.getTypingEndedMap(n)&&L.getCurrentTime()-b.TypingNotificationController.getTypingEndedMap(n)>=1e3*U.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==b.TypingNotificationController.getTypingEndedMap(n))&&L.getAppSettings().then(function(e){var t=v.getMode();if(L.isFalsy(t)||t&&t===U.APP_SETTINGS.KEYS.DEFAULT_MODE){switch(s){case U.XMPP.CONVERSATION.TYPE.CHAT:Z.sendTypingPaused(L.format(U.XMPP.bare_jid_string,v.getAppId(),n,L.getJidHost(e)),s,r);break;case U.XMPP.CONVERSATION.TYPE.GROUP_CHAT:Z.sendTypingPaused(L.format(U.XMPP.muc_jid_string,v.getAppId(),n,e[U.APP_SETTINGS.KEYS.GROUP_SERVICE],L.getJidHost(e)),s,r)}return b.TypingNotificationController.addTypingEnded(n),void b.TypingNotificationController.removeTypingStarted(n)}},function(e){})}}catch(e){L.Logger.error("CometChat: endTyping",e)}},v.markAsRead=function(e,t,n){try{g.XMPPConnectionHelper.getInstance().markAsRead(t,n,e)}catch(e){L.Logger.error("CometChat: markAsRead",e)}},v.markAsDelivered=function(e,t,n){try{g.XMPPConnectionHelper.getInstance().markAsDelivered(t,n,e)}catch(e){L.Logger.error("CometChat: markAsDelivered",e)}},v.getMessageDetails=function(e){return new Promise(function(t,n){try{L.isFalsy(e)?n(new D.CometChatException(m.ERRORS.PARAMETER_MISSING)):p.makeApiCall("getMessageDetails",{messageId:e}).then(function(e){t(T.MessageController.trasformJSONMessge(e.data))},function(e){L.Logger.error("CometChat:GetMessageDetails:",e),n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getMessageReceipts=function(s){return new Promise(function(t,n){try{var e=L.validateMsgId(s);if(e instanceof D.CometChatException)return void n(e);L.isFalsy(s)?n(new D.CometChatException(m.ERRORS.PARAMETER_MISSING)):p.makeApiCall("getMessageDetails",{messageId:s}).then(function(e){T.MessageController.getReceiptsFromJSON(e.data).then(function(e){t(e)},function(e){n(new D.CometChatException(e))})},function(e){L.Logger.error("CometChat:GetMessageDetails:",e),n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getUnreadMessageCount=function(n){void 0===n&&(n=!1);var r=0;return new Promise(function(s,t){try{var e=L.validateHideMessagesFromBlockedUsers(n);if(e instanceof D.CometChatException)return void t(e);n&&(r=1),p.makeApiCall("getMessages",{},{unread:1,count:1,hideMessagesFromBlockedUsers:r}).then(function(e){var t={},n={};e.data.map(function(e){e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==U.MessageConstatnts.RECEIVER_TYPE.GROUP?n[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]:t[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),s({users:t,groups:n})},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getUnreadMessageCountForAllUsers=function(s){void 0===s&&(s=!1);var r=0;return new Promise(function(n,t){try{var e=L.validateHideMessagesFromBlockedUsers(s);if(e instanceof D.CometChatException)return void t(e);s&&(r=1),p.makeApiCall("getMessages",{},{hideMessagesFromBlockedUsers:r,receiverType:U.MessageConstatnts.RECEIVER_TYPE.USER,unread:1,count:1}).then(function(e){var t={};e.data.map(function(e){t[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),n(h({},t))},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getUnreadMessageCountForAllGroups=function(s){void 0===s&&(s=!1);var r=0;return new Promise(function(n,t){try{var e=L.validateHideMessagesFromBlockedUsers(s);if(e instanceof D.CometChatException)return void t(e);s&&(r=1),p.makeApiCall("getMessages",{},{hideMessagesFromBlockedUsers:r,receiverType:U.MessageConstatnts.RECEIVER_TYPE.GROUP,unread:1,count:1}).then(function(e){var t={};e.data.map(function(e){e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==U.MessageConstatnts.RECEIVER_TYPE.GROUP&&(t[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT])}),n(h({},t))},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getUnreadMessageCountForUser=function(r,o){void 0===o&&(o=!1);var i=0;return new Promise(function(n,t){try{var e=L.validateId(r,"user");if(e instanceof D.CometChatException)return void t(e);var s=L.validateHideMessagesFromBlockedUsers(o);if(s instanceof D.CometChatException)return void t(s);o&&(i=1),p.makeApiCall("getUserMessages",{listId:r},{hideMessagesFromBlockedUsers:i,unread:1,count:1,uid:r}).then(function(e){var t={};e.data.map(function(e){t[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),n(h({},t))},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getUnreadMessageCountForGroup=function(r,o){void 0===o&&(o=!1);var i=0;return new Promise(function(n,t){try{var e=L.validateId(r,"group");if(e instanceof D.CometChatException)return void t(e);var s=L.validateHideMessagesFromBlockedUsers(o);if(s instanceof D.CometChatException)return void t(s);o&&(i=1),p.makeApiCall("getGroupMessages",{listId:r},{hideMessagesFromBlockedUsers:i,unread:1,count:1,guid:r}).then(function(e){var t={};e.data.map(function(e){e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==U.MessageConstatnts.RECEIVER_TYPE.GROUP&&(t[e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=e[U.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT])}),n(h({},t))},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.editMessage=function(s){return new Promise(function(t,n){try{var e=L.validateMsgId(s.getId());if(e instanceof D.CometChatException)return void n(e);p.makeApiCall("updateMessage",{messageId:s.getId()},s).then(function(e){t(T.MessageController.trasformJSONMessge(e.data).getActionOn())},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.deleteMessage=function(s){return new Promise(function(t,n){try{var e=L.validateMsgId(s);if(e instanceof D.CometChatException)return void n(e);p.makeApiCall("deleteMessage",{messageId:s},{id:s}).then(function(e){t(T.MessageController.trasformJSONMessge(e.data).getActionOn())},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getPreviousMessagesByTimestamp=function(e,s){return new Promise(function(t,n){try{L.isFalsy(s)?n(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):T.MessageController.getAllMessage(e,s,U.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,U.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(new D.CometChatException(e))})}catch(e){n(new D.CometChatException(e))}})},v.getPreviousMessagesById=function(e,s){return new Promise(function(t,n){try{L.isFalsy(s)?n(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.PARAMETER_ERROR.PARAMETER_REQUIRED),"MESSAGE_ID","MESSAGE_ID","messageId")))):T.MessageController.getAllMessage(e,s,U.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,U.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(e){return t(e)},function(e){return n(new D.CometChatException(e))})}catch(e){n(new D.CometChatException(e))}})},v.getNextMessagesByTimestamp=function(e,s){return new Promise(function(t,n){try{L.isFalsy(s)?n(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):T.MessageController.getAllMessage(e,s,U.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,U.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(new D.CometChatException(e))})}catch(e){n(new D.CometChatException(e))}})},v.getNextMessagesById=function(e,s){return new Promise(function(t,n){try{L.isFalsy(s)?n(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.PARAMETER_ERROR.PARAMETER_REQUIRED),"MESSAGE_ID","MESSAGE_ID","messageId")))):T.MessageController.getAllMessage(e,s,U.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,U.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(e){return t(e)},function(e){return n(new D.CometChatException(e))})}catch(e){n(new D.CometChatException(e))}})},v.createUser=function(r,o){return new Promise(function(n,t){try{if(L.isFalsy(o))return void t(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.GENERAL_ERROR.INVALID),"AUTH_KEY","AUTH_KEY","AUTH_KEY","AUTH_KEY"))));v.apiKey=o;var e=L.validateCreateUser(r);if(e instanceof D.CometChatException)return void t(e);if(!(r instanceof S.User)){var s=void 0;if(!r.hasOwnProperty(U.UserConstants.UID))return void t(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));if(!r.hasOwnProperty(U.UserConstants.NAME))return void t(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));s=new S.User(r[U.UserConstants.UID],r[U.UserConstants.NAME]),r.hasOwnProperty(U.UserConstants.AVATAR)&&s.setAvatar(r[U.UserConstants.AVATAR]),r.hasOwnProperty(U.UserConstants.ROLE)&&s.setRole(r[U.UserConstants.ROLE]),r.hasOwnProperty(U.UserConstants.META_DATA)&&s.setMetadata(r[U.UserConstants.META_DATA]),r.hasOwnProperty(U.UserConstants.LINK)&&s.setLink(r[U.UserConstants.LINK]),r.hasOwnProperty(U.UserConstants.STATUS_MESSAGE)&&s.setStatusMessage(r[U.UserConstants.STATUS_MESSAGE]),r.hasOwnProperty(U.UserConstants.TAGS)&&s.setTags(r[U.UserConstants.TAGS]),r=s}p.makeApiCall("createUser",{},r).then(function(e){var t=c.UsersController.trasformJSONUser(e.data);n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.updateUser=function(s,i){var a=this;return new Promise(function(r,t){try{if(L.isFalsy(i))return void t(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.GENERAL_ERROR.INVALID),"AUTH_KEY","AUTH_KEY","AUTH_KEY","AUTH_KEY"))));v.apiKey=i;var e=L.validateUpdateUser(s);if(e instanceof D.CometChatException)return void t(e);if(!(s instanceof S.User)){var n=void 0;if(!s.hasOwnProperty(U.UserConstants.UID))return void t(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));n=new S.User(s[U.UserConstants.UID]),s.hasOwnProperty(U.UserConstants.NAME)&&n.setName(s[U.UserConstants.NAME]),s.hasOwnProperty(U.UserConstants.AVATAR)&&n.setAvatar(s[U.UserConstants.AVATAR]),s.hasOwnProperty(U.UserConstants.ROLE)&&n.setRole(s[U.UserConstants.ROLE]),s.hasOwnProperty(U.UserConstants.META_DATA)&&n.setMetadata(s[U.UserConstants.META_DATA]),s.hasOwnProperty(U.UserConstants.LINK)&&n.setLink(s[U.UserConstants.LINK]),s.hasOwnProperty(U.UserConstants.STATUS_MESSAGE)&&n.setStatusMessage(s[U.UserConstants.STATUS_MESSAGE]),s.hasOwnProperty(U.UserConstants.TAGS)&&n.setTags(s[U.UserConstants.TAGS]),s=n}var o=s.uid;p.makeApiCall("updateUser",{uid:o},s).then(function(s){if(a.user&&o.toLocaleLowerCase()===a.user.getUid().toLocaleLowerCase())C.LocalStorage.getInstance().get("user").then(function(e){if(e){var t=c.UsersController.trasformJSONUser(s.data),n=s.data;n.wsChannel=e.wsChannel,n.authToken=v.authToken,n.status=U.PresenceConstatnts.STATUS.ONLINE,e.jwt&&(n.jwt=e.jwt),v.user=new S.Me(n),a.localStorage.set("user",v.user),r(t)}});else{var e=c.UsersController.trasformJSONUser(s.data);r(e)}},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.updateCurrentUserDetails=function(r){var o=this;return new Promise(function(s,t){try{r.uid=o.user.uid;var e=L.validateUpdateUser(r);if(e instanceof D.CometChatException)return void t(e);if(!(r instanceof S.User)){var n=void 0;r.hasOwnProperty(U.UserConstants.UID)&&(n=new S.User(r[U.UserConstants.UID])),r.hasOwnProperty(U.UserConstants.NAME)&&n.setName(r[U.UserConstants.NAME]),r.hasOwnProperty(U.UserConstants.AVATAR)&&n.setAvatar(r[U.UserConstants.AVATAR]),r.hasOwnProperty(U.UserConstants.ROLE)&&n.setRole(r[U.UserConstants.ROLE]),r.hasOwnProperty(U.UserConstants.META_DATA)&&n.setMetadata(r[U.UserConstants.META_DATA]),r.hasOwnProperty(U.UserConstants.LINK)&&n.setLink(r[U.UserConstants.LINK]),r.hasOwnProperty(U.UserConstants.STATUS_MESSAGE)&&n.setStatusMessage(r[U.UserConstants.STATUS_MESSAGE]),r.hasOwnProperty(U.UserConstants.TAGS)&&n.setTags(r[U.UserConstants.TAGS]),r=n}p.makeApiCall("updateMyDetails",{},r).then(function(e){var t=c.UsersController.trasformJSONUser(e.data),n=v.user=new S.Me(e.data);n.setStatus(U.PresenceConstatnts.STATUS.ONLINE),v.localStorage.set("user",n),s(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getUser=function(s){return new Promise(function(n,t){try{"object"==typeof s&&s.hasOwnProperty("uid")&&(s=s.uid);var e=L.validateId(s,"user");if(e instanceof D.CometChatException)return void t(e);p.makeApiCall("user",{uid:s}).then(function(e){var t=c.UsersController.trasformJSONUser(e.data);n(t)}).catch(function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.getLoggedInUser=function(){var d=this;return new Promise(function(l,E){try{v.localStorage.get("user").then(function(e){if(e)l(v.user=new S.Me(e));else{var o="",i="",a=U.APPINFO.platform,c=U.APPINFO.sdkVersion,u=U.APPINFO.apiVersion;v.keyStore.get("deviceId").then(function(e){if(i=e,navigator&&(o=navigator.userAgent),null==i){var t=$(),n=(new Date).getTime();i=d.appId+"_"+t+"_"+n,v.keyStore.set("deviceId",i)}var s={version:c,apiVersion:u,userAgent:o};L.isFalsy(d.platform)||(s.platform=d.platform),L.isFalsy(d.language)||(s.language=d.language),L.isFalsy(d.resource)||(s.resource=d.resource);var r={platform:a,deviceId:i,appInfo:s};p.makeApiCall("updateMyDetails",{},r,!1).then(function(e){e.data.jwt&&(v.jwt=e.data.jwt);var t=e.data.settings;t&&(C.LocalStorage.getInstance().set("app_settings",t),t[U.APP_SETTINGS.KEYS.MODE]&&v.setMode(t[U.APP_SETTINGS.KEYS.MODE]),t[U.APP_SETTINGS.KEYS.SETTINGS_HASH]&&(v.settingsHash=t[U.APP_SETTINGS.KEYS.SETTINGS_HASH]),t[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]&&(v.settingsHashReceivedAt=t[U.APP_SETTINGS.KEYS.SETTINGS_HASH_RECEIVED_AT]),t[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]&&(v.analyticsHost=t[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]),t[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]&&(v.analyticsVersion=t[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]),v.isAnalyticsDisabled=!!t[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED],t.hasOwnProperty(U.APP_SETTINGS.KEYS.DENY_FALLBACK_TO_POLLING)&&(v.shouldFallBackToPolling=!1),v.pollingEnabled=t[U.APP_SETTINGS.KEYS.POLLING_ENABLED],v.isPollingEnabled()&&t[U.APP_SETTINGS.KEYS.POLLING_INTERVAL]&&(v.pollingInterval=t[U.APP_SETTINGS.KEYS.POLLING_INTERVAL])),l(new S.Me(e.data))},function(e){E(new D.CometChatException(e.error))}).catch(function(e){E(new D.CometChatException(e))})})}})}catch(e){E(new D.CometChatException(e))}})},v.getLoggedinUser=function(){return new Promise(function(t,n){try{v.localStorage.get("user").then(function(e){t(e?new S.User(e):null)},function(e){t(null)})}catch(e){n(new D.CometChatException(e))}})},v.blockUsers=function(s){return new Promise(function(t,n){try{var e=L.validateArray(s,"blockUsers");if(e instanceof D.CometChatException)return void n(e);L.isFalsy(s)?n(new D.CometChatException(m.USERS_REQUEST_ERRORS.EMPTY_USERS_LIST)):p.makeApiCall("blockUsers",{},{blockedUids:s}).then(function(e){t(e.data)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.unblockUsers=function(s){return new Promise(function(t,n){try{var e=L.validateArray(s,"unblockUsers");if(e instanceof D.CometChatException)return void n(e);L.isFalsy(s)?n(new D.CometChatException(m.USERS_REQUEST_ERRORS.EMPTY_USERS_LIST)):p.makeApiCall("unblockUsers",{},{blockedUids:s}).then(function(e){t(e.data)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getConversation=function(i,a){return new Promise(function(n,s){try{var e=L.validateConversationType(a);if(e instanceof D.CometChatException)return void s(e);var t=L.validateId(i,a);if(t instanceof D.CometChatException)return void s(t);a=a.toLowerCase(),i=i.toLowerCase();var r={},o="";a===U.MessageConstatnts.RECEIVER_TYPE.GROUP?(o="getGroupConversation",r.guid=i):(o="getUserConversation",r.uid=i),p.makeApiCall(o,r).then(function(e){if(e.data){var t=e.data;n(J.ConversationController.trasformJSONConversation(t.conversationId,t.conversationType,t.lastMessage,t.conversationWith,t.unreadMessageCount))}else s(new D.CometChatException(JSON.parse(L.format(JSON.stringify(U.ConversationErrors.CONVERSATION_NOT_FOUND),a,i))))},function(e){s(new D.CometChatException(e.error))})}catch(e){s(new D.CometChatException(e))}})},v.deleteConversation=function(i,a){return new Promise(function(t,n){try{var e=L.validateConversationType(a);if(e instanceof D.CometChatException)return void n(e);var s=L.validateId(i,a);if(s instanceof D.CometChatException)return void n(s);var r={},o="";a=a.toLowerCase(),i=i.toLowerCase(),a===U.MessageConstatnts.RECEIVER_TYPE.GROUP?(o="deleteGroupConversation",r.guid=i):(o="deleteUserConversation",r.uid=i),p.makeApiCall(o,r).then(function(e){t("Conversation deleted successfully.")},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.createGroup=function(r){return new Promise(function(t,n){try{var e=L.validateCreateGroup(r);if(e instanceof D.CometChatException)return void n(e);if(!(r instanceof a.Group)){var s=void 0;if(!r.hasOwnProperty(U.GroupConstants.KEYS.GUID))return void n(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));if(!r.hasOwnProperty(U.GroupConstants.KEYS.NAME))return void n(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));if(s=new a.Group(r[U.GroupConstants.KEYS.GUID],r[U.GroupConstants.KEYS.NAME],""),r.hasOwnProperty(U.GroupConstants.KEYS.TYPE))if(r[U.GroupConstants.KEYS.TYPE].toLocaleLowerCase()==U.GroupType.Password){if(!r.hasOwnProperty(U.GroupConstants.KEYS.PASSWORD))return void n(new D.CometChatException(m.GROUP_CREATION_ERRORS.EMPTY_PASSWORD));s.setType(U.GROUP_TYPE.PASSWORD),s.setPassword(r[U.GroupConstants.KEYS.PASSWORD])}else s.setType(r[U.GroupConstants.KEYS.TYPE]);else s.setType(U.GROUP_TYPE.PUBLIC);r.hasOwnProperty(U.GroupConstants.KEYS.ICON)&&s.setIcon(r[U.GroupConstants.KEYS.ICON]),r.hasOwnProperty(U.GroupConstants.KEYS.DESCRIPTION)&&s.setDescription(r[U.GroupConstants.KEYS.DESCRIPTION]),r.hasOwnProperty(U.GroupConstants.KEYS.TAGS)&&s.setTags(r[U.GroupConstants.KEYS.TAGS]),r=s}p.makeApiCall("createGroup",{},r).then(function(e){Z.joinMuc(r),u.GroupsController.trasformJSONGroup(e.data).setHasJoined(!0),t(u.GroupsController.trasformJSONGroup(e.data))},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getGroup=function(s){return new Promise(function(t,n){try{"object"==typeof s&&s.hasOwnProperty("guid")&&(s=s.guid);var e=L.validateId(s,"group");if(e instanceof D.CometChatException)return void n(e);p.makeApiCall("getGroup",{guid:s}).then(function(e){t(u.GroupsController.trasformJSONGroup(e.data))},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.getJoinedGroups=function(){return new Promise(function(t,n){try{Z.getRooms().then(function(e){t(e)},function(e){n(e)})}catch(e){n(new D.CometChatException(e))}})},v.joinGroup=function(r,o,i){return void 0===o&&(o=U.GroupType.Public),void 0===i&&(i=""),new Promise(function(n,t){try{var s,e=L.validateJoinGroup(r,o,i);if(e instanceof D.CometChatException)return void t(e);"object"==typeof r&&(r.hasOwnProperty(U.GroupConstants.KEYS.GUID)?(r.hasOwnProperty(U.GroupConstants.KEYS.TYPE)&&(o=r[U.GroupConstants.KEYS.TYPE],r[U.GroupConstants.KEYS.TYPE].toLocaleLowerCase()===U.GroupType.Password&&r.hasOwnProperty(U.GroupConstants.KEYS.PASSWORD)&&(i=r[U.GroupConstants.KEYS.PASSWORD])),r=r[U.GroupConstants.KEYS.GUID]):t(new D.CometChatException(m.ERRORS.PARAMETER_MISSING))),s=L.isFalsy(i)?new a.Group(r,"name",o):new a.Group(r,"name",o,i),p.makeApiCall("joinGroup",s,s).then(function(e){Z.joinMuc(s);var t=u.GroupsController.trasformJSONGroup(e.data[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA][U.ActionConstatnts.ACTION_KEYS.ENTITIES][U.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][U.ActionConstatnts.ACTION_KEYS.ENTITY]);t.setHasJoined(!0),n(t)},function(e){"ERR_ALREADY_JOINED"===e.error.code&&Z.joinMuc(s),t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.updateGroup=function(r){return new Promise(function(t,n){try{var e=L.validateUpdateGroup(r);if(e instanceof D.CometChatException)return void n(e);if(!(r instanceof a.Group)){var s=void 0;if(!r.hasOwnProperty(U.GroupConstants.KEYS.GUID))return void n(new D.CometChatException(m.ERRORS.PARAMETER_MISSING));s=new a.Group(U.GroupConstants.KEYS.GUID,"",""),r.hasOwnProperty(U.GroupConstants.KEYS.TYPE)?s.setType(r[U.GroupConstants.KEYS.TYPE]):(r[U.GroupConstants.KEYS.TYPE]=U.GROUP_TYPE.PUBLIC,s.setType[U.GROUP_TYPE.PUBLIC]),r.hasOwnProperty(U.GroupConstants.KEYS.NAME)&&s.setName(r[U.GroupConstants.KEYS.NAME]),r.hasOwnProperty(U.GroupConstants.KEYS.ICON)&&s.setIcon(r[U.GroupConstants.KEYS.ICON]),r.hasOwnProperty(U.GroupConstants.KEYS.DESCRIPTION)&&s.setDescription(r[U.GroupConstants.KEYS.DESCRIPTION]),r.hasOwnProperty(U.GroupConstants.KEYS.TAGS)&&s.setTags(r[U.GroupConstants.KEYS.TAGS]),r=s}p.makeApiCall("updateGroup",r,r).then(function(e){t(u.GroupsController.trasformJSONGroup(e.data))},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.deleteGroup=function(s){return new Promise(function(t,n){try{var e=L.validateId(s,"group");if(e instanceof D.CometChatException)return void n(e);p.makeApiCall("deleteGroup",{guid:s}).then(function(e){t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.leaveGroup=function(s){return new Promise(function(t,n){try{var e=L.validateId(s,"group");if(e instanceof D.CometChatException)return void n(e);p.makeApiCall("leaveGroup",{guid:s}).then(function(e){Z.leaveMuc(s),t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.kickGroupMember=function(r,o){return new Promise(function(t,n){try{var e=L.validateId(r,"group");if(e instanceof D.CometChatException)return void n(e);var s=L.validateId(o,"user");if(s instanceof D.CometChatException)return void n(s);p.makeApiCall("kickGroupMembers",{guid:r,uid:o}).then(function(e){t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.updateGroupMemberScope=function(o,i,a){return new Promise(function(t,n){try{var e=L.validateId(o,"group");if(e instanceof D.CometChatException)return void n(e);var s=L.validateId(i,"user");if(s instanceof D.CometChatException)return void n(s);var r=L.validateScope(a);if(r instanceof D.CometChatException)return void n(r);p.makeApiCall("changeScopeOfMember",{guid:o,uid:i},{scope:a}).then(function(e){t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.banGroupMember=function(r,o){return new Promise(function(t,n){try{var e=L.validateId(r,"group");if(e instanceof D.CometChatException)return void n(e);var s=L.validateId(o,"user");if(s instanceof D.CometChatException)return void n(s);p.makeApiCall("banGroupMember",{guid:r,uid:o}).then(function(e){t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.unbanGroupMember=function(r,o){return new Promise(function(t,n){try{var e=L.validateId(r,"group");if(e instanceof D.CometChatException)return void n(e);var s=L.validateId(o,"user");if(s instanceof D.CometChatException)return void n(s);p.makeApiCall("unbanGroupMember",{guid:r,uid:o}).then(function(e){t(!0)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.addMembersToGroup=function(i,a,c){var u=[],l=[],E=[],d=[];return new Promise(function(e,t){try{var n=L.validateId(i,"group");if(n instanceof D.CometChatException)return void t(n);var s=L.validateArray(a,"groupMembers");if(s instanceof D.CometChatException)return void t(s);if(c){var r=L.validateArray(c,"bannedMembers");if(r instanceof D.CometChatException)return void t(r)}L.isFalsy(a)&&L.isFalsy(c)?t(new D.CometChatException({})):L.isFalsy(a)||L.isFalsy(c)?L.isFalsy(a)?c.map(function(e){d.push(e)}):(a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(e){u.push(e.getUid())}),a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(e){l.push(e.getUid())}),a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(e){E.push(e.getUid())})):(a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(e){u.push(e.getUid())}),a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(e){l.push(e.getUid())}),a.filter(function(e){if(e.getScope()==U.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(e){E.push(e.getUid())}),c.map(function(e){d.push(e)}));var o={};L.isFalsy(u)||(o=h({},o,{admins:u})),L.isFalsy(E)||(o=h({},o,{participants:E})),L.isFalsy(l)||(o=h({},o,{moderators:l})),L.isFalsy(d)||(o=h({},o,{usersToBan:d})),p.makeApiCall("addMemebersToGroup",{guid:i},o).then(function(t){var n={};Object.keys(t.data.admins).map(function(e){t.data.admins[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[e]=U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[e]=t.data.admins[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(t.data.participants).map(function(e){t.data.participants[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[e]=U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[e]=t.data.participants[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(t.data.moderators).map(function(e){t.data.moderators[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[e]=U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[e]=t.data.moderators[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(t.data.usersToBan).map(function(e){t.data.usersToBan[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[e]=U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[e]=t.data.usersToBan[e][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][U.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),e(n)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.transferGroupOwnership=function(r,o){return new Promise(function(n,t){try{var e=L.validateId(r,"group");if(e instanceof D.CometChatException)return void t(e);var s=L.validateId(o,"user");if(s instanceof D.CometChatException)return void t(s);p.makeApiCall("transferOwnership",{guid:r},{owner:o}).then(function(e){var t;t=e&&e.data&&e.data.message?e.data.message:"Ownership transferred to user "+o+" for the group with guid "+r+".",n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.initiateCall=function(t){var e=this;return new Promise(function(n,s){if(null===e.getActiveCall())try{L.isFalsy(JSON.parse(JSON.stringify(t)).sender)?L.isFalsy(e.getActiveCall())?(t.setStatus(U.CallConstants.CALL_STATUS.INITIATED),t.receiver=t.receiverId.toString(),delete t.receiverId,p.makeApiCall("createCallSession",{},t).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);w.CallController.getInstance().initiateCall(t).then(function(e){n(t)}).catch(function(e){s(new D.CometChatException(e))})},function(e){s(new D.CometChatException(e.error))})):s(new D.CometChatException(U.CALL_ERROR.ERROR_IN_CALLING)):w.CallController.getInstance().initiateCall(t).then(function(e){n(Object.assign(t))}).catch(function(e){s(new D.CometChatException(e))})}catch(e){s(new D.CometChatException(e))}else s(new D.CometChatException(U.CALL_ERROR.CALL_ALREADY_INITIATED))})},v.acceptCall=function(s){var r=this;return new Promise(function(n,t){if(null===r.getActiveCall())try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.ONGOING,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);w.CallController.getInstance().onCallStarted(t),n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}else t(new D.CometChatException(U.CALL_ERROR.CANNOT_ACCEPT_CALL))})},v.rejectCall=function(e,t){try{switch(t){case U.CallConstants.CALL_STATUS.REJECTED:return this.rejectIncomingCall(e);case U.CallConstants.CALL_STATUS.CANCELLED:return this.cancelCall(e);case U.CallConstants.CALL_STATUS.BUSY:return this.sendBusyResponse(e);default:return this.endCall(e,!0)}}catch(e){L.Logger.error("CometChat: rejectCall",e)}},v.endCall=function(r,o){var i=this;return new Promise(function(n,t){L.isFalsy(o)&&(o=!1);var s=i.getActiveCall();if(null!==s){if(s.getSessionId()===r)try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.ENDED,s.getJoinedAt()&&(e[U.CallConstants.CALL_KEYS.CALL_JOINED_AT]=s.getJoinedAt()),p.makeApiCall("updateCallSession",{sessionid:r},e).then(function(e){o||w.CallController.getInstance().endSession();var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(t),w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onCallEnded(t),w.CallController.getInstance().endCall()},function(e){L.Logger.log("calling Log",{error:e}),o||w.CallController.getInstance().endSession(),s.setStatus(U.CallConstants.CALL_STATUS.ENDED),n(s),w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onCallEnded(s),w.CallController.getInstance().endCall()})}catch(e){t(new D.CometChatException(e))}}else o||w.CallController.getInstance().endSession(),n(null),w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onCallEnded(null),w.CallController.getInstance().endCall()})},v.getActiveCall=function(){try{return w.CallController.getInstance().getActiveCall()}catch(e){L.Logger.error("CometChat: getActiveCall",e)}},v.startCall=function(s,r,o,e){var i=this;try{var a,c,u,l,E,d,h,p,S=this.getActiveCall(),g=!1,C=!0,_=!0,f=!0,T=!0,m=!0,A=!0,I=!1,R=!1,N=U.CallConstants.CALL_MODE.DEFAULT,O=!1,y=!1,P={},M=this.user;L.getAppSettings().then(function(e){if(d=e[U.APP_SETTINGS.KEYS.WEBRTC_HOST],e.hasOwnProperty(U.APP_SETTINGS.KEYS.ANALYTICS_HOST)?P[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]=e[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]:P[U.APP_SETTINGS.KEYS.ANALYTICS_HOST]=L.format(U.ANALYTICS.analyticsHost,v.appSettings.getRegion()),e.hasOwnProperty(U.APP_SETTINGS.KEYS.ANALYTICS_VERSION)?P[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]=e[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]:P[U.APP_SETTINGS.KEYS.ANALYTICS_VERSION]=U.ANALYTICS.analyticsVersion,e.hasOwnProperty(U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED)?P[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED]=e[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED]:P[U.APP_SETTINGS.KEYS.ANALYTICS_PING_DISABLED]=!1,e.hasOwnProperty(U.APP_SETTINGS.KEYS.ANALYTICS_USE_SSL)?P[U.APP_SETTINGS.KEYS.ANALYTICS_USE_SSL]=e[U.APP_SETTINGS.KEYS.ANALYTICS_USE_SSL]:P[U.APP_SETTINGS.KEYS.ANALYTICS_USE_SSL]=!0,L.isFalsy(o)||w.CallController.getInstance().setCallListner(o),L.isFalsy(i.appSettings))w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.NOT_INITIALIZED));else if(l=i.appSettings.getRegion())if(M)if((p=new q.RTCUser(M.getUid())).setName(M.getName()),p.setAvatar(M.getAvatar()),p.setResource(v.getSessionId()),v.appId)if(E=v.appId,"string"==typeof s){if(S){var t=S.getType();g=t===U.CallConstants.CALL_TYPE.AUDIO,c=S.getSessionId()}else{if(L.isFalsy(s))return void(w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.SESSION_ID_REQUIRED)));c=("v1."+l+"."+v.getAppId()+"."+s).toLowerCase()}if(!c)return void(w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.SESSION_ID_REQUIRED)));var n={uid:M.getUid(),sessionId:c};v.getJWT(n).then(function(e){e.hasOwnProperty("token")?(p.setJWT(e.token),a=(new j.CallSettingsBuilder).setSessionID(c).enableDefaultLayout(C).setIsAudioOnlyCall(g).setUser(p).setRegion(l).setAppId(E).setDomain(d).showEndCallButton(T).showMuteAudioButton(f).showPauseVideoButton(_).showScreenShareButton(m).showModeButton(A).setMode(N).setAnalyticsSettings(P).startWithAudioMuted(I).startWithVideoMuted(R).showRecordingButton(O).startRecordingOnCallStart(y).build(),w.CallController.getInstance().startCall(a,r)):w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.JWT_NOT_FOUND))},function(e){w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(e))})}else{if(L.isFalsy(s))return void(w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.CALL_SETTINGS_REQUIRED)));if(S){t=S.getType();g=t===U.CallConstants.CALL_TYPE.AUDIO,c=S.getSessionId()}else{if(g=s.isAudioOnlyCall(),L.isFalsy(s.getSessionId()))return void(w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.SESSION_ID_REQUIRED)));c=("v1."+l+"."+v.getAppId()+"."+s.getSessionId()).toLowerCase()}if(!c)return void(w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.SESSION_ID_REQUIRED)));C=s.isDefaultLayoutEnabled(),_=s.isPauseVideoButtonEnabled(),f=s.isMuteAudioButtonEnabled(),T=s.isEndCallButtonEnabled(),m=s.isScreenShareButtonEnabled(),N=s.getMode(),h=s.getLocalizedStringObject(),u=s.getCustomCSS(),A=s.isModeButtonEnabled(),I=s.getStartWithAudioMuted(),R=s.getStartWithVideoMuted(),O=s.isRecordingButtonEnabled(),y=s.shouldStartRecordingOnCallStart();n={uid:M.getUid(),sessionId:c};v.getJWT(n).then(function(e){e.hasOwnProperty("token")?(p.setJWT(e.token),a=(new j.CallSettingsBuilder).setSessionID(c).enableDefaultLayout(C).setIsAudioOnlyCall(g).setUser(p).setRegion(l).setAppId(E).setDomain(d).showEndCallButton(T).showMuteAudioButton(f).showPauseVideoButton(_).showScreenShareButton(m).showModeButton(A).setMode(N).setLocalizedStringObject(h).setCustomCSS(u).setAnalyticsSettings(P).startWithAudioMuted(I).startWithVideoMuted(R).showRecordingButton(O).startRecordingOnCallStart(y).build(),w.CallController.getInstance().startCall(a,r)):w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.JWT_NOT_FOUND))},function(e){w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(e))})}else w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.NOT_INITIALIZED));else w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.NOT_LOGGED_IN));else w.CallController.getInstance().getCallListner()&&w.CallController.getInstance().getCallListner()._eventListener.onError(new D.CometChatException(U.CALL_ERROR.NOT_INITIALIZED))},function(e){L.Logger.error("CometChat: startCall",e)})}catch(e){L.Logger.error("CometChat: startCall",e)}},v.getCallParticipantCount=function(a,c){var u=this;return new Promise(function(o,i){try{L.getAppSettings().then(function(e){if(L.isFalsy(a))return i(new D.CometChatException(U.ProsodyApiErrors.INVALID_SESSIONID));if(L.isFalsy(c))return i(new D.CometChatException(U.ProsodyApiErrors.INVALID_TYPE));var t=u.appSettings.getRegion(),n={},s=e[U.APP_SETTINGS.KEYS.WEBRTC_HOST],r=L.format((new d.EndpointFactory).prosodyApi,U.PROSODY_API.DOMAIN_PREFIX,s,U.PROSODY_API.PATH.ROOM_SIZE);"direct"===c.toLowerCase()&&(a=("v1."+t+"."+v.getAppId()+"."+a).toLowerCase()),n[U.PROSODY_API.QUERY_PARAMETERS.DOMAIN]=s,n[U.PROSODY_API.QUERY_PARAMETERS.ROOM]=a,p.postData(r,"GET",n,{},!1).then(function(e){return e.text()}).then(function(e){var t=e?JSON.parse(e):{};return t.hasOwnProperty(U.PROSODY_API.RESPONSE.PARTICIPANTS)?o(t[U.PROSODY_API.RESPONSE.PARTICIPANTS]):o(0)}).catch(function(){var e={error:m.FETCH_ERROR.ERROR_IN_API_CALL};return i(e)})},function(e){return i(new D.CometChatException(e))})}catch(e){return i(new D.CometChatException(e))}})},v.createCallView=function(e){var t=this;try{return{prop1:this.makeCall,onMessage:function(e){w.CallController.getInstance().getCallListner()._eventListener.onCallEnded(t.getActiveCall()),v.endCall(t.getActiveCall().getSessionId(),!0).then(function(e){L.Logger.info("CometChat: createCallView",e)}).catch(function(e){L.Logger.error("CometChat: createCallView",e)})}}}catch(e){L.Logger.error("CometChat: createCallView",e)}},v.makeCall=function(e,t){try{e.setState(function(e){return h({},e,{uri:t})})}catch(e){L.Logger.error("CometChat: makeCall",e)}},v.rejectIncomingCall=function(s){return new Promise(function(n,t){try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.REJECTED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.cancelCall=function(s){var r=this;return new Promise(function(n,t){try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.CANCELLED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);r.getActiveCall().getSessionId()===s&&w.CallController.getInstance().endCallSession(),n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.sendBusyResponse=function(s){return new Promise(function(n,t){try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.BUSY,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.sendUnansweredResponse=function(s){return new Promise(function(n,t){try{var e={};e[U.CallConstants.CALL_KEYS.CALL_STATUS]=U.CallConstants.CALL_STATUS.UNANSWERED,p.makeApiCall("updateCallSession",{sessionid:s},e).then(function(e){var t=T.MessageController.trasformJSONMessge(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);g.XMPPConnectionHelper.getInstance().trigerMessageHandler(Object.assign(t,e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),n(t)},function(e){t(new D.CometChatException(e.error))})}catch(e){t(new D.CometChatException(e))}})},v.addConnectionListener=function(e,t){try{Z.addXMPPConnectionEventListener(e,t)}catch(e){L.Logger.error("CometChat: addConnectionListener",e)}},v.removeConnectionListener=function(e){try{Z.removeXMPPConnectionEventListener(e)}catch(e){L.Logger.error("CometChat: removeConnectionListener",e)}},v.addMessageListener=function(e,t){try{Z.addMessageEventListener(e,t)}catch(e){L.Logger.error("CometChat: addMessageListener",e)}},v.removeMessageListener=function(e){try{Z.removeMessageEventListener(e)}catch(e){L.Logger.error("CometChat: removeMessageListener",e)}},v.addCallListener=function(e,t){try{Z.addCallEventListener(e,t)}catch(e){L.Logger.error("CometChat: addCallListener",e)}},v.removeCallListener=function(e){try{Z.removeCallEventListener(e)}catch(e){L.Logger.error("CometChat: removeCallListener",e)}},v.addUserListener=function(e,t){try{Z.addUserEventListener(e,t)}catch(e){L.Logger.error("CometChat: addUserListener",e)}},v.removeUserListener=function(e){try{Z.removeUserEventListener(e)}catch(e){L.Logger.error("CometChat: removeUserListener",e)}},v.addGroupListener=function(e,t){try{Z.addGroupEventListener(e,t)}catch(e){L.Logger.error("CometChat: addGroupListener",e)}},v.removeGroupListener=function(e){try{Z.removeGroupEventListener(e)}catch(e){L.Logger.error("CometChat: removeGroupListener",e)}},v.addLoginListener=function(e,t){try{Z.addLoginEventListener(e,t)}catch(e){L.Logger.error("CometChat: addLoginListener",e)}},v.removeLoginListener=function(e){try{Z.removeLoginEventListener(e)}catch(e){L.Logger.error("CometChat: removeLoginListener",e)}},v.generateAuthToken=function(E){var d=this;return new Promise(function(s,r){try{var o={},i="",a="",c=U.APPINFO.platform,u=U.APPINFO.sdkVersion,l=U.APPINFO.apiVersion;navigator&&(a=navigator.userAgent),v.keyStore.get("deviceId").then(function(e){if(null==(i=e)){var t=$(),n=(new Date).getTime();i=d.appId+"_"+t+"_"+n,v.keyStore.set("deviceId",i)}o={platform:c,deviceId:i,appInfo:{version:u,apiVersion:l,userAgent:a}},p.makeApiCall("authToken",{uid:E},o).then(function(e){s(e.data)}).catch(function(e){r(new D.CometChatException(e.error))})},function(e){L.Logger.error("Got error while fetching data from key store",e)})}catch(e){r(new D.CometChatException(e))}})},v.setAccidentalDisconnect=function(e){v.accidentalDisconnect=e},v.generateNewSessionId=function(){v.sessionId=U.APPINFO.platform+"-"+U.APPINFO.sdkVersionWithUnderScore+"-"+$()+"-"+(new Date).getTime(),v.addDataToSessionStorage(U.SESSION_STORE.SESSION_ID,v.getSessionId())},v.tryReconnectingToWSOrStartPolling=function(){0===this.WSReconnectionStartTime&&(this.WSReconnectionStartTime=(new Date).getTime()),(new Date).getTime()-v.WSReconnectionStartTime<v.WSReconnectionPeriod&&v.WSCurrentReconnectionCount<v.WSMaxReconnectionLimit&&!v.pollingEnabledInternally&&!v.isPollingEnabled()?(v.WSCurrentReconnectionCount+=1,this.XMPPLogin(v.user,function(){L.Logger.info("XMPPLogin","successful")},function(){L.Logger.info("XMPPLogin","unsuccessful")})):(v.shouldFallBackToPolling&&v.startPolling(!!v.accidentalDisconnect),v.WSReconnectionInProgress||v.startWSReconnectionTimer())},v.startPolling=function(e){if(v.currentConnectionStatus=U.CONNECTION_STATUS.FEATURE_THROTTLED,!v.didMessagesPollingStart()){Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onFeatureThrottled)||e._XMPPeventListener.onFeatureThrottled())}catch(e){L.Logger.error("XMPPConnectionHandlers: Feature Throttled Status",e)}});var t=void 0;if(e){var n=v.getLastMessageId();0===(v.pollingMessagesId=n||0)&&(t=v.getSuccessfultTimeStamp())}else t=0<v.WSReconnectionStartTime?v.WSReconnectionStartTime:(new Date).getTime();v.pollingEnabledInternally=!0,v.pollingEnabled=!0,v.pollingMessagesTimestamp=Math.floor(t/1e3),v.fetchMessages(),v.startMessagesTimer()}},v.prototype.makeXMPPConnection=function(){v.setAccidentalDisconnect(!1),v.XMPPLogin(v.user,function(){L.Logger.info("XMPPLogin","successful")},function(){L.Logger.info("XMPPLogin","unsuccessful")})},v.prototype.accidentallyDisconnected=function(){v.currentConnectionStatus=U.CONNECTION_STATUS.CONNECTING,Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.inConnecting)||e._XMPPeventListener.inConnecting())}catch(e){L.Logger.error("XMPPConnectionHandlers: inConnecting Status",e)}}),v.setAccidentalDisconnect(!0),v.tryReconnectingToWSOrStartPolling()},v.XMPPLogin=function(e,t,n){var s=this;try{Z.XMMPLogin(e.getUid(),e.getWsChannel().secret,!1,function(e,t){switch(t===U.Errors.ERR_XMPP_CONFLICT&&(Z.XMPPDisconnect(),v.generateNewSessionId()),e){case r.Strophe.Status.CONNFAIL:v.isLoggedOut||s.tryReconnectingToWSOrStartPolling();break;case r.Strophe.Status.CONNECTING:var n=v.getConnectionStatus();v.WSReconnectionInProgress||v.accidentalDisconnect||v.didMessagesPollingStart()||(s.currentConnectionStatus=U.CONNECTION_STATUS.CONNECTING,n==U.CONNECTION_STATUS.DISCONNECTED&&Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.inConnecting)||e._XMPPeventListener.inConnecting())}catch(e){L.Logger.error("XMPPConnectionHandlers: inConnecting Status",e)}}));break;case r.Strophe.Status.CONNECTED:n=v.getConnectionStatus();s.currentConnectionStatus=U.CONNECTION_STATUS.CONNECTED,n!==U.CONNECTION_STATUS.FEATURE_THROTTLED&&v.didMessagesPollingStart(),n!=U.CONNECTION_STATUS.CONNECTING&&n!=U.CONNECTION_STATUS.FEATURE_THROTTLED||Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onConnected)||e._XMPPeventListener.onConnected())}catch(e){L.Logger.error("XMPPConnectionHandlers: onConnected Status",e)}}),v.WSReconnectionStartTime=0,v.pollingMessagesId=0,v.pollingEnabled=!1,v.pollingEnabledInternally=!1,v.WSCurrentReconnectionCount=0,v.setAccidentalDisconnect(!1),v.didMessagesPollingStart()&&v.clearMessagesTimer(),v.WSReconnectionInProgress&&v.clearWSReconnectionTimer();break;case r.Strophe.Status.DISCONNECTED:n=v.getConnectionStatus();v.WSReconnectionInProgress||v.accidentalDisconnect||v.didMessagesPollingStart()||(s.currentConnectionStatus=U.CONNECTION_STATUS.DISCONNECTED,n!==U.CONNECTION_STATUS.DISCONNECTED&&(Z.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(L.isFalsy(e._XMPPeventListener.onDisconnected)||e._XMPPeventListener.onDisconnected())}catch(e){L.Logger.error("XMPPConnectionHandlers: Disconnected Status",e)}}),v.isLoggedOut||s.tryReconnectingToWSOrStartPolling()));break;case r.Strophe.Status.DISCONNECTING:break;case r.Strophe.Status.AUTHFAIL:s.tryReconnectingToWSOrStartPolling()}})}catch(e){return void(v.isLoggedOut||this.tryReconnectingToWSOrStartPolling())}},v.fetchMessages=function(){var e=this;try{var t={per_page:v.pollingLimit,affix:v.pollingAffix,polling:1};v.pollingMessagesId?t.id=v.pollingMessagesId:t.sentAt=v.pollingMessagesTimestamp,p.makeApiCall("getMessages",{},t).then(function(o){return l(e,void 0,void 0,function(){var t,n,s,r;return E(this,function(e){switch(e.label){case 0:if(t=o.data,!(0<(n=o.data.length)))return[3,4];v.pollingMessagesId=t[n-1].id,s=Math.floor(v.pollingInterval/n),r=0,e.label=1;case 1:return r<n?v.isLoggedOut?[3,3]:(t[r]&&t[r][U.MessageConstatnts.KEYS.DATA]&&t[r][U.MessageConstatnts.KEYS.DATA][U.MessageConstatnts.KEYS.RESOURCE]&&t[r][U.MessageConstatnts.KEYS.DATA][U.MessageConstatnts.KEYS.RESOURCE]!==v.getSessionId()&&v.getConnectionStatus()!==U.CONNECTION_STATUS.CONNECTED&&(v.getLastMessageId()<=t[r].id&&v.setLastMessageId(t[r].id),P.MessageListnerMaping.getInstance().set("all",parseInt(t[r].id)),g.XMPPConnectionHelper.getInstance().trigerMessageHandler(t[r])),r<n-1?[4,v.timer(s)]:[3,3]):[3,4];case 2:e.sent(),e.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},function(e){L.Logger.error("CometChat: fetchMessages: API Error",e)}).catch(function(e){L.Logger.error("CometChat: fetchMessages: API Error",e)})}catch(e){L.Logger.error("CometChat: fetchMessages",e)}},v.fetchMissedMessages=function(){var e=this;try{var t={per_page:1e3,affix:U.MessageConstatnts.PAGINATION.AFFIX.APPEND,missedMessages:1};0<v.getLastMessageId()?t.id=v.getLastMessageId():0<v.getSuccessfultTimeStamp()?t.sentAt=Math.floor(v.getSuccessfultTimeStamp()/1e3):t.sentAt=Math.floor((new Date).getTime()/1e3),p.makeApiCall("getMessages",{},t).then(function(r){return l(e,void 0,void 0,function(){var t,n,s;return E(this,function(e){if(t=r.data,0<(n=r.data.length))for(v.pollingMessagesId=t[n-1].id,s=0;s<n;s++)v.isLoggedOut||t[s]&&t[s][U.MessageConstatnts.KEYS.DATA]&&t[s][U.MessageConstatnts.KEYS.DATA][U.MessageConstatnts.KEYS.RESOURCE]&&t[s][U.MessageConstatnts.KEYS.DATA][U.MessageConstatnts.KEYS.RESOURCE]!==v.getSessionId()&&(v.getLastMessageId()<=t[s].id&&v.setLastMessageId(t[s].id),P.MessageListnerMaping.getInstance().set("all",parseInt(t[s].id)),t[s][U.MessageConstatnts.KEYS.CATEGORY]!==U.MessageConstatnts.CATEGORY.CALL||t[s][U.MessageConstatnts.KEYS.DATA][U.MessageConstatnts.KEYS.ACTION]!==U.CallConstants.CALL_STATUS.INITIATED?g.XMPPConnectionHelper.getInstance().trigerMessageHandler(t[s]):L.Logger.info("CometChat: fetchMissedMessages","Call Initiated Message"));return[2]})})},function(e){L.Logger.error("CometChat: fetchMissedMessages: API Error",e)}).catch(function(e){L.Logger.error("CometChat: fetchMissedMessages: API Error",e)})}catch(e){L.Logger.error("CometChat: fetchMissedMessages",e)}},v.pingAnalytics=function(){var c=this;try{v.keyStore.get("deviceId").then(function(e){var t=null;window&&window.location&&window.location.origin&&(t=window.location.origin);var n="",s=e,r={version:U.SDKHeader.sdkVersion,apiVersion:U.APPINFO.apiVersion,origin:t,uts:(new Date).getTime()};L.isFalsy(c.resource)||(r.resource=c.resource),L.isFalsy(c.platform)||(r.platform=c.platform),L.isFalsy(c.language)||(r.language=c.language),navigator&&(n=navigator.userAgent);var o={appInfo:r,uid:v.user.getUid(),userAgent:n,deviceId:s,platform:U.SDKHeader.platform};L.isFalsy(v.getSessionId())||(o.wsId=v.getSessionId()),v.analyticsHost||(v.analyticsHost=L.format(U.ANALYTICS.analyticsHost,v.appSettings.getRegion())),v.analyticsVersion||(v.analyticsVersion=U.ANALYTICS.analyticsVersion);var i="https://"+v.analyticsHost+"/"+v.analyticsVersion+"/ping",a={appId:v.appId,sdk:L.format(U.SDKHeader.sdk,U.SDKHeader.platform,U.SDKHeader.sdkVersion),"Content-Type":"application/json"};v.settingsHash&&(a.settingsHash=v.settingsHash),v.settingsHashReceivedAt&&(a.settingsHashReceivedAt=v.settingsHashReceivedAt),v.jwt&&(a.Authorization="Bearer "+v.jwt),v.authToken&&(a.authToken=v.authToken),p.postData(i,"POST",o,a,!1).then(function(e){return e.json()}).then(function(e){if(e.hasOwnProperty(U.ResponseConstants.RESPONSE_KEYS.KEY_DATA))L.Logger.log("Analytics Ping Request Data",e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);else if(e.hasOwnProperty(U.ResponseConstants.RESPONSE_KEYS.KEY_ERROR)){var t=e[U.ResponseConstants.RESPONSE_KEYS.KEY_ERROR];L.Logger.log("Analytics Ping Request Error",new D.CometChatException(t));var n=t.code;if(n===U.Errors.ERR_SETTINGS_HASH_OUTDATED){var s=v.authToken;v.getInstance().internalLogout(!1).then(function(){v.internalRestart=!0,v.login(s).then(function(e){v.internalRestart=!1})})}n===U.Errors.ERR_NO_AUTH&&c.updateJWT()}}).catch(function(e){L.Logger.error("CometChat: pingAnalytics Fetch Error",e)})})}catch(e){L.Logger.error("CometChat: pingAnalytics",e)}},v.updateJWT=function(){p.makeApiCall("getMyDetails",{},{},!1).then(function(e){var t=e.data,n=t.settings,s=new S.Me(t);if(t.hasOwnProperty("jwt")&&t.jwt&&(v.jwt=t.jwt),C.LocalStorage.getInstance().set("user",s),n&&n[U.APP_SETTINGS.KEYS.SETTINGS_HASH]&&v.settingsHash!==n[U.APP_SETTINGS.KEYS.SETTINGS_HASH]){var r=v.getInstance().getAuthToken();v.getInstance().internalLogout(!1).then(function(){v.internalRestart=!0,v.login(r).then(function(e){v.internalRestart=!1})})}L.Logger.log("CometChat: updateJWT response",e)},function(e){L.Logger.error("CometChat: updateJWT Fetch Error",e)}).catch(function(e){L.Logger.error("CometChat: updateJWT",e)})},v.startMessagesTimer=function(){var e=this;v.isMessagesPollingStarted=!0,v.messagesTimer=setInterval(function(){try{e.fetchMessages()}catch(e){L.Logger.error("CometChat: startMessagesTimer",e)}},v.pollingInterval)},v.timer=function(t){return new Promise(function(e){return setTimeout(e,t)})},v.startAnalyticsPingTimer=function(){var e=this;v.isAnalyticsPingStarted=!0,v.analyticsPingTimer=setInterval(function(){try{e.pingAnalytics()}catch(e){L.Logger.error("CometChat: startAnalyticsPingTimer",e)}},v.settingsInterval)},v.clearMessagesTimer=function(){try{v.isMessagesPollingStarted=!1,clearInterval(v.messagesTimer)}catch(e){L.Logger.error("CometChat: clearMessagesTimer",e)}},v.clearAnalyticsPingTimer=function(){try{v.isAnalyticsPingStarted=!1,clearInterval(v.analyticsPingTimer)}catch(e){L.Logger.error("CometChat: clearAnalyticsPingTimer",e)}},v.startWSReconnectionTimer=function(){v.WSReconnectionInProgress=!0,v.WSReconnectionTimer=setInterval(function(){try{v.XMPPLogin(v.user,function(){L.Logger.info("XMPPLogin","successful")},function(){L.Logger.info("XMPPLogin","unsuccessful")})}catch(e){L.Logger.error("CometChat: startWSReconnectionTimer",e)}},v.WSReconnectionTimerInterval)},v.clearWSReconnectionTimer=function(){v.WSReconnectionInProgress=!1,clearInterval(v.WSReconnectionTimer)},v.getJWT=function(o){return new Promise(function(s,r){try{Q.getEndPoint("getJWT").then(function(e){var t={appId:v.appId,Accept:"application/json",authToken:v.authToken,resource:v.getSessionId(),sdk:L.format(U.SDKHeader.sdk,U.SDKHeader.platform,U.SDKHeader.sdkVersion),"Content-Type":"application/json"},n={};n[U.JWT_API.KEYS.PASSTHROUGH]=o,p.postData(e.endpoint,e.method,n,t,!1).then(function(e){return e.json()}).then(function(e){e.hasOwnProperty(U.ResponseConstants.RESPONSE_KEYS.KEY_DATA)?s(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]):r(new D.CometChatException(e.error))}).catch(function(e){var t={error:m.FETCH_ERROR.ERROR_IN_API_CALL};r(new D.CometChatException(t))})},function(e){r(new D.CometChatException(e))})}catch(e){r(new D.CometChatException(e))}})},v.getConnectionStatus=function(){return this.currentConnectionStatus},v.prototype.setConnectionStatus=function(e){v.currentConnectionStatus=e},v.isExtensionEnabled=function(o){return new Promise(function(s,r){try{if(L.isFalsy(o))return r(new D.CometChatException(U.ExtensionErrors.INVALID_EXTENSION));L.getAppSettings().then(function(e){if(e.extensions){var t=e.extensions;if(0<t.length){var n=t.some(function(e){return e.id===o});return s(n)}return s(!1)}return r(new D.CometChatException(U.ExtensionErrors.EXTENSION_NOT_FOUND))},function(e){return r(new D.CometChatException(e))})}catch(e){return r(new D.CometChatException(e))}})},v.getExtensionDetails=function(i){return new Promise(function(r,o){try{if(L.isFalsy(i))return o(new D.CometChatException(U.ExtensionErrors.INVALID_EXTENSION));L.getAppSettings().then(function(e){if(e.extensions){var t=e.extensions;if(0<t.length){var n=t.filter(function(e){return e.id===i});if(0<n.length){var s=new W.CCExtension(n[0]);return r(s)}return o(new D.CometChatException(U.ExtensionErrors.EXTENSION_NOT_FOUND))}return o(new D.CometChatException(U.ExtensionErrors.EXTENSION_NOT_FOUND))}return o(new D.CometChatException(U.ExtensionErrors.EXTENSION_NOT_FOUND))},function(e){return o(new D.CometChatException(e))})}catch(e){return o(new D.CometChatException(e))}})},v.getAppSettings=function(){return new Promise(function(t,n){try{p.makeApiCall("appSettings").then(function(e){C.LocalStorage.getInstance().set("app_settings",e.data),t(e.data)},function(e){n(new D.CometChatException(e.error))})}catch(e){n(new D.CometChatException(e))}})},v.isFeatureEnabled=function(r){return new Promise(function(n,s){try{if(L.isFalsy(r))return s(new D.CometChatException(U.FeatureRestrictionErrors.INVALID_FEATURE));L.getAppSettings().then(function(e){if(e.parameters){var t=e.parameters;return t.hasOwnProperty(r)?n(t[r]):n(!1)}return s(new D.CometChatException(U.FeatureRestrictionErrors.FEATURE_NOT_FOUND))},function(e){return s(new D.CometChatException(e))})}catch(e){return s(new D.CometChatException(e))}})},v.logout=function(){var s=this;return new Promise(function(t,n){try{v.didAnalyticsPingStart()&&v.clearAnalyticsPingTimer(),v.didMessagesPollingStart()&&v.clearMessagesTimer(),v.WSReconnectionInProgress&&v.clearWSReconnectionTimer(),v.isLoggedOut=!0,v.pollingMessagesId=0,v.pollingEnabled=!1,v.pollingInterval=5e3,v.pollingEnabledInternally=!1,v.WSReconnectionStartTime=0,v.WSReconnectionInProgress=!1,v.setLastMessageId(0),v.setAccidentalDisconnect(!1),v.isAnalyticsDisabled=!1,v.shouldFallBackToPolling=!0,p.makeApiCall("userLogout").then(function(e){s.clearCache().then(function(){v.apiKey=void 0,v.user=void 0,v.authToken=void 0,v.cometChat=void 0,v.mode=void 0,g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),v.pushToLoginListener("","Logout_Success"),t(e.data)})},function(e){s.clearCache().then(function(){v.apiKey=void 0,v.user=void 0,v.authToken=void 0,v.cometChat=void 0,v.mode=void 0,g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),v.pushToLoginListener("","Logout_Success"),new D.CometChatException(e.error).code==m.SERVER_ERRORS.AUTH_ERR.code?t({}):n(new D.CometChatException(e.error))})})}catch(e){n(new D.CometChatException(e))}})},v.callExtension=function(r,o,i,a){return void 0===a&&(a={}),new Promise(function(t,n){var e=L.format((new d.EndpointFactory).extensionApi,r,v.appSettings.getRegion(),i),s={appId:v.appId,Accept:"application/json",authToken:v.authToken,resource:v.getSessionId(),sdk:L.format(U.SDKHeader.sdk,U.SDKHeader.platform,U.SDKHeader.sdkVersion),"Content-Type":"application/json"};p.postData(e,o,a,s,!1).then(function(e){return e.json()}).then(function(e){e.hasOwnProperty(U.ResponseConstants.RESPONSE_KEYS.KEY_DATA)?t(e[U.ResponseConstants.RESPONSE_KEYS.KEY_DATA]):n(new D.CometChatException(e.error))}).catch(function(e){var t={error:m.FETCH_ERROR.ERROR_IN_API_CALL};n(t)})})},v.setSource=function(e,t,n){L.isFalsy(e)||(this.resource=e),L.isFalsy(t)||(this.platform=t),L.isFalsy(n)||(this.language=n)},v.clearCache=function(){return new Promise(function(e,t){try{C.LocalStorage.getInstance().clearStore().then(function(){s.UserStore.getInstance().clearStore().then(function(){n.MessagesStore.getInstance().clearStore().then(function(){v.removeDataFromSessionStorage(U.SESSION_STORE.SESSION_ID),L.Logger.info("CometChat: clearCache => All store cleared successfully","true"),e(!0)})})})}catch(e){L.Logger.error("CometChat: clearCache",e),t(e)}})},v.typingTimer=function(){try{setInterval(function(){b.TypingNotificationController.clearTimer()},500)}catch(e){L.Logger.error("CometChat: typingTimer",e)}},v.prototype.internalLogout=function(n){return void 0===n&&(n=!0),new Promise(function(e,t){try{v.didAnalyticsPingStart()&&v.clearAnalyticsPingTimer(),v.didMessagesPollingStart()&&v.clearMessagesTimer(),v.WSReconnectionInProgress&&v.clearWSReconnectionTimer(),v.isLoggedOut=!0,v.pollingMessagesId=0,v.pollingEnabled=!1,v.pollingInterval=5e3,v.pollingEnabledInternally=!1,v.WSReconnectionStartTime=0,v.WSReconnectionInProgress=!1,v.setLastMessageId(0),v.setAccidentalDisconnect(!1),v.isAnalyticsDisabled=!1,v.shouldFallBackToPolling=!0,v.clearCache().then(function(){v.apiKey=void 0,v.user=void 0,v.authToken=void 0,v.cometChat=void 0,v.mode=void 0,g.XMPPConnectionHelper.getInstance().XMPPDisconnect(),n&&v.pushToLoginListener("","Logout_Success"),e(!0)})}catch(e){L.Logger.error("CometChat: internalLogout",e),t(e)}})},v.initialzed=!1,v.isNative=!1,v.CometChatException=D.CometChatException,v.TextMessage=f.TextMessage,v.MediaMessage=_.MediaMessage,v.CustomMessage=G.CustomMessage,v.Action=A.Action,v.Call=o.Call,v.TypingIndicator=M.TypingIndicator,v.Group=a.Group,v.AppUser=S.User,v.User=S.User,v.GroupMember=Y.GroupMember,v.Conversation=V.Conversation,v.USER_STATUS={ONLINE:U.PresenceConstatnts.STATUS.ONLINE,OFFLINE:U.PresenceConstatnts.STATUS.OFFLINE},v.MessagesRequest=y.DefaultMessagesRequest,v.MessagesRequestBuilder=y.DefaultMessagesRequestBuilder,v.UsersRequest=N.UsersRequest,v.UsersRequestBuilder=N.UsersRequestBuilder,v.ConversationsRequest=O.ConversationsRequest,v.ConversationsRequestBuilder=O.ConversationsRequestBuilder,v.BlockedUsersRequest=K.BlockedUsersRequest,v.BlockedUsersRequestBuilder=K.BlockedUsersRequestBuilder,v.GroupsRequest=I.GroupsRequest,v.GroupsRequestBuilder=I.GroupsRequestBuilder,v.GroupMembersRequest=R.GroupMembersRequest,v.GroupMembersRequestBuilder=R.GroupMembersRequestBuilder,v.BannedMembersRequest=R.GroupMembersRequest,v.BannedMembersRequestBuilder=R.GroupOutCastMembersRequestBuilder,v.AppSettings=H.AppSettings,v.AppSettingsBuilder=H.AppSettingsBuilder,v.MessageListener=e.MessageEventListener,v.UserListener=e.UserEventListener,v.GroupListener=e.GroupEventListener,v.OngoingCallListener=e.UserCallEventListener,v.CallListener=e.CallEventListener,v.ConnectionListener=g.XMPPConnectionEventListener,v.LoginListener=e.LoginEventListener,v.MESSAGE_TYPE=U.MessageConstatnts.TYPE,v.CATEGORY_MESSAGE=U.MessageConstatnts.CATEGORY.MESSAGE,v.CATEGORY_ACTION=U.MessageConstatnts.CATEGORY.ACTION,v.CATEGORY_CALL=U.MessageConstatnts.CATEGORY.CALL,v.CATEGORY_CUSTOM=U.MessageConstatnts.CATEGORY.CUSTOM,v.ACTION_TYPE=U.ActionConstatnts.ACTIONS,v.CALL_TYPE=U.CallConstants.CALL_TYPE,v.RECEIVER_TYPE=U.MessageConstatnts.RECEIVER_TYPE,v.CALL_STATUS=U.CallConstants.CALL_STATUS,v.CallController=w.CallController,v.GROUP_MEMBER_SCOPE=U.GROUP_MEMBER_SCOPE,v.GROUP_TYPE=U.GROUP_TYPE,v.MESSAGE_REQUEST=U.MessageConstatnts.PAGINATION.CURSOR_FILEDS,v.CometChatExtension=x.CometChatExtension,v.ExtensionManager=F.ExtensionManager,v.isCall=!1,v.endpointFactory=new d.EndpointFactory,v.startTypingCount=0,v.endTypingCount=0,v.CometChatHelper=k.CometChatHelper,v.WSReconnectionStartTime=0,v.WSMaxReconnectionLimit=10,v.WSCurrentReconnectionCount=0,v.WSReconnectionInProgress=!1,v.WSReconnectionPeriod=3e4,v.WSReconnectionTimerInterval=3e4,v.pollingEnabledInternally=!1,v.accidentalDisconnect=!1,v.successfulPingTimeStamp=0,v.currentConnectionStatus=U.CONNECTION_STATUS.DISCONNECTED,v.CONNECTION_STATUS=U.CONNECTION_STATUS,v.Attachment=X.Attachment,v.isConnectingFromInit=!1,v.loginInProgress=!1,v.lastMessageId=0,v.internalRestart=!1,v.pollingEnabled=!1,v.pollingInterval=5e3,v.pollingLimit=100,v.pollingAffix="append",v.pollingMessagesId=0,v.settingsInterval=6e4,v.isMessagesPollingStarted=!1,v.isAnalyticsPingStarted=!1,v.isLoggedOut=!0,v.isAnalyticsDisabled=!1,v.CallSettings=j.CallSettings,v.CallSettingsBuilder=j.CallSettingsBuilder,v.MediaDevice=z.MediaDevice,v.CALL_MODE=U.CallConstants.CALL_MODE,v.shouldFallBackToPolling=!0,v}();ee.CometChat=v}).call(this,te(28))},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var o=n(2),i=n(13),a=n(0),c=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.hasBlockedMe=!1,this.blockedByMe=!1,1===e.length)typeof e[0]===a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?this.uid=e[0]:(this.uid=e[0].uid,this.name=e[0].name,e[0].authToken&&(this.authToken=e[0].authToken),e[0].avatar&&(this.avatar=e[0].avatar),e[0].lastActiveAt&&(this.lastActiveAt=e[0].lastActiveAt),e[0].link&&(this.link=e[0].link),e[0].metadata&&(this.metadata=e[0].metadata),e[0].role&&(this.role=e[0].role),e[0].statusMessage&&(this.statusMessage=e[0].statusMessage),e[0].status&&"offline"!==e[0].status?this.status="online":this.status="offline",e[0].tags&&(this.tags=e[0].tags));else{if(2!==e.length)throw new o.CometChatException(i.ERRORS.PARAMETER_MISSING);this.uid=e[0],this.name=e[1]}}return e.prototype.getUid=function(){return this.uid.toString()},e.prototype.setUid=function(e){this.uid=e},e.prototype.getName=function(){return this.name.toString()},e.prototype.setName=function(e){e&&(this.name=e)},e.prototype.getAuthToken=function(){return this.authToken},e.prototype.setAuthToken=function(e){this.authToken=e},e.prototype.getAvatar=function(){return this.avatar},e.prototype.setAvatar=function(e){this.avatar=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getLink=function(){return this.link},e.prototype.setLink=function(e){return this.link=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getRole=function(){return this.role},e.prototype.setRole=function(e){this.role=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e.prototype.setBlockedByMe=function(e){this.blockedByMe=e},e.prototype.getBlockedByMe=function(){return this.blockedByMe},e.prototype.setHasBlockedMe=function(e){this.hasBlockedMe=e},e.prototype.getHasBlockedMe=function(){return this.hasBlockedMe},e.prototype.setTags=function(e){this.tags=e},e.prototype.getTags=function(){return this.tags},e}(),u=function(n){function e(e){var t=n.call(this,e)||this;return t.wsChannel=e.wsChannel,e.jwt&&(t.jwt=e.jwt),t}return r(e,n),e.prototype.getWsChannel=function(){return this.wsChannel},e.prototype.getJWT=function(){return this.jwt},e}(t.User=c);t.Me=u},function(e,t,n){"use strict";t.__esModule=!0;var c=n(30),u=n(3),l=n(1),E=n(2),d=n(13),h=n(0);function p(n,e,s,t,r){var o;return void 0===n&&(n=""),void 0===e&&(e="GET"),void 0===s&&(s={}),void 0===t&&(t={}),s=l.isFalsy(s)?void 0:("GET"==e&&(n+="?",Object.keys(s).map(function(e,t){n=t===Object.keys(s).length-1?n+e+"="+s[e]:n+e+"="+s[e]+"&"}),s=void 0),r&&(o=new FormData,Object.keys(s).map(function(e){"data"!=e?"metadata"!=e&&o.append(e,s[e]):o.append(e,JSON.stringify(s[e]))})),JSON.stringify(s)),fetch(n,{method:e,mode:"cors",cache:"no-cache",headers:t,redirect:"follow",referrer:"no-referrer",body:r?o:s})}t.makeApiCall=function(r,e,o,i){void 0===r&&(r=""),void 0===e&&(e={}),void 0===o&&(o={});var a=u.CometChat.getInstance(u.CometChat.getAppId());return new Promise(function(n,s){try{c.getEndPoint(r,e).then(function(e){var t={resource:u.CometChat.getSessionId(),appId:u.CometChat.getAppId(),Accept:"application/json",sdk:l.format(h.SDKHeader.sdk,h.SDKHeader.platform,h.SDKHeader.sdkVersion)};i||(t["Content-Type"]="application/json"),e.hasOwnProperty("isAdminApi")&&e.isAdminApi?a.getApiKey()?t.apiKey=a.getApiKey():s({error:{code:"API_KEY_NOT_SET",message:"An apiKey is needed to use the "+r+" api.",name:"API_KEY_NOT_SET"}}):a.getAuthToken()?t.authToken=a.getAuthToken():s({error:{code:"USER_NOT_LOGED_IN",message:"An authToken is need to use the "+r+" end-point. PS- We are aware of the spelling mistake, but in order to maintain backward compatibility we cannot change it :(",name:"User not logged-in"}}),p(e.endpoint,e.method,o,t,i).then(function(e){return e.json()}).then(function(e){if(e.hasOwnProperty("data"))e.data.hasOwnProperty("authToken")&&u.CometChat.setAuthToken(e.data.authToken),n(e);else{if(e.hasOwnProperty("error")){var t=e.error;t.hasOwnProperty("code")&&t.code===h.API_ERROR_CODES.AUTH_ERR_AUTH_TOKEN_NOT_FOUND&&u.CometChat.getInstance().internalLogout().then(function(){l.Logger.log("CometChat: makeApiCall","User logged out")})}s(e)}}).catch(function(e){var t={error:d.FETCH_ERROR.ERROR_IN_API_CALL};s(t)})}).catch(function(e){return s})}catch(e){s(new E.CometChatException(e))}})},t.makeAdminApiCall=function(r,e,o,i){void 0===r&&(r=""),void 0===e&&(e={}),void 0===o&&(o={});var a=u.CometChat.getInstance(u.CometChat.getAppId());return new Promise(function(n,s){c.getEndPoint(r,e).then(function(e){var t={appId:u.CometChat.getAppId(),Accept:"application/json",sdk:l.format(h.SDKHeader.sdk,h.SDKHeader.platform,h.SDKHeader.sdkVersion)};i||(t["Content-Type"]="application/json"),e.hasOwnProperty("isAdminApi")&&e.isAdminApi?a.getApiKey()?t.apiKey=a.getApiKey():s({error:"An apiKey is need to use the "+r+" api."}):a.getAuthToken()?t.authToken=a.getAuthToken():s({error:"An authToken is need to use the "+r+" api."}),p(e.endpoint,e.method,o,t,i).then(function(e){return e.json()}).then(function(e){e.hasOwnProperty("data")?(e.data.hasOwnProperty("authToken")&&u.CometChat.setAuthToken(e.data.authToken),n(e)):s(e)}).catch(function(e){var t={error:d.FETCH_ERROR.ERROR_IN_API_CALL};s(t)})}).catch(function(e){return s})})},t.postData=p},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function e(e,t,n,s,r,o,i){this.hasJoined=!1,this.membersCount=0,this.guid=e,t&&(this.name=t),n&&(this.type=n),!s&&""!==s||"password"!=n||(this.password=s),(r||""===r)&&(this.icon=r),(o||""===o)&&(this.description=o),i&&(this.hasJoined=i)}return e.prototype.getGuid=function(){return this.guid},e.prototype.setGuid=function(e){this.guid=e},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){e&&(this.name=e)},e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.setPassword=function(e){this.password=e},e.prototype.getIcon=function(){return this.icon},e.prototype.setIcon=function(e){this.icon=e},e.prototype.getDescription=function(){return this.description},e.prototype.setDescription=function(e){this.description=e},e.prototype.getOwner=function(){return this.owner},e.prototype.setOwner=function(e){this.owner=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getCreatedAt=function(){return this.createdAt},e.prototype.setCreatedAt=function(e){this.createdAt=e},e.prototype.getUpdatedAt=function(){return this.updatedAt},e.prototype.setUpdatedAt=function(e){this.updatedAt=e},e.prototype.getHasJoined=function(){return this.hasJoined},e.prototype.setHasJoined=function(e){this.hasJoined=e},e.prototype.getWsChannel=function(){return this.wsChannel},e.prototype.setWsChannel=function(e){this.wsChannel=e},e.prototype.setScope=function(e){this.scope=e},e.prototype.getScope=function(){return this.scope},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.setJoinedAt=function(e){this.joinedAt=e},e.prototype.getMembersCount=function(){return this.membersCount},e.prototype.setMembersCount=function(e){this.membersCount=e},e.prototype.setTags=function(e){this.tags=e},e.prototype.getTags=function(){return this.tags},e.TYPE=s.GroupType,e.Type=e.TYPE,e}();t.Group=r},function(e,t,n){"use strict";t.__esModule=!0;var i=n(10),a=n(17),u=n(11),l=n(18),E=n(5),s=n(22),d=n(1),h=n(0),p=n(14),S=n(23),g=n(24),C=n(44),_=n(4),f=n(2),T=n(19),m=n(20),o=n(3),A=n(8),r=function(){function c(){}return c.trasformXMPPMessage=function(e){var t={};try{var n=JSON.parse(u.parseHTML(e.getElementsByTagName("body")[0]).trim().toString());t=this.trasformJSONMessge(n)}catch(e){d.Logger.error("MessageController: transformXMPPMessage",{e:e})}return t},c.checkIfCabon=function(e){try{return 0<e.getElementsByTagName("forwarded").length&&e.getElementsByTagName("forwarded")[0],0<e.getElementsByTagName("forwarded").length}catch(e){d.Logger.error("MessageController: checkIfCabon",{e:e})}},c.trasformJSONMessge=function(n){try{var e=null;n.hasOwnProperty("rawMessage")||(e=JSON.parse(JSON.stringify(n)));var t=void 0;switch(n[h.MessageConstatnts.KEYS.CATEGORY]){case h.MessageConstatnts.CATEGORY.ACTION:t=S.Action.actionFromJSON(n);break;case h.MessageConstatnts.CATEGORY.CALL:t=g.Call.callFromJSON(n);break;case h.MessageConstatnts.CATEGORY.MESSAGE:switch(n[h.MessageConstatnts.KEYS.TYPE]){case h.MessageConstatnts.TYPE.TEXT:t=new a.TextMessage(n[h.MessageConstatnts.KEYS.RECEIVER],n[h.MessageConstatnts.KEYS.DATA][h.MessageConstatnts.KEYS.TEXT],n[h.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;case h.MessageConstatnts.TYPE.CUSTOM:t=new m.CustomMessage(n[h.MessageConstatnts.KEYS.RECEIVER],n[h.MessageConstatnts.KEYS.DATA][h.MessageConstatnts.KEYS.CUSTOM_DATA],n[h.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;default:if(t=new l.MediaMessage(n[h.MessageConstatnts.KEYS.RECEIVER],n[h.MessageConstatnts.KEYS.DATA][h.MessageConstatnts.KEYS.URL],n[h.MessageConstatnts.KEYS.TYPE],n[h.MessageConstatnts.KEYS.RECEIVER_TYPE]),n.hasOwnProperty(h.MessageConstatnts.KEYS.DATA)){var s=n[h.MessageConstatnts.KEYS.DATA];if(s.hasOwnProperty(h.MessageConstatnts.KEYS.ATTATCHMENTS)){var r,o=s[h.MessageConstatnts.KEYS.ATTATCHMENTS];new Array;o.map(function(e){r=new T.Attachment(e)}),t.setAttachment(r)}s.hasOwnProperty(h.MessageConstatnts.KEYS.TEXT)&&t.setCaption(s[h.MessageConstatnts.KEYS.TEXT])}t.hasOwnProperty("file")&&delete t.file}break;case h.MessageConstatnts.CATEGORY.CUSTOM:t=new m.CustomMessage(n[h.MessageConstatnts.KEYS.RECEIVER],n[h.MessageConstatnts.KEYS.DATA][h.MessageConstatnts.KEYS.CUSTOM_DATA],n[h.MessageConstatnts.KEYS.RECEIVER_TYPE],n.type)}n[h.MessageConstatnts.KEYS.MY_RECEIPTS]&&(n[h.MessageConstatnts.KEYS.MY_RECEIPTS]=n[h.MessageConstatnts.KEYS.MY_RECEIPTS],Object.keys(n[h.MessageConstatnts.KEYS.MY_RECEIPTS]).map(function(e){var t=new C.MessageReceipt;e==h.DELIVERY_RECEIPTS.DELIVERED_AT&&(t.setReceiptType(t.RECEIPT_TYPE.DELIVERY_RECEIPT),t.setDeliveredAt(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.DELIVERY_RECEIPTS.DELIVERED_AT]),d.isFalsy(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.DELIVERY_RECEIPTS.RECIPIENT])?n[h.DELIVERY_RECEIPTS.DELIVERED_TO_ME_AT]=n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.DELIVERY_RECEIPTS.DELIVERED_AT]:t.setSender(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.DELIVERY_RECEIPTS.RECIPIENT]),t.setReceiverType(n[h.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.setReceiver(n[h.MessageConstatnts.KEYS.RECEIVER])),n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.READ_RECEIPTS.READ_AT]&&(t.setReceiptType(t.RECEIPT_TYPE.READ_RECEIPT),t.setReadAt(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.READ_RECEIPTS.READ_AT]),d.isFalsy(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.READ_RECEIPTS.RECIPIENT])?n[h.READ_RECEIPTS.READ_BY_ME_AT]=n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.READ_RECEIPTS.READ_AT]:t.setSender(n[h.MessageConstatnts.KEYS.MY_RECEIPTS][h.READ_RECEIPTS.RECIPIENT]),t.setReceiverType(n[h.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.setReceiver(n[h.MessageConstatnts.KEYS.RECEIVER]))}));try{if(Object.assign(t,n),(n=t).parentId&&(n.parentMessageId=n.parentId,delete n.parentId),n instanceof i.BaseMessage&&(d.isFalsy(e)||n.setRawMessage(e)),n instanceof a.TextMessage)n.setSender(n.getSender()),n.setReceiver(n.getReceiver()),n.getData()[h.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[h.MessageConstatnts.KEYS.METADATA]);else if(n instanceof l.MediaMessage)n.getData()[h.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[h.MessageConstatnts.KEYS.METADATA]),n.setSender(n.getSender()),n.setReceiver(n.getReceiver());else if(n instanceof S.Action)n.setSender(n.getSender()),n.setReceiver(n.getActionFor()),n.setActionBy(n.getActionBy()),n.setActionOn(n.getActionOn()),n.setActionFor(n.getActionFor()),n.setMessage(n.getMessage());else if(n instanceof g.Call){try{n.setSender(n.getSender())}catch(e){d.Logger.error("MessageController: trasformJSONMessge: setSender",e)}try{n.setCallInitiator(n.getCallInitiator())}catch(e){d.Logger.error("MessageController: trasformJSONMessge: setCallInitiator",e)}try{n.setReceiver(n.getCallReceiver()),n.setCallReceiver(n.getCallReceiver())}catch(e){d.Logger.error("MessageController: trasformJSONMessge: setCallreceiver",e)}}else n instanceof m.CustomMessage&&(n.getData()[h.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[h.MessageConstatnts.KEYS.METADATA]),n.setSubType(n.getData()[h.MessageConstatnts.KEYS.CUSTOM_SUB_TYPE]),n.setSender(n.getSender()),n.setReceiver(n.getReceiver()))}catch(e){d.Logger.error("MessageController: trasformJSONMessge: Main",e),n=null}return n}catch(e){d.Logger.error("MessageController: trasformJSONMessge",e)}},c.getOfflineHistory=function(e,t){void 0===e&&(e=1e3),void 0===t&&(t=1);try{s.MessagesStore.getInstance();var n=[];E.makeApiCall("getMessages",{},this.createData(e,t)).then(function(e){return d.isFalsy(e.data)||e.data.map(function(e){p.XMPPConnectionHelper.getInstance().trigerMessageHandler(e),n.push(c.trasformJSONMessge(e))}),!0})}catch(e){d.Logger.error("MessageController: getOfflineHistory",e)}},c.getAllMessage=function(e,s,r,o){var i=this;void 0===e&&(e=100);var a=[];return new Promise(function(t,n){try{E.makeApiCall("getMessages",{},i.createAllMessageData(e,s,r,o)).then(function(e){d.isFalsy(e.data)||(e.data.map(function(e){a.push(c.trasformJSONMessge(e))}),t(a))},function(e){d.Logger.error("Error on fetching all message",e),t([])})}catch(e){n(new f.CometChatException(e))}})},c.createData=function(e,t){return void 0===t&&(t=0),{per_page:e,cursorValue:t,cursorField:h.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,cursorAffix:d.isFalsy(t)?h.MessageConstatnts.PAGINATION.AFFIX.PREPEND:h.MessageConstatnts.PAGINATION.AFFIX.APPEND}},c.createAllMessageData=function(e,t,n,s){return{per_page:e,cursorValue:t,cursorField:n,cursorAffix:s}},c.isDeliveryReceipt=function(e){try{return 0<e.getElementsByTagName(h.DELIVERY_RECEIPTS.RECEIVED).length}catch(e){d.Logger.error("MessageController: isDeliveryReceipts",e)}},c.isReadRceipt=function(e){try{return 0<e.getElementsByTagName(h.READ_RECEIPTS.READ).length}catch(e){d.Logger.error("MessageController: isDeliveryReceipts",e)}},c.processDeliveryReceipt=function(i){return new Promise(function(n,t){try{var s=i.getElementsByTagName(h.DELIVERY_RECEIPTS.RECEIVED)[0],r=i.getElementsByTagName(h.DELIVERY_RECEIPTS.DELIVERED_AT)[0],e=void 0;if(i.getElementsByTagName("user")[0]){delete(e=new _.User(JSON.parse(u.parseHTML(i.getElementsByTagName("user")[0]).trim().toString()))).authToken;var o=new C.MessageReceipt;o.setSender(e),s.getAttribute(h.DELIVERY_RECEIPTS.RECEIVER_TYPE)==h.MessageConstatnts.RECEIVER_TYPE.GROUP?(o.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.GROUP),o.setReceiver(s.getAttribute(h.DELIVERY_RECEIPTS.RECEIVER_ID))):(o.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.USER),o.setReceiver(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.TO)))),o.setReceiptType(o.RECEIPT_TYPE.DELIVERY_RECEIPT),o.setMessageId(u.getmessageIdFromStanzaId(s.getAttribute(h.DELIVERY_RECEIPTS.ID))),o.setTimestamp(r.getAttribute(h.DELIVERY_RECEIPTS.TIME)),o.setDeliveredAt(r.getAttribute(h.DELIVERY_RECEIPTS.TIME)),n(o)}else p.XMPPConnectionHelper.getInstance().getUsersVCard(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM)),function(e){var t=new C.MessageReceipt;t.setSender(e),s.getAttribute(h.DELIVERY_RECEIPTS.RECEIVER_TYPE)==h.MessageConstatnts.RECEIVER_TYPE.GROUP?(t.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.GROUP),t.setReceiver(s.getAttribute(h.DELIVERY_RECEIPTS.RECEIVER_ID))):(t.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.USER),t.setReceiver(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.TO)))),t.setReceiptType(t.RECEIPT_TYPE.DELIVERY_RECEIPT),t.setMessageId(u.getmessageIdFromStanzaId(s.getAttribute(h.DELIVERY_RECEIPTS.ID))),t.setTimestamp(r.getAttribute(h.DELIVERY_RECEIPTS.TIME)),t.setDeliveredAt(r.getAttribute(h.DELIVERY_RECEIPTS.TIME)),n(t)})}catch(e){t(new f.CometChatException(e))}})},c.processReadReceipt=function(i){return new Promise(function(n,t){try{var s=i.getElementsByTagName(h.READ_RECEIPTS.READ)[0],r=i.getElementsByTagName(h.READ_RECEIPTS.READ_AT)[0],e=void 0;if(i.getElementsByTagName("user")[0]){delete(e=new _.User(JSON.parse(u.parseHTML(i.getElementsByTagName("user")[0]).trim().toString()))).authToken;var o=new C.MessageReceipt;o.setSender(e),s.getAttribute(h.READ_RECEIPTS.RECEIVER_TYPE)==h.MessageConstatnts.RECEIVER_TYPE.GROUP?(o.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.GROUP),o.setReceiver(s.getAttribute(h.READ_RECEIPTS.RECEIVER_ID))):(o.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.USER),o.setReceiver(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.TO)))),o.setReceiptType(o.RECEIPT_TYPE.READ_RECEIPT),o.setMessageId(u.getmessageIdFromStanzaId(s.getAttribute(h.READ_RECEIPTS.ID))),o.setTimestamp(r.getAttribute(h.READ_RECEIPTS.TIME)),o.setReadAt(r.getAttribute(h.READ_RECEIPTS.TIME)),n(o)}else p.XMPPConnectionHelper.getInstance().getUsersVCard(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM)),function(e){var t=new C.MessageReceipt;t.setSender(e),s.getAttribute(h.READ_RECEIPTS.RECEIVER_TYPE)==h.MessageConstatnts.RECEIVER_TYPE.GROUP?(t.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.GROUP),t.setReceiver(s.getAttribute(h.READ_RECEIPTS.RECEIVER_ID))):(t.setReceiverType(h.MessageConstatnts.RECEIVER_TYPE.USER),t.setReceiver(u.getUidFromJid(i.getAttribute(h.MessageConstatnts.XMPP_KEYS.TO)))),t.setReceiptType(t.RECEIPT_TYPE.READ_RECEIPT),t.setMessageId(u.getmessageIdFromStanzaId(s.getAttribute(h.READ_RECEIPTS.ID))),t.setTimestamp(r.getAttribute(h.READ_RECEIPTS.TIME)),t.setReadAt(r.getAttribute(h.READ_RECEIPTS.TIME)),n(t)})}catch(e){t(new f.CometChatException(e))}})},c.getReceiptsFromJSON=function(r){return new Promise(function(e,t){try{var s=[];o.CometChat.getLoggedInUser().then(function(n){d.isFalsy(r.receipts)?e([]):(r.receipts.data.map(function(e){var t=new C.MessageReceipt;e[h.DELIVERY_RECEIPTS.DELIVERED_AT]&&(t.setReceiptType(t.RECEIPT_TYPE.DELIVERY_RECEIPT),t.setDeliveredAt(e[h.DELIVERY_RECEIPTS.DELIVERED_AT]),t.setTimestamp(e[h.DELIVERY_RECEIPTS.DELIVERED_AT]),d.isFalsy(e[h.DELIVERY_RECEIPTS.RECIPIENT])?t.setSender(n):t.setSender(A.UsersController.trasformJSONUser(e[h.DELIVERY_RECEIPTS.RECIPIENT])),t.setReceiverType(r[h.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.setReceiver(r[h.MessageConstatnts.KEYS.RECEIVER])),e[h.READ_RECEIPTS.READ_AT]&&(t.setReceiptType(t.RECEIPT_TYPE.READ_RECEIPT),t.setReadAt(e[h.READ_RECEIPTS.READ_AT]),t.setTimestamp(e[e[h.READ_RECEIPTS.READ_AT]]),d.isFalsy(e[h.READ_RECEIPTS.RECIPIENT])?t.setSender(n):t.setSender(A.UsersController.trasformJSONUser(e[h.READ_RECEIPTS.RECIPIENT])),t.setReceiverType(r[h.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.setReceiver(r[h.MessageConstatnts.KEYS.RECEIVER])),s.push(t)}),e(s))})}catch(e){t(new f.CometChatException(e))}})},c}();t.MessageController=r},function(e,t,n){"use strict";t.__esModule=!0;var s=n(4),r=n(1),o=function(){function e(){}return e.trasformJSONUser=function(e){var t;try{e.uid=e.uid.toString(),e.name=e.name.toString(),e.status&&"offline"!==e.status?e.status="online":e.status="offline",t=new s.User(e),Object.assign(t,e),e=t}catch(e){r.Logger.error("UsersController:transformJSONUser",e)}return e},e}();t.UsersController=o},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(12),i=n(3),a=n(2),c=function(){function e(e){this.store=r.constants.DEFAULT_STORE,s.isFalsy(e)||(this.store=e),this.localStore=o.createInstance({name:s.format(r.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),r.LOCAL_STORE.COMMON_STORE)}),this.localStore.setDriver([o.LOCALSTORAGE,o.INDEXEDDB,o.WEBSQL])}return e.getInstance=function(){return null==e.localStorage&&(e.localStorage=new e),e.localStorage},e.prototype.set=function(e,t){return this.localStore.setItem(e,JSON.stringify(t))},e.prototype.remove=function(e){this.localStore.removeItem(e)},e.prototype.update=function(e,t){this.remove(e),this.set(e,t)},e.prototype.get=function(e){var s=this;return new Promise(function(n,t){try{s.localStore.getItem(e).then(function(t){try{n(JSON.parse(t))}catch(e){n(t)}},function(e){t(e)})}catch(e){t(new a.CometChatException(e))}})},e.prototype.clearStore=function(){var s=this;return new Promise(function(n,t){try{s.localStore.keys().then(function(e){if(0<e.length)for(var t=0;t<e.length;t++)"appId"!==e[t]&&s.localStore.removeItem(e[t]),t===e.length-1&&n(!0)})}catch(e){t(e)}})},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.localStorage=null,e}();t.LocalStorage=c},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(e,t,n,s){this.receiverId=e,this.type=t,this.receiverType=n,this.category=s}return e.prototype.getId=function(){return this.id},e.prototype.setId=function(e){this.id=e},e.prototype.getConversationId=function(){return this.conversationId},e.prototype.setConversationId=function(e){this.conversationId=e},e.prototype.getParentMessageId=function(){return this.parentMessageId},e.prototype.setParentMessageId=function(e){this.parentMessageId=e},e.prototype.getMuid=function(){return this.muid},e.prototype.setMuid=function(e){this.muid=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e.prototype.getReceiver=function(){return this.receiver},e.prototype.setReceiver=function(e){this.receiver=e},e.prototype.getReceiverId=function(){return this.receiverId},e.prototype.setReceiverId=function(e){this.receiverId=e},e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.get=function(){return this.id},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setSentAt=function(e){this.sentAt=e},e.prototype.getSentAt=function(){return this.sentAt},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getDeliveredAt=function(){return this.deliveredAt},e.prototype.setDeliveredAt=function(e){this.deliveredAt=e},e.prototype.getDeliveredToMeAt=function(){return this.deliveredToMeAt},e.prototype.setDeliveredToMeAt=function(e){this.deliveredToMeAt=e},e.prototype.getReadAt=function(){return this.readAt},e.prototype.setReadAt=function(e){this.readAt=e},e.prototype.getReadByMeAt=function(){return this.readByMeAt},e.prototype.setReadByMeAt=function(e){this.readByMeAt=e},e.prototype.getCategory=function(){return this.category},e.prototype.setCategory=function(e){this.category=e},e.prototype.setEditedAt=function(e){this.editedAt=e},e.prototype.getEditedAt=function(){return this.editedAt},e.prototype.setEditedBy=function(e){this.editedBy=e},e.prototype.getEditedBy=function(){return this.editedBy},e.prototype.setDeletedAt=function(e){this.deletedAt=e},e.prototype.getDeletedAt=function(){return this.deletedAt},e.prototype.setDeletedBy=function(e){this.deletedBy=e},e.prototype.getDeletedBy=function(){return this.deletedBy},e.prototype.getReplyCount=function(){return this.replyCount},e.prototype.setReplyCount=function(e){this.replyCount=e},e.prototype.getRawMessage=function(){return this.rawMessage},e.prototype.setRawMessage=function(e){this.rawMessage=e},e}();t.BaseMessage=s},function(e,t,n){"use strict";t.__esModule=!0;var r=n(0),o=n(1),i=n(3),a=n(2);t.getUidFromJid=function(e){try{return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))}catch(e){o.Logger.error("XMPPUtils: getUidFromJid",e)}},t.getappIdFromJid=function(e){try{return e.substring(e.lastIndexOf("[")+1,e.lastIndexOf("]"))}catch(e){o.Logger.error("XMPPUtils: getappIdFromJid",e)}},t.getmessageIdFromStanzaId=function(t){try{return t?t.substring(t.lastIndexOf("]")+1,t.length):t}catch(e){return o.Logger.error("XMPPUtils: getmessageIdFromStanzaId",e),t}},t.parseHTML=function(t){try{return void 0!==t?t.textContent:t}catch(e){return o.Logger.error("XMPPUtils: parseHTML",e),t}},t.getJidFromUid=function(s){return new Promise(function(t,n){try{o.getAppSettings().then(function(e){t(o.format(r.XMPP.bare_jid_string,i.CometChat.getAppId(),s,o.getJidHost(e)))},function(e){t(o.format(r.XMPP.bare_jid_string,i.CometChat.getAppId(),s,r.XMPP.host))})}catch(e){n(new a.CometChatException(e))}})},t.getGUIDFromJID=function(e){try{return e.substring(e.indexOf("]")+1,e.indexOf("@"))}catch(e){o.Logger.error("XMPPUtils: getGUIDFromJID",e)}},t.getGroupJidFromGUID=function(s){return new Promise(function(t,n){try{o.getAppSettings().then(function(e){t(o.format(r.XMPP.muc_jid_string,i.CometChat.getAppId(),s,e[r.APP_SETTINGS.KEYS.GROUP_SERVICE],o.getJidHost(e)))},function(e){t(o.format(r.XMPP.muc_jid_string,i.CometChat.getAppId(),s,i.CometChat.getAppId(),r.XMPP.host))})}catch(e){n(new a.CometChatException(e))}})},t.getFullJidForGroup=function(e){try{return e.substring(e.indexOf("/")+1)}catch(e){o.Logger.error("XMPPUtils: getFullJidForGroup",e)}},t.getGroupJidFullGroupJid=function(e){try{return e.substring(0,e.indexOf("/"))}catch(e){o.Logger.error("XMPPUtils: getGroupJidFullGroupJid",e)}}},function(e,t,n){(function(s){e.exports=function r(o,i,a){function c(n,e){if(!i[n]){if(!o[n]){if(u)return u(n,!0);var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}var s=i[n]={exports:{}};o[n][0].call(s.exports,function(e){var t=o[n][1][e];return c(t||e)},s,s.exports,r,o,i,a)}return i[n].exports}for(var u=!1,e=0;e<a.length;e++)c(a[e]);return c}({1:[function(e,l,t){(function(t){"use strict";var n,s,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var r=0,o=new e(u),i=t.document.createTextNode("");o.observe(i,{characterData:!0}),n=function(){i.data=r=++r%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var a=new t.MessageChannel;a.port1.onmessage=u,n=function(){a.port2.postMessage(0)}}var c=[];function u(){var e,t;s=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}s=!1}l.exports=function(e){1!==c.push(e)||s||n()}}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function u(){}var l={},o=["REJECTED"],i=["FULFILLED"],a=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=a,this.queue=[],this.outcome=void 0,e!==u&&h(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function E(t,n,s){r(function(){var e;try{e=n(s)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,e)})}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(t,e){var n=!1;function s(e){n||(n=!0,l.reject(t,e))}function r(e){n||(n=!0,l.resolve(t,e))}var o=p(function(){e(r,s)});"error"===o.status&&s(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=s).prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!=typeof e&&this.state===i||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(u);if(this.state!==a){var s=this.state===i?e:t;E(n,s,this.outcome)}else this.queue.push(new c(n,e,t));return n},c.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){E(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){l.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){E(this.promise,this.onRejected,e)},l.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return l.reject(e,n.value);var s=n.value;if(s)h(e,s);else{e.state=i,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},l.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:l.resolve(new this(u),e)},s.reject=function(e){var t=new this(u);return l.reject(t,e)},s.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,r=!1;if(!s)return this.resolve([]);for(var o=new Array(s),i=0,t=-1,a=new this(u);++t<s;)c(e[t],t);return a;function c(e,t){n.resolve(e).then(function(e){o[t]=e,++i!==s||r||(r=!0,l.resolve(a,o))},function(e){r||(r=!0,l.reject(a,e))})}},s.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var r,o=-1,i=new this(u);++o<n;)r=e[o],t.resolve(r).then(function(e){s||(s=!0,l.resolve(i,e))},function(e){s||(s=!0,l.reject(i,e))});return i}},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var s="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,r=new s,o=0;o<t.length;o+=1)r.append(t[o]);return r.getBlob(n.type)}}"undefined"==typeof Promise&&e(3);var E=Promise;function d(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(e=String(e)),e}function o(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var a="local-forage-detect-blob-support",r=void 0,h={},p=Object.prototype.toString,S="readonly",g="readwrite";function C(e){return"boolean"==typeof r?E.resolve(r):(s=e,new E(function(n){var e=s.transaction(a,g),t=i([""]);e.objectStore(a).put(t,"key"),e.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)},e.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1})).then(function(e){return r=e});var s}function _(e){var t=h[e.name],n={};n.promise=new E(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function f(e){var t=h[e.name],n=t.deferredOperations.pop();if(n)return n.resolve(),n.promise}function T(e,t){var n=h[e.name],s=n.deferredOperations.pop();if(s)return s.reject(t),s.promise}function m(r,o){return new E(function(e,t){if(h[r.name]=h[r.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},r.db){if(!o)return e(r.db);_(r),r.db.close()}var n=[r.name];o&&n.push(r.version);var s=c.open.apply(c,n);o&&(s.onupgradeneeded=function(e){var t=s.result;try{t.createObjectStore(r.storeName),e.oldVersion<=1&&t.createObjectStore(a)}catch(e){if("ConstraintError"!==e.name)throw e}}),s.onerror=function(e){e.preventDefault(),t(s.error)},s.onsuccess=function(){e(s.result),f(r)}})}function A(e){return m(e,!1)}function I(e){return m(e,!0)}function R(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,r=e.version>e.db.version;if(s&&(e.version,e.version=e.db.version),r||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function N(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=0;r<t;r++)s[r]=e.charCodeAt(r);return n}(atob(e.data));return i([t],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function y(e){var t=this,n=t._initReady().then(function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return u(n,e,e),n}function P(t,n,s,r){void 0===r&&(r=1);try{var e=t.db.transaction(t.storeName,n);s(null,e)}catch(e){if(0<r&&(!t.db||"InvalidStateError"===e.name||"NotFoundError"===e.name))return E.resolve().then(function(){if(!t.db||"NotFoundError"===e.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),I(t)}).then(function(){return function(n){_(n);for(var s=h[n.name],r=s.forages,e=0;e<r.length;e++){var t=r[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return n.db=null,A(n).then(function(e){return n.db=e,R(n)?I(n):e}).then(function(e){n.db=s.db=e;for(var t=0;t<r.length;t++)r[t]._dbInfo.db=e}).catch(function(e){throw T(n,e),e})}(t).then(function(){P(t,n,s,r-1)})}).catch(s);s(e)}}var M={_driver:"asyncStorage",_initStorage:function(e){var s=this,r={db:null};if(e)for(var t in e)r[t]=e[t];var o=h[r.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},h[r.name]=o),o.forages.push(s),s._initReady||(s._initReady=s.ready,s.ready=y);var n=[];function i(){return E.resolve()}for(var a=0;a<o.forages.length;a++){var c=o.forages[a];c!==s&&n.push(c._initReady().catch(i))}var u=o.forages.slice(0);return E.all(n).then(function(){return r.db=o.db,A(r)}).then(function(e){return r.db=e,R(r,s._defaultConfig.version)?I(r):e}).then(function(e){r.db=o.db=e,s._dbInfo=r;for(var t=0;t<u.length;t++){var n=u[t];n!==s&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}})},_support:function(){try{if(!c)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(a,e){var c=this,t=new E(function(o,i){c.ready().then(function(){P(c._dbInfo,S,function(e,t){if(e)return i(e);try{var n=t.objectStore(c._dbInfo.storeName),s=n.openCursor(),r=1;s.onsuccess=function(){var e=s.result;if(e){var t=e.value;O(t)&&(t=N(t));var n=a(t,e.key,r++);void 0!==n?o(n):e.continue()}else o()},s.onerror=function(){i(s.error)}}catch(e){i(e)}})}).catch(i)});return d(t,e),t},getItem:function(i,e){var a=this;i=l(i);var t=new E(function(r,o){a.ready().then(function(){P(a._dbInfo,S,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.get(i);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),O(e)&&(e=N(e)),r(e)},s.onerror=function(){o(s.error)}}catch(e){o(e)}})}).catch(o)});return d(t,e),t},setItem:function(a,t,e){var c=this;a=l(a);var n=new E(function(o,i){var e;c.ready().then(function(){return e=c._dbInfo,"[object Blob]"===p.call(t)?C(e.db).then(function(e){return e?t:(s=t,new E(function(n,e){var t=new FileReader;t.onerror=e,t.onloadend=function(e){var t=btoa(e.target.result||"");n({__local_forage_encoded_blob:!0,data:t,type:s.type})},t.readAsBinaryString(s)}));var s}):t}).then(function(r){P(c._dbInfo,g,function(e,t){if(e)return i(e);try{var n=t.objectStore(c._dbInfo.storeName);null===r&&(r=void 0);var s=n.put(r,a);t.oncomplete=function(){void 0===r&&(r=null),o(r)},t.onabort=t.onerror=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return d(n,e),n},removeItem:function(i,e){var a=this;i=l(i);var t=new E(function(r,o){a.ready().then(function(){P(a._dbInfo,g,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.delete(i);t.oncomplete=function(){r()},t.onerror=function(){o(s.error)},t.onabort=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return d(t,e),t},clear:function(e){var i=this,t=new E(function(r,o){i.ready().then(function(){P(i._dbInfo,g,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName),s=n.clear();t.oncomplete=function(){r()},t.onabort=t.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return d(t,e),t},length:function(e){var i=this,t=new E(function(r,o){i.ready().then(function(){P(i._dbInfo,S,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName),s=n.count();s.onsuccess=function(){r(s.result)},s.onerror=function(){o(s.error)}}catch(e){o(e)}})}).catch(o)});return d(t,e),t},key:function(a,e){var c=this,t=new E(function(o,i){a<0?o(null):c.ready().then(function(){P(c._dbInfo,S,function(e,t){if(e)return i(e);try{var n=t.objectStore(c._dbInfo.storeName),s=!1,r=n.openCursor();r.onsuccess=function(){var e=r.result;e?0===a?o(e.key):s?o(e.key):(s=!0,e.advance(a)):o(null)},r.onerror=function(){i(r.error)}}catch(e){i(e)}})}).catch(i)});return d(t,e),t},keys:function(e){var a=this,t=new E(function(o,i){a.ready().then(function(){P(a._dbInfo,S,function(e,t){if(e)return i(e);try{var n=t.objectStore(a._dbInfo.storeName),s=n.openCursor(),r=[];s.onsuccess=function(){var e=s.result;e?(r.push(e.key),e.continue()):o(r)},s.onerror=function(){i(s.error)}}catch(e){i(e)}})}).catch(i)});return d(t,e),t},dropInstance:function(a,e){e=o.apply(this,arguments);var t,n=this.config();if((a="function"!=typeof a&&a||{}).name||(a.name=a.name||n.name,a.storeName=a.storeName||n.storeName),a.name){var s=a.name===n.name&&this._dbInfo.db,r=s?E.resolve(this._dbInfo.db):A(a).then(function(e){var t=h[a.name],n=t.forages;t.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e});t=a.storeName?r.then(function(e){if(e.objectStoreNames.contains(a.storeName)){var r=e.version+1;_(a);var s=h[a.name],o=s.forages;e.close();for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=null,n._dbInfo.version=r}var i=new E(function(t,n){var s=c.open(a.name,r);s.onerror=function(e){var t=s.result;t.close(),n(e)},s.onupgradeneeded=function(){var e=s.result;e.deleteObjectStore(a.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}});return i.then(function(e){s.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,f(n._dbInfo)}}).catch(function(e){throw(T(a,e)||E.resolve()).catch(function(){}),e})}}):r.then(function(e){_(a);var s=h[a.name],r=s.forages;e.close();for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=null}var o=new E(function(t,n){var s=c.deleteDatabase(a.name);s.onerror=s.onblocked=function(e){var t=s.result;t&&t.close(),n(e)},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}});return o.then(function(e){s.db=e;for(var t=0;t<r.length;t++){var n=r[t];f(n._dbInfo)}}).catch(function(e){throw(T(a,e)||E.resolve()).catch(function(){}),e})})}else t=E.reject("Invalid arguments");return d(t,e),t}},v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,D="__lfsc__:",U=D.length,w="arbf",b="blob",G=U+w.length,Y=Object.prototype.toString;function x(e){var t,n,s,r,o,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var u=new ArrayBuffer(i),l=new Uint8Array(u);for(t=0;t<a;t+=4)n=v.indexOf(e[t]),s=v.indexOf(e[t+1]),r=v.indexOf(e[t+2]),o=v.indexOf(e[t+3]),l[c++]=n<<2|s>>4,l[c++]=(15&s)<<4|r>>2,l[c++]=(3&r)<<6|63&o;return u}function F(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=v[n[t]>>2],s+=v[(3&n[t])<<4|n[t+1]>>4],s+=v[(15&n[t+1])<<2|n[t+2]>>6],s+=v[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var B={serialize:function(t,n){var e="";if(t&&(e=Y.call(t)),t&&("[object ArrayBuffer]"===e||t.buffer&&"[object ArrayBuffer]"===Y.call(t.buffer))){var s,r=D;t instanceof ArrayBuffer?(s=t,r+=w):(s=t.buffer,"[object Int8Array]"===e?r+="si08":"[object Uint8Array]"===e?r+="ui08":"[object Uint8ClampedArray]"===e?r+="uic8":"[object Int16Array]"===e?r+="si16":"[object Uint16Array]"===e?r+="ur16":"[object Int32Array]"===e?r+="si32":"[object Uint32Array]"===e?r+="ui32":"[object Float32Array]"===e?r+="fl32":"[object Float64Array]"===e?r+="fl64":n(new Error("Failed to get type for BinaryArray"))),n(r+F(s))}else if("[object Blob]"===e){var o=new FileReader;o.onload=function(){var e="~~local_forage_type~"+t.type+"~"+F(this.result);n(D+b+e)},o.readAsArrayBuffer(t)}else try{n(JSON.stringify(t))}catch(e){n(null,e)}},deserialize:function(e){if(e.substring(0,U)!==D)return JSON.parse(e);var t,n=e.substring(G),s=e.substring(U,G);if(s===b&&L.test(n)){var r=n.match(L);t=r[1],n=n.substring(r[0].length)}var o=x(n);switch(s){case w:return o;case b:return i([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+s)}},stringToBuffer:x,bufferToString:F};function K(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function H(e,s,r,o,i,a){e.executeSql(r,o,i,function(e,n){n.code===n.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[s.storeName],function(e,t){t.rows.length?a(e,n):K(e,s,function(){e.executeSql(r,o,i,a)},a)},a):a(e,n)},a)}function k(i,e,a,c){var u=this;i=l(i);var t=new E(function(r,o){u.ready().then(function(){void 0===e&&(e=null);var n=e,s=u._dbInfo;s.serializer.serialize(e,function(t,e){e?o(e):s.db.transaction(function(e){H(e,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[i,t],function(){r(n)},function(e,t){o(t)})},function(e){if(e.code===e.QUOTA_ERR){if(0<c)return void r(k.apply(u,[i,n,a,c-1]));o(e)}})})}).catch(o)});return d(t,a),t}var V={_driver:"webSQLStorage",_initStorage:function(e){var s=this,r={db:null};if(e)for(var t in e)r[t]="string"!=typeof e[t]?e[t].toString():e[t];var n=new E(function(t,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(e){K(e,r,function(){s._dbInfo=r,t()},function(e,t){n(t)})},n)});return r.serializer=B,n},_support:"function"==typeof openDatabase,iterate:function(u,e){var t=this,n=new E(function(c,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(e){H(e,a,"SELECT * FROM "+a.storeName,[],function(e,t){for(var n=t.rows,s=n.length,r=0;r<s;r++){var o=n.item(r),i=o.value;if(i&&(i=a.serializer.deserialize(i)),void 0!==(i=u(i,o.key,r+1)))return void c(i)}c()},function(e,t){n(t)})})}).catch(n)});return d(n,e),n},getItem:function(t,e){var o=this;t=l(t);var n=new E(function(r,n){o.ready().then(function(){var s=o._dbInfo;s.db.transaction(function(e){H(e,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[t],function(e,t){var n=t.rows.length?t.rows.item(0).value:null;n&&(n=s.serializer.deserialize(n)),r(n)},function(e,t){n(t)})})}).catch(n)});return d(n,e),n},setItem:function(e,t,n){return k.apply(this,[e,t,n,1])},removeItem:function(r,e){var o=this;r=l(r);var t=new E(function(n,s){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){H(e,t,"DELETE FROM "+t.storeName+" WHERE key = ?",[r],function(){n()},function(e,t){s(t)})})}).catch(s)});return d(t,e),t},clear:function(e){var r=this,t=new E(function(n,s){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){H(e,t,"DELETE FROM "+t.storeName,[],function(){n()},function(e,t){s(t)})})}).catch(s)});return d(t,e),t},length:function(e){var r=this,t=new E(function(s,n){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){H(e,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(e,t){var n=t.rows.item(0).c;s(n)},function(e,t){n(t)})})}).catch(n)});return d(t,e),t},key:function(r,e){var o=this,t=new E(function(s,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){H(e,t,"SELECT key FROM "+t.storeName+" WHERE id = ? LIMIT 1",[r+1],function(e,t){var n=t.rows.length?t.rows.item(0).key:null;s(n)},function(e,t){n(t)})})}).catch(n)});return d(t,e),t},keys:function(e){var s=this,t=new E(function(r,n){s.ready().then(function(){var t=s._dbInfo;t.db.transaction(function(e){H(e,t,"SELECT key FROM "+t.storeName,[],function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).key);r(n)},function(e,t){n(t)})})}).catch(n)});return d(t,e),t},dropInstance:function(n,e){e=o.apply(this,arguments);var s=this.config();(n="function"!=typeof n&&n||{}).name||(n.name=n.name||s.name,n.storeName=n.storeName||s.storeName);var t,r=this;return d(t=n.name?new E(function(e){var t,o;t=n.name===s.name?r._dbInfo.db:openDatabase(n.name,"","",0),n.storeName?e({db:t,storeNames:[n.storeName]}):e((o=t,new E(function(r,n){o.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).name);r({db:o,storeNames:n})},function(e,t){n(t)})},function(e){n(e)})})))}).then(function(a){return new E(function(o,i){a.db.transaction(function(s){function e(t){return new E(function(e,n){s.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(e,t){n(t)})})}for(var t=[],n=0,r=a.storeNames.length;n<r;n++)t.push(e(a.storeNames[n]));E.all(t).then(function(){o()}).catch(function(e){i(e)})},function(e){i(e)})})}):E.reject("Invalid arguments"),e),t}};function J(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function X(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||0<localStorage.length}var j={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=J(e,this._defaultConfig),X()?((this._dbInfo=t).serializer=B,E.resolve()):E.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(c,e){var u=this,t=u.ready().then(function(){for(var e=u._dbInfo,t=e.keyPrefix,n=t.length,s=localStorage.length,r=1,o=0;o<s;o++){var i=localStorage.key(o);if(0===i.indexOf(t)){var a=localStorage.getItem(i);if(a&&(a=e.serializer.deserialize(a)),void 0!==(a=c(a,i.substring(n),r++)))return a}}});return d(t,e),t},getItem:function(n,e){var s=this;n=l(n);var t=s.ready().then(function(){var e=s._dbInfo,t=localStorage.getItem(e.keyPrefix+n);return t&&(t=e.serializer.deserialize(t)),t});return d(t,e),t},setItem:function(i,e,t){var a=this;i=l(i);var n=a.ready().then(function(){void 0===e&&(e=null);var o=e;return new E(function(n,s){var r=a._dbInfo;r.serializer.serialize(e,function(e,t){if(t)s(t);else try{localStorage.setItem(r.keyPrefix+i,e),n(o)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}})})});return d(n,t),n},removeItem:function(t,e){var n=this;t=l(t);var s=n.ready().then(function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return d(s,e),s},clear:function(e){var s=this,t=s.ready().then(function(){for(var e=s._dbInfo.keyPrefix,t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}});return d(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return d(t,e),t},key:function(n,e){var s=this,t=s.ready().then(function(){var t,e=s._dbInfo;try{t=localStorage.key(n)}catch(e){t=null}return t&&(t=t.substring(e.keyPrefix.length)),t});return d(t,e),t},keys:function(e){var o=this,t=o.ready().then(function(){for(var e=o._dbInfo,t=localStorage.length,n=[],s=0;s<t;s++){var r=localStorage.key(s);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n});return d(t,e),t},dropInstance:function(t,e){if(e=o.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var s,r=this;return d(s=t.name?new E(function(e){t.storeName?e(J(t,r._defaultConfig)):e(t.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):E.reject("Invalid arguments"),e),s}},q=function(e,t){for(var n=e.length,s=0;s<n;){if((r=e[s])===(o=t)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;s++}var r,o;return!1},W=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Q={},z={},$={INDEXEDDB:M,WEBSQL:V,LOCALSTORAGE:j},Z=[$.INDEXEDDB._driver,$.WEBSQL._driver,$.LOCALSTORAGE._driver],ee=["dropInstance"],te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),ne={description:"",driver:Z.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function se(t,n){t[n]=function(){var e=arguments;return t.ready().then(function(){return t[n].apply(t,e)})}}function re(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(W(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var oe=function(){function r(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),$)if($.hasOwnProperty(t)){var n=$[t],s=n._driver;this[t]=s,Q[s]||this.defineDriver(n)}this._defaultConfig=re({},ne),this._config=re({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return r.prototype.config=function(e){if("object"!==(void 0===e?"undefined":s(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},r.prototype.defineDriver=function(l,e,t){var n=new E(function(t,n){try{var s=l._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver)return void n(e);for(var r=te.concat("_initStorage"),o=0,i=r.length;o<i;o++){var a=r[o],c=!q(ee,a);if((c||l[a])&&"function"!=typeof l[a])return void n(e)}!function(){for(var e=function(n){return function(){var e=new Error("Method "+n+" is not implemented by the current driver"),t=E.reject(e);return d(t,arguments[arguments.length-1]),t}},t=0,n=ee.length;t<n;t++){var s=ee[t];l[s]||(l[s]=e(s))}}();var u=function(e){Q[s],Q[s]=l,z[s]=e,t()};"_support"in l?l._support&&"function"==typeof l._support?l._support().then(u,n):u(!!l._support):u(!0)}catch(e){n(e)}});return u(n,e,t),n},r.prototype.driver=function(){return this._driver||null},r.prototype.getDriver=function(e,t,n){var s=Q[e]?E.resolve(Q[e]):E.reject(new Error("Driver not found."));return u(s,t,n),s},r.prototype.getSerializer=function(e){var t=E.resolve(B);return u(t,e),t},r.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return u(n,e,e),n},r.prototype.setDriver=function(e,t,n){var o=this;W(e)||(e=[e]);var s=this._getSupportedDrivers(e);function i(){o._config.driver=o.driver()}function a(e){return o._extend(e),i(),o._ready=o._initStorage(o._config),o._ready}var r=null!==this._driverSet?this._driverSet.catch(function(){return E.resolve()}):E.resolve();return this._driverSet=r.then(function(){var e=s[0];return o._dbInfo=null,o._ready=null,o.getDriver(e).then(function(e){var r;o._driver=e._driver,i(),o._wrapLibraryMethodsWithReady(),o._initDriver=(r=s,function(){var n=0;function s(){for(;n<r.length;){var e=r[n];return n++,o._dbInfo=null,o._ready=null,o.getDriver(e).then(a).catch(s)}i();var t=new Error("No available storage method found.");return o._driverSet=E.reject(t),o._driverSet}return s()})})}).catch(function(){i();var e=new Error("No available storage method found.");return o._driverSet=E.reject(e),o._driverSet}),u(this._driverSet,t,n),this._driverSet},r.prototype.supports=function(e){return!!z[e]},r.prototype._extend=function(e){re(this,e)},r.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var r=e[n];this.supports(r)&&t.push(r)}return t},r.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)se(this,te[e])},r.prototype.createInstance=function(e){return new r(e)},r}(),ie=new oe;t.exports=ie},{3:3}]},{},[4])(4)}).call(this,n(28))},function(e,t,n){"use strict";t.__esModule=!0,t.SERVER_ERRORS={AUTH_ERR:{code:"AUTH_ERR_AUTH_TOKEN_NOT_FOUND",message:"The auth token %s% does not exist. Please make sure you are logged in and have a valid auth token or try login again."}},t.ERRORS={PARAMETER_MISSING:{code:"MISSING_PARAMETERS",name:"Invalid or no parameter passed to the method."}},t.INIT_ERROR={NO_APP_ID:{code:t.ERRORS.PARAMETER_MISSING.code,name:t.ERRORS.PARAMETER_MISSING.name,message:"AppID cannot be empty. Please specify a valid appID.",details:{}}},t.GROUP_CREATION_ERRORS={EMPTY_PASSWORD:{code:"ERR_EMPTY_GROUP_PASS",details:void 0,message:"Password is mandatory to join a group.",name:void 0}},t.USERS_REQUEST_ERRORS={EMPTY_USERS_LIST:{code:"EMPTY_USERS_LIST",name:"EMPTY_USERS_LIST",message:"The users list needs to have atleast one UID.",details:{}}},t.MESSAGES_REQUEST_ERRORS={REQUEST_IN_PROGRESS_ERROR:{code:"REQUEST_IN_PROGRESS",name:"REQUEST_IN_PROGRESS",message:"Request in progress.",details:{}},NOT_ENOUGH_PARAMS:{code:"NOT_ENOUGH_PARAMETERS",name:"NOT_ENOUGH_PARAMETERS",message:"`Timestamp`, `MessageId` or `updatedAfter` is required to use the 'fetchNext()' method.",details:{}}},t.MESSAGE_ERRORS={INVALID_CUSTOM_DATA:{code:"-1",name:"%s_CUSTOM_DATA",message:"",details:{}}},t.LOGIN_ERROR={NOT_INITIALIZED:{code:"-1",name:"COMETCHAT_INITIALIZATION_NOT_DONE",message:"please initialize the cometchat before using login method.",details:{}},UNAUTHORISED:{code:401,name:"USER_NOT_AUTHORISED",message:"The `authToken` of the user is not authorised. Please verify again.",details:{}},XMPP_CONNECTION_FAIL:{code:-1,name:"WS_CONNECTION_FAIL",message:"WS Connection failed. %s",details:{}},XMPP_CONNECTION_FAIL_PORT_ERROR:{code:-1,name:"WS_CONNECTION_FAIL",message:"WS Connection failed. Trying to connect with port: %s",details:{}},XMPP_CONNECTION_FALLBACK_FAIL_PORT_ERROR:{code:-1,name:"WS_CONNECTION_FALLBACK_FAIL",message:"WS Connection fallback failed. Trying to connect with port: %s",details:{}},XMPP_AUTH_FAIL:{code:-1,name:"WS_AUTH_FAIL",message:"WS username/password not correct.",details:{}},NO_INTERNET:{code:-1,name:"NO_INTERNET_CONNECTION",message:"You do not have internet connection.",details:{}},REQUEST_IN_PROGRESS:{code:-1,name:"LOGIN_IN_PROGRESS",message:"Please wait until the previous login request ends.",details:{}}},t.TYPINGNOTIFICATION_CONSTANTS={TOO_MANY_REQUEST:{code:"TOO_MANY_REQUEST",name:"TOO MANY REQUEST",message:"too many request, wait for `%s` seconds before sending next request.",details:{}}},t.FETCH_ERROR={ERROR_IN_API_CALL:{code:"FAILED_TO_FETCH",name:"FAILED_TO_FETCH",message:"There is an unknown issue with the API request. Please check your internet connection and verify the api call.",details:{}}}},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},a=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var E=n(1),S=n(31),c=n(3),o=n(21),d=n(7),h=n(0),p=n(32),g=(n(46),n(47),n(48),n(23)),C=n(11),u=n(49),_=n(4),f=n(24),T=n(33),m=n(9),A=n(35),I=n(25),R=n(36),N=n(26),O=n(8),y=n(38),P=n(2);S.Strophe.addConnectionPlugin("pubsub",{_connection:null,init:function(e){this._connection=e,S.Strophe.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),S.Strophe.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",S.Strophe.NS.PUBSUB+"#subscribe_options"),S.Strophe.addNamespace("PUBSUB_ERRORS",S.Strophe.NS.PUBSUB+"#errors"),S.Strophe.addNamespace("PUBSUB_EVENT",S.Strophe.NS.PUBSUB+"#event"),S.Strophe.addNamespace("PUBSUB_OWNER",S.Strophe.NS.PUBSUB+"#owner"),S.Strophe.addNamespace("PUBSUB_AUTO_CREATE",S.Strophe.NS.PUBSUB+"#auto-create"),S.Strophe.addNamespace("PUBSUB_PUBLISH_OPTIONS",S.Strophe.NS.PUBSUB+"#publish-options"),S.Strophe.addNamespace("PUBSUB_NODE_CONFIG",S.Strophe.NS.PUBSUB+"#node_config"),S.Strophe.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",S.Strophe.NS.PUBSUB+"#create-and-configure"),S.Strophe.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",S.Strophe.NS.PUBSUB+"#subscribe_authorization"),S.Strophe.addNamespace("PUBSUB_GET_PENDING",S.Strophe.NS.PUBSUB+"#get-pending"),S.Strophe.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",S.Strophe.NS.PUBSUB+"#manage-subscriptions"),S.Strophe.addNamespace("PUBSUB_META_DATA",S.Strophe.NS.PUBSUB+"#meta-data")},createNode:function(e,t,n,s,r){var o=this._connection.getUniqueId("pubsubcreatenode"),i=S.$iq({from:e,to:t,type:"set",id:o}),a=S.Strophe.xmlElement("configure",[]),c=S.Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),u=S.Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),l=S.Strophe.xmlElement("value",[]),E=S.Strophe.xmlTextNode(S.Strophe.NS.PUBSUB+"#node_config");for(var d in l.appendChild(E),u.appendChild(l),c.appendChild(u),s){var h=s[d];c.appendChild(h)}return s.length&&0!=s.length&&a.appendChild(c),i.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).c("create",{node:n}).up().cnode(a),this._connection.addHandler(r,null,"iq",null,o,null),this._connection.send(i.tree()),o},subscribe:function(e,t,n,s,r,o){var i=this._connection.getUniqueId("subscribenode"),a=S.Strophe.xmlElement("options",[]),c=S.Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),u=S.Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),l=S.Strophe.xmlElement("value",[]),E=S.Strophe.xmlTextNode(S.Strophe.NS.PUBSUB_SUBSCRIBE_OPTIONS);l.appendChild(E),u.appendChild(l),c.appendChild(u);var d=S.$iq({from:e,to:t,type:"set",id:i});if(s&&s.length&&0!==s.length){for(var h=0;h<s.length;h++){var p=s[h];c.appendChild(p)}a.appendChild(c),d.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).c("subscribe",{node:n,jid:e}).up().cnode(a)}else d.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).c("subscribe",{node:n,jid:e});return this._connection.addHandler(o,null,"iq",null,i,null),this._connection.addHandler(r,null,"message",null,null,null),this._connection.send(d.tree()),i},unsubscribe:function(e,t,n,s){var r=this._connection.getUniqueId("unsubscribenode"),o=S.$iq({from:e,to:t,type:"set",id:r});return o.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).c("unsubscribe",{node:n,jid:e}),this._connection.addHandler(s,null,"iq",null,r,null),this._connection.send(o.tree()),r},publish:function(e,t,n,s,r){var o=this._connection.getUniqueId("publishnode"),i=S.Strophe.xmlElement("publish",[["node",n],["jid",e]]);for(var a in s){var c=S.Strophe.xmlElement("item",[]),u=S.Strophe.xmlElement("entry",[]),l=S.Strophe.xmlTextNode(s[a]);u.appendChild(l),c.appendChild(u),i.appendChild(c)}var E=S.$iq({from:e,to:t,type:"set",id:o});return E.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).cnode(i),this._connection.addHandler(r,null,"iq",null,o,null),this._connection.send(E.tree()),o},items:function(e,t,n,s,r){var o=S.$iq({from:e,to:t,type:"get"});return o.c("pubsub",{xmlns:S.Strophe.NS.PUBSUB}).c("items",{node:n}),this._connection.sendIQ(o.tree(),s,r)}});var l=function(){function l(){this.messageHandlers=[],this.XMPPConnectionHandlers=[],this.userHandlers=[],this.callHandlers=[],this.groupHandlers=[],this.loginHandlers=[],this.joinedGroups=[],this.iqHandlers=[]}return l.getInstance=function(){try{return null!=this.xMPPConnectionHelper&&null!=this.xMPPConnectionHelper||(this.xMPPConnectionHelper=new l),this.xMPPConnectionHelper}catch(e){E.Logger.error("Error in getInstance",e)}},l.prototype.XMPPConnect=function(e,s){var r=this,o="wss://",i="/ws/";return e&&(o="https://",i="/http-bind/"),new Promise(function(t,n){try{E.isFalsy(s)&&(s=e?l.XMPP_BIND_URL_HTTPS:l.XMPP_BIND_URL_WS),m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){l.XMPP_BIND_URL=o+E.getChatHost(e)+":"+e[h.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+i,r.connection=new S.Strophe.Connection(l.XMPP_BIND_URL),t(!0)}):(l.XMPP_BIND_URL=o+E.getChatHost(e)+":"+e[h.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+i,r.connection=new S.Strophe.Connection(l.XMPP_BIND_URL),t(!0))})}catch(e){n(new P.CometChatException(e))}})},l.prototype.XMPPDisconnect=function(){try{this.connection?(this.connection.flush(),this.connection.disconnect(),clearInterval(this.pingInterval)):E.Logger.info("XMPPPHelper","No connection object found")}catch(e){E.Logger.error("XMPPHelper: XMPPDisconnect",e)}},l.prototype.XMMPLogin=function(t,n,e,s){var r=this;void 0===n&&(n=h.XMPP.deafult_password);try{this.XMPPConnect(e).then(function(e){r.connection.connected?s(S.Strophe.Status.CONNECTED):(clearInterval(r.pingInterval),m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){r.perfomAfterConnection(t,n,s,E.getChatHost(e),E.getJidHost(e))}):r.perfomAfterConnection(t,n,s,E.getChatHost(e),E.getJidHost(e))}))})}catch(e){E.Logger.error("XMPPHelper: XMPPLogin",e)}},l.prototype.getPresenceInfo=function(s,t){var r=this;try{var e="somename"+(new Date).getTime();this.addIqHandler(e,function(e){t(e)}),E.getAppSettings().then(function(e){var t=E.getJidHost(e),n=S.$iq({from:r.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:t}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(s));r.connection.send(n)},function(e){E.Logger.error("XMPPHelper: getPresenceInfo",e);var t=S.$iq({from:r.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:h.XMPP.host}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(s));r.connection.send(t)})}catch(e){E.Logger.error("XMPPHelper: getPresenceInfo",e)}},l.prototype.sendTypingStarted=function(n,s,r){var o=this;void 0===s&&(s=h.XMPP.CONVERSATION.TYPE.CHAT);try{n&&this.connection&&!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&c.CometChat.getLoggedInUser().then(function(e){var t=new _.User(e);t.setAuthToken(""),o.connection.chatstates.sendComposing(n,s,t,r)})}catch(e){E.Logger.error("XMPPHelper: sendTypingStarted",e)}},l.prototype.sendTypingPaused=function(n,s,r){var o=this;void 0===s&&(s=h.XMPP.CONVERSATION.TYPE.CHAT);try{n&&this.connection&&!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&c.CometChat.getLoggedInUser().then(function(e){var t=new _.User(e);t.setAuthToken(""),o.connection.chatstates.sendPaused(n,s,t,r)})}catch(e){E.Logger.error("XMPPHelper: sendTypingPaused",e)}},l.prototype.addMessageEventListener=function(t,e){try{this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!=t}),this.messageHandlers=this.messageHandlers.concat([new o.MessageListener(t,e)])}catch(e){E.Logger.error("XMPPHelper: addMessageEventListener",e)}},l.prototype.removeMessageEventListener=function(t){try{this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeMessageEventListener",e)}},l.prototype.addXMPPConnectionEventListener=function(t,e){try{this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.filter(function(e){return e._name!=t}),this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.concat([new L(t,e)])}catch(e){E.Logger.error("XMPPHelper: addXMPPConnectionEventListener",e)}},l.prototype.removeXMPPConnectionEventListener=function(t){try{this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeXMPPConnectionEventListener",e)}},l.prototype.addCallEventListener=function(t,e){try{this.callHandlers=this.callHandlers.filter(function(e){return e._name!=t}),this.callHandlers=this.callHandlers.concat([new o.CallListener(t,e)])}catch(e){E.Logger.error("XMPPHelper: addCallEventListener",e)}},l.prototype.removeCallEventListener=function(t){try{this.callHandlers=this.callHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeCallEventListener",e)}},l.prototype.addUserEventListener=function(t,e){try{this.userHandlers=this.userHandlers.filter(function(e){return e._name!=t}),this.userHandlers=this.userHandlers.concat([new o.UserListener(t,e)])}catch(e){E.Logger.error("XMPPHelper: addUserEventListener",e)}},l.prototype.removeUserEventListener=function(t){try{this.userHandlers=this.userHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeUserEventListener",e)}},l.prototype.addGroupEventListener=function(t,e){try{this.groupHandlers=this.groupHandlers.filter(function(e){return e._name!=t}),this.groupHandlers=this.groupHandlers.concat([new o.GroupListener(t,e)])}catch(e){E.Logger.error("XMPPHelper: addGroupEventListener",e)}},l.prototype.removeGroupEventListener=function(t){try{this.groupHandlers=this.groupHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeGroupEventListener",e)}},l.prototype.addLoginEventListener=function(t,e){try{this.loginHandlers=this.loginHandlers.filter(function(e){return e._name!=t}),this.loginHandlers=this.loginHandlers.concat([new o.LoginListener(t,e)])}catch(e){E.Logger.error("XMPPHelper: addLoginEventListener",e)}},l.prototype.removeLoginEventListener=function(t){try{this.loginHandlers=this.loginHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeLoginEventListener",e)}},l.prototype.addIqHandler=function(e,t){try{this.iqHandlers=this.iqHandlers.concat([new o.Listener(e,t)])}catch(e){E.Logger.error("XMPPHelper: addIqHandler",e)}},l.prototype.removeIqHandler=function(t){try{this.iqHandlers=this.iqHandlers.filter(function(e){return e._name!==t})}catch(e){E.Logger.error("XMPPHelper: removeIqHandler",e)}},l.prototype.joinMuc=function(t){var n=this;try{!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&this.connection&&E.getAppSettings().then(function(e){n.connection.muc.join(E.format(h.XMPP.muc_jid_string,c.CometChat.getAppId(),t.getGuid(),c.CometChat.getAppId(),E.getJidHost(e)),n.connection.jid,null,null,null,null,0)})}catch(e){E.Logger.error("XMPPHelper: joinMuc",e)}},l.prototype.leaveMuc=function(t){var n=this;try{!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&this.connection&&E.getAppSettings().then(function(e){n.connection.muc.leave(E.format(h.XMPP.muc_jid_string,c.CometChat.getAppId(),t,c.CometChat.getAppId(),E.getJidHost(e)),n.connection.jid)})}catch(e){E.Logger.error("XMPPHelper: leaveMuc",e)}},l.prototype.getUsersVCard=function(e,t){var n=this;try{C.getJidFromUid(e).then(function(e){c.CometChat.getConnectionStatus()===h.CONNECTION_STATUS.CONNECTED&&n.connection.vcard.get(function(e){t(u.VCardController.transformVCard(e))},e)})}catch(e){E.Logger.error("XMPPHelper: getUsersVCard",e)}},l.prototype.trigerMessageHandler=function(n,e){if(E.isFalsy(e))n=d.MessageController.trasformJSONMessge(n),this.messageHandlers.map(function(e){try{if(e._eventListener)if(n instanceof g.Action);else if(n instanceof f.Call);else{var t=n;switch(t.getType()){case h.MessageConstatnts.TYPE.TEXT:E.isFalsy(e._eventListener.onTextMessageReceived)||e._eventListener.onTextMessageReceived(n);break;case h.MessageConstatnts.TYPE.CUSTOM:E.isFalsy(e._eventListener.onCustomMessageReceived)||e._eventListener.onCustomMessageReceived(n);break;default:t.getCategory()==h.MessageCategory.CUSTOM?E.isFalsy(e._eventListener.onCustomMessageReceived)||e._eventListener.onCustomMessageReceived(n):E.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onMediaMessageReceived(n)}}}catch(e){E.Logger.error("XMPPHelper: trigerMessageHandler",e)}}),n instanceof f.Call&&this.publishCallEvents(n),n instanceof g.Action&&this.publishActionEvents(n);else if(n=d.MessageController.trasformJSONMessge(n),this.messageHandlers[e]._eventListener)try{if(this.messageHandlers[e]._eventListener)if(n instanceof g.Action);else if(n instanceof f.Call);else{var t=n;switch(t.getType()){case h.MessageConstatnts.TYPE.TEXT:E.isFalsy(this.messageHandlers[e]._eventListener.onTextMessageReceived)||this.messageHandlers[e]._eventListener.onTextMessageReceived(n);break;case h.MessageConstatnts.TYPE.CUSTOM:E.isFalsy(this.messageHandlers[e]._eventListener.onCustomMessageReceived)||this.messageHandlers[e]._eventListener.onCustomMessageReceived(n);break;default:t.getCategory()==h.MessageCategory.CUSTOM?E.isFalsy(this.messageHandlers[e]._eventListener.onCustomMessageReceived)||this.messageHandlers[e]._eventListener.onCustomMessageReceived(n):E.isFalsy(this.messageHandlers[e]._eventListener.onMediaMessageReceived)||this.messageHandlers[e]._eventListener.onMediaMessageReceived(n)}}}catch(e){E.Logger.error("XMPPHelper: trigerMessageHandler",e)}},l.prototype.publishActionEvents=function(n){var s=this;try{switch(n.getAction()){case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_JOINED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserJoined)||e._eventListener.onUserJoined(n,n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_INVITED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserJoined)||e._eventListener.onUserJoined(n,n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_LEFT:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserLeft)||e._eventListener.onUserLeft(n,n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_BANNED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserBanned)||e._eventListener.onUserBanned(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_KICKED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserKicked)||e._eventListener.onUserKicked(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_UNBANNED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onUserUnbanned)||e._eventListener.onUserUnbanned(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_SCOPE_CHANGED:this.groupHandlers.map(function(e){E.isFalsy(e._eventListener.onMemberScopeChanged)||e._eventListener.onMemberScopeChanged(n,n.getActionOn(),n.getNewScope(),n.getOldScope(),n.getActionFor())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MESSAGE_EDITED:this.messageHandlers.map(function(e){E.isFalsy(e._eventListener.onMessageEdited)||e._eventListener.onMessageEdited(n.getActionOn())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MESSAGE_DELETED:this.messageHandlers.map(function(e){E.isFalsy(e._eventListener.onMessageDeleted)||e._eventListener.onMessageDeleted(n.getActionOn())});break;case h.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_ADDED:var e=n.getActionOn();C.getJidFromUid(e.getUid()).then(function(e){e==S.Strophe.getBareJidFromJid(s.connection.jid)&&(s.joinMuc(n.getActionFor()),s.markAsDelivered(n.getActionFor().guid,"group",n.getId()))}),this.groupHandlers.map(function(t){var e=n.getActionOn();C.getJidFromUid(e.getUid()).then(function(e){e==S.Strophe.getBareJidFromJid(s.connection.jid)&&s.joinMuc(n.getActionFor()),E.isFalsy(t._eventListener.onMemberAddedToGroup)||t._eventListener.onMemberAddedToGroup(n,n.getActionOn(),n.getActionBy(),n.getActionFor())})})}}catch(e){E.Logger.error("XMPPHelper: publishActionEvents",e)}},l.prototype.publishCallEvents=function(t){try{var n=T.CallController.getInstance().getActiveCall();switch(t.getStatus()){case h.CallConstants.CALL_STATUS.INITIATED:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?this.callHandlers.map(function(e){t.getCallInitiator().getUid().toLocaleLowerCase()!=c.CometChat.user.getUid().toLocaleLowerCase()&&(E.isFalsy(e._eventListener.onIncomingCallReceived)||e._eventListener.onIncomingCallReceived(t))}):this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onIncomingCallReceived)||e._eventListener.onIncomingCallReceived(t)});break;case h.CallConstants.CALL_STATUS.ONGOING:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==c.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallAccepted)||e._eventListener.onOutgoingCallAccepted(t)}):this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallAccepted)||e._eventListener.onOutgoingCallAccepted(t)});break;case h.CallConstants.CALL_STATUS.UNANSWERED:if(t.getCallInitiator().getUid().toLocaleLowerCase()==c.CometChat.user.getUid().toLocaleLowerCase())this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});else{if(null!==n&&n.getSessionId()===t.getSessionId())try{T.CallController.getInstance().endCall()}catch(e){E.Logger.error("CallError",e)}this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onIncomingCallCancelled)||e._eventListener.onIncomingCallCancelled(t)})}break;case h.CallConstants.CALL_STATUS.REJECTED:if(t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP)t.getCallInitiator().getUid().toLocaleLowerCase()==c.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});else{if(null!==n&&n.getSessionId()===t.getSessionId())try{T.CallController.getInstance().endCall()}catch(e){E.Logger.error("CallError",e)}this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)})}break;case h.CallConstants.CALL_STATUS.BUSY:t.getReceiverType()==h.CallConstants.RECEIVER_TYPE_GROUP?t.getCallInitiator().getUid().toLocaleLowerCase()==c.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)}):this.callHandlers.map(function(e){if(null!==n&&n.getSessionId()===t.getSessionId())try{T.CallController.getInstance().endCall()}catch(e){E.Logger.error("CallError",e)}E.isFalsy(e._eventListener.onOutgoingCallRejected)||e._eventListener.onOutgoingCallRejected(t)});break;case h.CallConstants.CALL_STATUS.CANCELLED:if(this.callHandlers.map(function(e){E.isFalsy(e._eventListener.onIncomingCallCancelled)||e._eventListener.onIncomingCallCancelled(t)}),null!==n&&n.getSessionId()===t.getSessionId())try{T.CallController.getInstance().endCall()}catch(e){E.Logger.error("CallError",e)}break;case h.CallConstants.CALL_STATUS.ENDED:if(T.CallController.getInstance().getCallListner()&&T.CallController.getInstance().getCallListner()._eventListener.onCallEnded(t),null!==n&&n.getSessionId()===t.getSessionId())try{T.CallController.getInstance().endCall()}catch(e){E.Logger.error("CallError",e)}}}catch(e){E.Logger.error("XMPPHelper: publishCallEvents",e)}},l.prototype.publishTypinStatusNotification=function(t,e){try{switch(e){case h.TYPING_NOTIFICATION.ACTIONS.STARTED:this.messageHandlers.map(function(e){e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(t)}),R.TypingNotificationController.addIncomingTypingStarted(t);break;case h.TYPING_NOTIFICATION.ACTIONS.ENDED:this.messageHandlers.map(function(e){e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(t)}),R.TypingNotificationController.removeIncomingTypingStarted(t)}}catch(e){E.Logger.error("XMPPHelper: publishTypingStatusNotification",e)}},l.prototype.publishDeliveryReceipt=function(e){var n=this;try{e.getElementsByTagName("forwarded")[0]&&(e=e.getElementsByTagName("message")[0]),d.MessageController.processDeliveryReceipt(e).then(function(t){n.messageHandlers.map(function(e){e._eventListener.onMessagesDelivered&&e._eventListener.onMessagesDelivered(t)})},function(e){E.Logger.error("Error in publish delivery",e)})}catch(e){E.Logger.error("XMPPHelper: publishDeliveryReceipt",e)}},l.prototype.publishReadReceipt=function(e){var n=this;try{e.getElementsByTagName("forwarded")[0]&&(e=e.getElementsByTagName("message")[0]),d.MessageController.processReadReceipt(e).then(function(t){n.messageHandlers.map(function(e){e._eventListener.onMessagesRead&&e._eventListener.onMessagesRead(t)})},function(e){E.Logger.error("Error in publish read",e)})}catch(e){E.Logger.error("XMPPHelper: publishReadReceipt",e)}},l.prototype.markAsRead=function(r,o,i){var a=this;try{var e=c.CometChat.getMode();!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&this.connection&&(E.isFalsy(e)||e&&e===h.APP_SETTINGS.KEYS.DEFAULT_MODE)&&c.CometChat.getLoggedInUser().then(function(e){var t=new _.User(e);t.setAuthToken("");var s=JSON.stringify(t);o==h.MessageConstatnts.RECEIVER_TYPE.USER?C.getJidFromUid(r).then(function(e){var t=S.$msg({to:e,from:a.connection.jid,id:a.connection.getUniqueId(),type:h.MessageConstatnts.XMPP_KEYS.TYPE_USER}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=S.Strophe.xmlElement("read",{type:o,receiverId:r,xmlns:"urn:xmpp:receipts",id:"["+c.CometChat.getAppId()+"]"+i});t.tree().appendChild(n),a.connection.send(t)}):C.getGroupJidFromGUID(r).then(function(e){var t=S.$msg({to:e,from:a.connection.jid,id:a.connection.getUniqueId(),type:h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=S.Strophe.xmlElement("read",{type:o,receiverId:r,xmlns:S.Strophe.NS.RECEIPTS,id:"["+c.CometChat.getAppId()+"]"+i});t.tree().appendChild(n),a.connection.send(t)})})}catch(e){E.Logger.error("XMPPHelper: markAsRead",e)}},l.prototype.markAsDelivered=function(r,o,i){var a=this;try{var e=c.CometChat.getMode();!c.CometChat.didMessagesPollingStart()&&c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED&&this.connection&&(E.isFalsy(e)||e&&e===h.APP_SETTINGS.KEYS.DEFAULT_MODE)&&c.CometChat.getLoggedInUser().then(function(e){var t=new _.User(e);t.setAuthToken("");var s=JSON.stringify(t);o==h.MessageConstatnts.RECEIVER_TYPE.USER?C.getJidFromUid(r).then(function(e){var t=S.$msg({to:e,from:a.connection.jid,id:a.connection.getUniqueId(),type:h.MessageConstatnts.XMPP_KEYS.TYPE_USER}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=S.Strophe.xmlElement("delivered",{type:o,receiverId:r,xmlns:"urn:xmpp:receipts",id:"["+c.CometChat.getAppId()+"]"+i});t.tree().appendChild(n),a.connection.send(t)}):C.getGroupJidFromGUID(r).then(function(e){var t=S.$msg({to:e,from:a.connection.jid,id:a.connection.getUniqueId(),type:h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=S.Strophe.xmlElement("delivered",{type:o,receiverId:r,xmlns:S.Strophe.NS.RECEIPTS,id:"["+c.CometChat.getAppId()+"]"+i});t.tree().appendChild(n),a.connection.send(t)})})}catch(e){E.Logger.error("XMPPHelper: markAsDelivered",e)}},l.prototype.subscribeToTopic=function(t){var n=this;try{m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){n.connection.pubsub.subscribe(n.connection.jid,h.XMPP.PUBSUB_CHANNEL+"."+E.getJidHost(e),t,{},function(){E.Logger.info("XMPPHelper: subscribeToTopic","onEvent")},function(){E.Logger.info("XMPPHelper: subscribeToTopic","onsubscribe")})}):n.connection.pubsub.subscribe(n.connection.jid,h.XMPP.PUBSUB_CHANNEL+"."+E.getJidHost(e),t,{},function(){E.Logger.info("XMPPHelper: subscribeToTopic","onEvent")},function(){E.Logger.info("XMPPHelper: subscribeToTopic","onsubscribe")})})}catch(e){E.Logger.error("XMPPHelper: subscribeToTopic",e)}},l.prototype.getRooms=function(){var s=this;return new Promise(function(n,t){try{c.CometChat.didMessagesPollingStart()||c.CometChat.getConnectionStatus()!=h.CONNECTION_STATUS.CONNECTED?E.Logger.info("getRooms()","No rooms found since WS is not connected"):void 0!==s.connection?m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){s.connection.muc.listRooms(c.CometChat.getAppId()+"."+E.getJidHost(e),function(e){var t=e.getElementsByTagName("item");t=Array.prototype.slice.call(t),s.joinedGroups=[],t.map(function(e){s.joinedGroups.push(C.getUidFromJid(e.getAttribute("jid")))}),n(s.joinedGroups)})}):s.connection.muc.listRooms(c.CometChat.getAppId()+"."+E.getJidHost(e),function(e){var t=e.getElementsByTagName("item");t=Array.prototype.slice.call(t),s.joinedGroups=[],t.map(function(e){s.joinedGroups.push(C.getUidFromJid(e.getAttribute("jid")))}),n(s.joinedGroups)})},function(e){t(new P.CometChatException(e))}):s.addXMPPConnectionEventListener("XMPPConnectionListener",new M({onConnected:function(){s.getRooms().then(function(e){n(e),s.removeXMPPConnectionEventListener("XMPPConnectionListener")})}}))}catch(e){t(new P.CometChatException(e))}})},l.prototype.restart=function(){return i(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:return t=c.CometChat.getInstance(c.CometChat.getAppId()),n=t.getAuthToken(),[4,c.CometChat.logout()];case 1:return e.sent(),[4,c.CometChat.login(n)];case 2:return e.sent(),[2]}})})},l.prototype.pushToTypingListeners=function(e,t,n,s,r){n.setSender(e),t&&n.setMetadata(JSON.parse(t)),0<s.length&&R.TypingNotificationController.addIncomingTypingStarted(n),0<r.length&&R.TypingNotificationController.removeIncomingTypingStarted(n),this.messageHandlers.map(function(e){0<s.length&&e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(n),0<r.length&&e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(n)})},l.prototype.perfomAfterConnection=function(e,t,n,s,r){var u=this;this.connection.connect(E.format(h.XMPP.jid_string,c.CometChat.getAppId(),e,s,c.CometChat.getSessionId()),t,function(e,t){try{if(E.isFalsy(n)||n(e,t),e==S.Strophe.Status.CONNECTED){switch(c.CometChat.setSuccessfulTimeStamp((new Date).getTime()),u.connection.sendPresence(S.$pres().c("priority").t("1").up().c("status").t("online")),u.connection.muc.init(u.connection),u.connection.vcard.init(u.connection),u.connection.chatstates.init(u.connection),u.connection.receipts.init(u.connection),u.connection.pubsub.init(u.connection),u.pingInterval=setInterval(function(){u.connection&&u.connection._proto&&u.connection._proto.socket&&u.connection.ping.ping(r,function(){return i(u,void 0,void 0,function(){return a(this,function(e){return E.Logger.info("ping result","successful"),c.CometChat.setSuccessfulTimeStamp((new Date).getTime()),c.CometChat.getConnectionStatus()!=h.CONNECTION_STATUS.CONNECTED&&(this.XMPPDisconnect(),c.CometChat.getInstance().makeXMPPConnection()),[2]})})},function(){E.Logger.info("ping result","unsuccessful"),c.CometChat.getInstance().setConnectionStatus(h.CONNECTION_STATUS.DISCONNECTED),u.XMPPConnectionHandlers.map(function(e){try{e._XMPPeventListener&&(E.isFalsy(e._XMPPeventListener.onDisconnected)||e._XMPPeventListener.onDisconnected())}catch(e){E.Logger.error("XMPPConnectionHandlers: Disconnected Status",e)}}),u.XMPPDisconnect(),c.CometChat.getInstance().accidentallyDisconnected()},2e3)},25e3),c.CometChat.appSettings.getIsAutoJoinEnabled()&&m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){u.connection.muc.listRooms(c.CometChat.getAppId()+"."+E.getJidHost(e),function(e){var t=e.getElementsByTagName("item");(t=Array.prototype.slice.call(t)).map(function(e){u.connection.muc.join(e.getAttribute("jid"),u.connection.jid)})})}):u.connection.muc.listRooms(c.CometChat.getAppId()+"."+E.getJidHost(e),function(e){var t=e.getElementsByTagName("item");(t=Array.prototype.slice.call(t)).map(function(e){u.connection.muc.join(e.getAttribute("jid"),u.connection.jid,null,null,null,null,0,null)})})}),c.CometChat.appSettings.getSubscriptionType()){case y.AppSettings.SUBSCRIPTION_TYPE_ALL_USERS:u.subscribeToTopic(E.format(h.XMPP.pubsub_global_string,c.CometChat.getAppId()));break;case y.AppSettings.SUBSCRIPTION_TYPE_FRIENDS:case y.AppSettings.SUBSCRIPTION_TYPE_NONE:break;case y.AppSettings.SUBSCRIPTION_TYPE_ROLES:c.CometChat.appSettings.getRoles().map(function(e){u.subscribeToTopic(E.format(h.XMPP.pubsub_role_string,c.CometChat.getAppId(),e))})}u.connection.send(S.$iq({from:S.Strophe.getBareJidFromJid(u.connection.jid),id:"enable1",type:"set"}).c("enable",{xmlns:"urn:xmpp:carbons:2"})),u.connection.addHandler(function(e){if(!(0<e.getElementsByTagName("x").length)){var n=p.PresenceController.transformPresence(e);u.getUsersVCard(n.getUid(),function(t){E.isFalsy(t.getUid())||c.CometChat.appSettings.getSubscriptionType()==y.AppSettings.SUBSCRIPTION_TYPE_FRIENDS&&u.userHandlers.map(function(e){if(e)switch(t.setLastActiveAt(n.getLastActiveAt()),n.getStatus()){case h.PresenceConstatnts.STATUS.ONLINE:t.setStatus(h.PresenceConstatnts.STATUS.ONLINE),E.isFalsy(e._eventListener.onUserOnline)||e._eventListener.onUserOnline(t);break;default:t.setStatus(h.PresenceConstatnts.STATUS.OFFLINE),E.isFalsy(e._eventListener.onUserOffline)||e._eventListener.onUserOffline(t)}})})}return!0},null,"presence"),u.connection.addHandler(function(e){0<e.getElementsByTagName("muc_join").length&&u.connection.muc.join(e.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM),u.connection.jid,null,null,null,null,0);var t=e.getElementsByTagName("presence");return 0<(t=Array.prototype.slice.call(t)).length&&u.iqHandlers.map(function(e){e._callback(p.PresenceController.transformPresences(t))}),!0},null,"iq"),u.connection.addHandler(function(e){return 0<e.getElementsByTagName("settings").length&&u.restart(),!0},null,"iq"),m.LocalStorage.getInstance().get(h.APP_SETTINGS.APP_SETTINGS).then(function(e){E.isFalsy(e)?E.getAppSettings().then(function(e){u.connection.addHandler(function(e){var t=JSON.parse(C.parseHTML(e.getElementsByTagName("body")[0]).trim().toString()),n=O.UsersController.trasformJSONUser(t);return u.userHandlers.map(function(e){if(e)switch(n.getStatus()){case h.PresenceConstatnts.STATUS.OFFLINE:E.isFalsy(e._eventListener.onUserOffline)||e._eventListener.onUserOffline(n);break;default:E.isFalsy(e._eventListener.onUserOnline)||e._eventListener.onUserOnline(n)}}),!0},null,"message",null,null,h.XMPP.PUBSUB_CHANNEL+"."+E.getJidHost(e),null)}):u.connection.addHandler(function(e){var t=JSON.parse(C.parseHTML(e.getElementsByTagName("body")[0]).trim().toString()),n=O.UsersController.trasformJSONUser(t);return u.userHandlers.map(function(e){if(e)switch(n.getStatus()){case h.PresenceConstatnts.STATUS.OFFLINE:E.isFalsy(e._eventListener.onUserOffline)||e._eventListener.onUserOffline(n);break;default:E.isFalsy(e._eventListener.onUserOnline)||e._eventListener.onUserOnline(n)}}),!0},null,"message",null,null,h.XMPP.PUBSUB_CHANNEL+"."+E.getJidHost(e),null)}),u.connection.addHandler(function(o){var e;try{if(c.CometChat.getConnectionStatus()==h.CONNECTION_STATUS.CONNECTED){try{if(e=d.MessageController.trasformXMPPMessage(o),E.isFalsy(e))if(d.MessageController.isDeliveryReceipt(o))o.getAttribute(h.MessageConstatnts.XMPP_KEYS.TYPE)==h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&C.getFullJidForGroup(o.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==l.getInstance().connection.jid||u.publishDeliveryReceipt(o);else{if(!d.MessageController.isReadRceipt(o))return!0;o.getAttribute(h.MessageConstatnts.XMPP_KEYS.TYPE)==h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&C.getFullJidForGroup(o.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==l.getInstance().connection.jid||u.publishReadReceipt(o)}else o.getAttribute(h.MessageConstatnts.XMPP_KEYS.TYPE)==h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP?C.getFullJidForGroup(o.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==l.getInstance().connection.jid||d.MessageController.checkIfCabon(o)||u.connection.receipts._processReceipt(o,e.getId()):d.MessageController.checkIfCabon(o)?u.trigerMessageHandler(o):u.connection.receipts._processReceipt(o,e.getId());d.MessageController.isReadRceipt(o)||d.MessageController.isDeliveryReceipt(o)?o=e:o.getAttribute(h.MessageConstatnts.XMPP_KEYS.TYPE)==h.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&C.getFullJidForGroup(o.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==l.getInstance().connection.jid||(o=e)}catch(e){return E.Logger.error("Error in processing incoming message",{e:e,message:o}),!0}if(!E.isFalsy(o)){try{I.MessageListnerMaping.getInstance().set("all",parseInt(o.id)),c.CometChat.setLastMessageId(o.id)}catch(e){E.Logger.error("Error in storing  incoming message id",{e:e})}u.messageHandlers.map(function(r){return i(u,void 0,void 0,function(){var t,n,s;return a(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),r?o instanceof g.Action?[3,4]:[3,1]:[3,4];case 1:return o instanceof f.Call?[3,4]:[3,2];case 2:return t=o,n=d.MessageController.trasformJSONMessge(t),[4,N.ExtensionController.hookOnMessageReceived(n)];case 3:switch((t=e.sent()).getType()){case h.MessageConstatnts.TYPE.TEXT:E.isFalsy(r._eventListener.onTextMessageReceived)||r._eventListener.onTextMessageReceived(t);break;case h.MessageConstatnts.TYPE.CUSTOM:E.isFalsy(r._eventListener.onCustomMessageReceived)||r._eventListener.onCustomMessageReceived(t);break;default:t.getCategory()==h.MessageCategory.CUSTOM?E.isFalsy(r._eventListener.onCustomMessageReceived)||r._eventListener.onCustomMessageReceived(o):E.isFalsy(r._eventListener.onMediaMessageReceived)||r._eventListener.onMediaMessageReceived(o)}e.label=4;case 4:return[3,6];case 5:return s=e.sent(),E.Logger.error("Error in processing incoming message",{e:s}),[3,6];case 6:return[2]}})})}),o instanceof f.Call&&u.publishCallEvents(o),o instanceof g.Action&&u.publishActionEvents(o)}}}catch(e){E.Logger.error("Error in message processing",{error:e})}return!0},null,"message"),u.connection.addHandler(function(e){try{if(0<e.getElementsByTagName("error").length)return!0;if(!e.getElementsByTagName("composing")&&!e.getElementsByTagName("paused"))return!0;e.getElementsByTagName("forwarded")[0]&&(e=e.getElementsByTagName("message")[0]);var t,n,s=e.getElementsByTagName("composing"),r=e.getElementsByTagName("paused"),o=e.getAttribute("from"),i=e.getAttribute("type"),a=e.getAttribute("to"),c=void 0;if(e.getElementsByTagName("body")[0]&&(t=C.parseHTML(e.getElementsByTagName("body")[0]).trim().toString()),0<s.length||0<r.length)switch(i){case h.XMPP.CONVERSATION.TYPE.CHAT:n=new A.TypingIndicator(C.getUidFromJid(a),h.MessageConstatnts.RECEIVER_TYPE.USER),e.getElementsByTagName("user")[0]?(delete(c=new _.User(JSON.parse(C.parseHTML(e.getElementsByTagName("user")[0]).trim().toString()))).authToken,u.pushToTypingListeners(c,t,n,s,r)):u.getUsersVCard(C.getUidFromJid(o),function(e){u.pushToTypingListeners(e,t,n,s,r)});break;case h.XMPP.CONVERSATION.TYPE.GROUP_CHAT:if(C.getFullJidForGroup(e.getAttribute(h.MessageConstatnts.XMPP_KEYS.FROM))==l.getInstance().connection.jid)return!0;n=new A.TypingIndicator(C.getGUIDFromJID(o),h.MessageConstatnts.RECEIVER_TYPE.GROUP),e.getElementsByTagName("user")[0]?(delete(c=new _.User(JSON.parse(C.parseHTML(e.getElementsByTagName("user")[0]).trim().toString()))).authToken,u.pushToTypingListeners(c,t,n,s,r)):u.getUsersVCard(C.getUidFromJid(o),function(e){u.pushToTypingListeners(e,t,n,s,r)})}}catch(e){E.Logger.error("error in message processing",{error:e})}return!0},null,"message")}}catch(e){E.Logger.error("XMPPHelper: performAfterConnection",e)}})},l.XMPP_HOST=h.XMPP.host,l.XMPP_PORT=h.XMPP.port,l.xMPPConnectionHelper=new l,l.XMPP_BIND_URL="wss://"+l.XMPP_HOST+":"+l.XMPP_PORT+h.XMPP.ws_url,l.XMPP_BIND_URL_WS="wss://"+l.XMPP_HOST+":"+l.XMPP_PORT+h.XMPP.ws_url,l.XMPP_BIND_URL_HTTPS="https://"+l.XMPP_HOST+":"+l.XMPP_PORT+h.XMPP.bind_url,l}();t.XMPPConnectionHelper=l;var M=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onConnected=void 0,this.inConnecting=void 0,this.onDisconnected=void 0,this.onFeatureThrottled=void 0,E.isFalsy(e[0].onConnected)||(this.onConnected=e[0].onConnected),E.isFalsy(e[0].inConnecting)||(this.inConnecting=e[0].inConnecting),E.isFalsy(e[0].onDisconnected)||(this.onDisconnected=e[0].onDisconnected),E.isFalsy(e[0].onFeatureThrottled)||(this.onFeatureThrottled=e[0].onFeatureThrottled)};t.XMPPConnectionEventListener=M;var v=function(e,t){this._name=e,this._callback=t},L=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._XMPPeventListener=t,n&&(r._cursor=n),r}return r(e,o),e}(t.XMPPListener=v);t.XMPPConnectionListener=L},function(e,t,n){var s;window,s=function(){return function(n){var s={};function r(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/strophe.js")}({"./src/bosh.js":function(e,t,n){"use strict";n.r(t);var s=n("./src/core.js"),E=s.default.Strophe,r=s.default.$build;E.Request=function(e,t,n,s){this.id=++E._requestId,this.xmlData=e,this.data=E.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},E.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw E.error("invalid response received"),E.error("responseText: "+this.xhr.responseText),E.error("responseXML: "+E.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(E.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){E.error("invalid response received: "+e.querySelector("parsererror").textContent),E.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=E.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},E.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},E.Bosh.prototype={strip:null,_buildBody:function(){var e=r("body",{rid:this.rid++,xmlns:E.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":E.NS.BOSH});n&&s.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new E.Request(s.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,s,r,o,i){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=E.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=i||this.window,this._conn._changeConnectStatus(E.Status.ATTACHED,null)},_restore:function(e,t,n,s,r){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||E.getBareJidFromJid(o.jid)===E.getBareJidFromJid(e)||null===E.getNodeFromJid(e)&&E.getDomainFromJid(o.jid)===e))){var i=new Error("_restore: no restoreable session.");throw i.name="StropheSessionError",i}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,s,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");E.error("BOSH-Connection failed: "+n);var s=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&0<s.length&&(n="conflict"),this._conn._changeConnectStatus(E.Status.CONNFAIL,n)):this._conn._changeConnectStatus(E.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),E.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,E.warn("request errored, status: "+e+", number of errors: "+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){E.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new E.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;0<this._requests.length;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(E.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&0<e.length){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":E.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new E.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(0<this._requests.length){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(E.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(E.TIMEOUT*this.wait)&&(E.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(E.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){E.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(E.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&400<=n)return this._hitError(n),void this._callProtocolErrorHandlers(t);var s=0<n&&n<500,r=t.sends>this._conn.maxRetries;if((s||r)&&(this._removeRequest(t),E.debug("request id "+t.id+" should now be removed")),200===n){var o=this._requests[0]===t;(this._requests[1]===t||o&&0<this._requests.length&&this._requests[0].age()>Math.floor(E.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),E.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||400<=n&&n<600||12e3<=n?(E.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),400<=n&&n<500&&(this._conn._changeConnectStatus(E.Status.DISCONNECTING,null),this._conn._doDisconnect())):E.error("request id "+t.id+"."+t.sends+" error "+n+" happened");s||r?r&&!this._conn.connected&&this._conn._changeConnectStatus(E.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var n=this,s=this._requests[e],t=this._getRequestStatus(s,-1);if(s.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var r=s.age(),o=!isNaN(r)&&r>Math.floor(E.TIMEOUT*this.wait),i=null!==s.dead&&s.timeDead()>Math.floor(E.SECONDARY_TIMEOUT*this.wait),a=4===s.xhr.readyState&&(t<1||500<=t);if((o||i||a)&&(i&&E.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),s.abort=!0,s.xhr.abort(),s.xhr.onreadystatechange=function(){},this._requests[e]=new E.Request(s.xmlData,s.origFunc,s.rid,s.sends),s=this._requests[e]),0===s.xhr.readyState){E.debug("request id "+s.id+"."+s.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";s.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==s.xhr.setRequestHeader&&s.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(s.xhr.withCredentials=!0)}catch(e){return E.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(E.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(s.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.xhr.setRequestHeader(t,e[t])}s.xhr.send(s.data)};if(1<s.sends){var l=1e3*Math.min(Math.floor(E.TIMEOUT*this.wait),Math.pow(s.sends,3));setTimeout(function(){u()},l)}else u();s.sends++,this._conn.xmlOutput!==E.Connection.prototype.xmlOutput&&(s.xmlData.nodeName===this.strip&&s.xmlData.childNodes.length?this._conn.xmlOutput(s.xmlData.childNodes[0]):this._conn.xmlOutput(s.xmlData)),this._conn.rawOutput!==E.Connection.prototype.rawOutput&&this._conn.rawOutput(s.data)}else E.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+s.xhr.readyState)}},_removeRequest:function(e){E.debug("removing request");for(var t=this._requests.length-1;0<=t;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){E.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new E.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?E.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):E.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":function(e,t,n){"use strict";n.r(t);var p=n("./src/md5.js"),f=n("./src/sha1.js"),T=n("./src/utils.js");function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return new g.Builder(e,t)}function r(e){return new g.Builder("iq",e)}function s(e){return new g.Builder("presence",e)}var g={VERSION:"1.3.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<g.XHTML.tags.length;t++)if(e===g.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==g.XHTML.attributes[e]&&0<g.XHTML.attributes[e].length)for(var n=0;n<g.XHTML.attributes[e].length;n++)if(t===g.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<g.XHTML.css.length;t++)if(e===g.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){g.NS[e]=t},forEachChild:function(e,t,n){for(var s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];r.nodeType!==g.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return g._xmlGenerator||(g._xmlGenerator=g._makeGenerator()),g._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(e){if(!e)return null;for(var t=g.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var s=arguments[n];if(s)if("string"==typeof s||"number"==typeof s)t.appendChild(g.xmlTextNode(s));else if("object"===S(s)&&"function"==typeof s.sort)for(var r=0;r<s.length;r++){var o=s[r];"object"===S(o)&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&t.setAttribute(o[0],o[1])}else if("object"===S(s))for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&void 0!==s[i]&&null!==s[i]&&t.setAttribute(i,s[i])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return g.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e));return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===g.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===g.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return g.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===g.ElementType.NORMAL){t=g.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var s=0;s<e.childNodes.length;s++)t.appendChild(g.copyElement(e.childNodes[s]))}else e.nodeType===g.ElementType.TEXT&&(t=g.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===g.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(g.XHTML.validTag(n))try{t=g.xmlElement(n);for(var s=0;s<g.XHTML.attributes[n].length;s++){var r=g.XHTML.attributes[n][s],o=e.getAttribute(r);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===r&&"object"===S(o)&&void 0!==o.cssText&&(o=o.cssText),"style"===r){for(var i=[],a=o.split(";"),c=0;c<a.length;c++){var u=a[c].split(":"),l=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(g.XHTML.validCSS(l)){var E=u[1].replace(/^\s*/,"").replace(/\s*$/,"");i.push(l+": "+E)}}0<i.length&&(o=i.join("; "),t.setAttribute(r,o))}else t.setAttribute(r,o)}for(var d=0;d<e.childNodes.length;d++)t.appendChild(g.createHtml(e.childNodes[d]))}catch(e){t=g.xmlTextNode("")}else{t=g.xmlGenerator().createDocumentFragment();for(var h=0;h<e.childNodes.length;h++)t.appendChild(g.createHtml(e.childNodes[h]))}}else if(e.nodeType===g.ElementType.FRAGMENT){t=g.xmlGenerator().createDocumentFragment();for(var p=0;p<e.childNodes.length;p++)t.appendChild(g.createHtml(e.childNodes[p]))}else e.nodeType===g.ElementType.TEXT&&(t=g.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=g.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&g.fatal(e.stack),e.sourceURL?g.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?g.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):g.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===S(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(n){if(!n)return null;"function"==typeof n.tree&&(n=n.tree());var e=o(Array(n.attributes.length).keys()).map(function(e){return n.attributes[e].nodeName});e.sort();var t=e.reduce(function(e,t){return"".concat(e," ").concat(t,'="').concat(g.xmlescape(n.attributes.getNamedItem(t).value),'"')},"<".concat(n.nodeName));if(0<n.childNodes.length){t+=">";for(var s=0;s<n.childNodes.length;s++){var r=n.childNodes[s];switch(r.nodeType){case g.ElementType.NORMAL:t+=g.serialize(r);break;case g.ElementType.TEXT:t+=g.xmlescape(r.nodeValue);break;case g.ElementType.CDATA:t+="<![CDATA["+r.nodeValue+"]]>"}}t+="</"+n.nodeName+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){g._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=g.NS.CLIENT:t||(t={xmlns:g.NS.CLIENT})),this.nodeTree=g.xmlElement(e,t),this.node=this.nodeTree}};g.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return g.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var s=g.xmlElement(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this},cnode:function(e){var t,n=g.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var s=t?n.importNode(e,!0):g.copyElement(e);return this.node.appendChild(s),this.node=s,this},t:function(e){var t=g.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=g.createHtml(t);0<n.childNodes.length;)this.node.appendChild(n.childNodes[0]);return this}},g.Handler=function(e,t,n,s,r,o,i){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=r,this.options=i||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(g.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?g.getBareJidFromJid(o):null:this.from=o,this.user=!0},g.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(g.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=g.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!g.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw g._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},g.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},g.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},g.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var s=this.options.protocol||"";for(var r in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===s.indexOf("ws")?this._proto=new g.Websocket(this):this._proto=new g.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),T.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),g._connectionPlugins)if(Object.prototype.hasOwnProperty.call(g._connectionPlugins,r)){var o=function(){};o.prototype=g._connectionPlugins[r],this[r]=new o,this[r].init(this)}},g.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,s,r,o,i){this.jid=e,this.authzid=g.getBareJidFromJid(this.jid),this.authcid=i||g.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=g.getDomainFromJid(this.jid),this._changeConnectStatus(g.Status.CONNECTING,null),this._proto._connect(s,r,o)},attach:function(e,t,n,s,r,o,i){if(!(this._proto instanceof g.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,s,r,o,i)},restore:function(e,t,n,s,r){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,s,r)},_sessionCachingSupported:function(){if(this._proto instanceof g.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,s){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var i=e.getAttribute("id");if(i||(i=this.getUniqueId("sendPresence"),e.setAttribute("id",i)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&r.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,i);s&&(o=this.addTimedHandler(s,function(){return r.deleteHandler(a),n&&n(null),!1}))}return this.send(e),i},sendIQ:function(e,s,r,t){var o=this,i=null;"function"==typeof e.tree&&(e=e.tree());var n=e.getAttribute("id");if(n||(n=this.getUniqueId("sendIQ"),e.setAttribute("id",n)),"function"==typeof s||"function"==typeof r){var a=this.addHandler(function(e){i&&o.deleteTimedHandler(i);var t=e.getAttribute("type");if("result"===t)s&&s(e);else{if("error"!==t){var n=new Error("Got bad IQ type of ".concat(t));throw n.name="StropheError",n}r&&r(e)}},null,"iq",["error","result"],n);t&&(i=this.addTimedHandler(t,function(){return o.deleteHandler(a),r&&r(null),!1}))}return this.send(e),n},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)},addTimedHandler:function(e,t){var n=new g.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,s,r,o,i){var a=new g.Handler(e,t,n,s,r,o,i);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);0<=t&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[g.SASLAnonymous,g.SASLExternal,g.SASLMD5,g.SASLOAuthBearer,g.SASLXOAuth2,g.SASLPlain,g.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(g.Status.DISCONNECTING,e),g.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=s({xmlns:g.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else g.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var s in g._connectionPlugins)if(Object.prototype.hasOwnProperty.call(g._connectionPlugins,s)){var r=this[s];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){g.error("".concat(s," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){g._handleError(e),g.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),g.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(g.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var r=this;g.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){for(this.xmlInput!==g.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==g.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(g.serialize(n)));0<this.removeHandlers.length;){var s=this.removeHandlers.pop(),o=this.handlers.indexOf(s);0<=o&&this.handlers.splice(o,1)}for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var i=n.getAttribute("type");if(null!==i&&"terminate"===i){if(this.disconnecting)return;var a=n.getAttribute("condition"),c=n.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&0<c.length&&(a="conflict"),this._changeConnectStatus(g.Status.CONNFAIL,a)):this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}g.forEachChild(n,null,function(e){var t=r.handlers;r.handlers=[];for(var n=0;n<t.length;n++){var s=t[n];try{!s.isMatch(e)||!r.authenticated&&s.user?r.handlers.push(s):s.run(e)&&r.handlers.push(s)}catch(e){g.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_connect_cb:function(e,t,n){var s;g.info("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(e)}catch(e){if(e.name!==g.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.BAD_FORMAT),this._doDisconnect(g.ErrorCondition.BAD_FORMAT)}if(s&&(this.xmlInput!==g.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==g.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(g.serialize(s))),this._proto._connect_cb(s)!==g.Status.CONNFAIL))if(s.getElementsByTagNameNS?0<s.getElementsByTagNameNS(g.NS.STREAM,"features").length:0<s.getElementsByTagName("stream:features").length||0<s.getElementsByTagName("features").length){var r=[],o=s.getElementsByTagName("mechanism");if(0<o.length)for(var i=0;i<o.length;i++){var a=g.getText(o[i]);this.mechanisms[a]&&r.push(this.mechanisms[a])}0!==r.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,s=t+1;s<e.length;++s)e[s].prototype.priority>e[n].prototype.priority&&(n=s);if(n!==t){var r=e[t];e[t]=e[n],e[n]=r}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var s=i("auth",{xmlns:g.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(r))}this.send(s.tree()),t=!0;break}return t},_attemptLegacyAuth:function(){null===g.getNodeFromJid(this.jid)?(this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.MISSING_JID_NODE),this.disconnect(g.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(g.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(r({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:g.NS.AUTH}).c("username",{}).t(g.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(g.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),s=i("response",{xmlns:g.NS.SASL});return""!==n&&s.t(btoa(n)),this.send(s.tree()),!0},_auth1_cb:function(e){var t=r({type:"set",id:"_auth_2"}).c("query",{xmlns:g.NS.AUTH}).c("username",{}).t(g.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return g.getResourceFromJid(this.jid)||(this.jid=g.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(g.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var n=this;if(this._sasl_data["server-signature"]){var t,s=atob(g.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===s[1]&&(t=s[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}g.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var r=[],o=function(e,t){for(;e.length;)n.deleteHandler(e.pop());return n._sasl_auth1_cb(t),!1};return r.push(this._addSysHandler(function(e){return o(r,e)},null,"stream:features",null,null)),r.push(this._addSysHandler(function(e){return o(r,e)},g.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(g.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=g.getResourceFromJid(this.jid);return s?this.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:g.NS.BIND}).c("resource",{}).t(s).tree()):this.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:g.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return g.info("SASL binding failed."),0<e.getElementsByTagName("conflict").length&&(t=g.ErrorCondition.CONFLICT),this._changeConnectStatus(g.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(0<n.length))return g.info("SASL binding failed."),this._changeConnectStatus(g.Status.AUTHFAIL,null,e),!1;var s=n[0].getElementsByTagName("jid");0<s.length&&(this.jid=g.getText(s[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(r({type:"set",id:"_session_auth_2"}).c("session",{xmlns:g.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return g.info("Session creation failed."),this._changeConnectStatus(g.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(g.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(g.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new g.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,s,r){var o=new g.Handler(e,t,n,s,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return g.info("_onDisconnectTimeout was called"),this._changeConnectStatus(g.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);0<=n&&this.timedHandlers.splice(n,1)}for(var s=(new Date).getTime(),r=[],o=0;o<this.timedHandlers.length;o++){var i=this.timedHandlers[o];if(this.authenticated||!i.user)i.lastCalled+i.period-s<=0?i.run()&&r.push(i):r.push(i)}this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}},g.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},g.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},g.SASLAnonymous=function(){},g.SASLAnonymous.prototype=new g.SASLMechanism("ANONYMOUS",!1,20),g.SASLAnonymous.prototype.test=function(e){return null===e.authcid},g.SASLPlain=function(){},g.SASLPlain.prototype=new g.SASLMechanism("PLAIN",!0,50),g.SASLPlain.prototype.test=function(e){return null!==e.authcid},g.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,T.default.utf16to8(t)},g.SASLSHA1=function(){},g.SASLSHA1.prototype=new g.SASLMechanism("SCRAM-SHA-1",!0,70),g.SASLSHA1.prototype.test=function(e){return null!==e.authcid},g.SASLSHA1.prototype.onChallenge=function(e,t,n){var s=n||p.default.hexdigest(1234567890*Math.random()),r="n="+T.default.utf16to8(e.authcid);return r+=",r=",r+=s,e._sasl_data.cnonce=s,r="n,,"+(e._sasl_data["client-first-message-bare"]=r),this.onChallenge=function(e,t){for(var n,s,r,o,i,a,c,u,l="c=biws,",E="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),d=e._sasl_data.cnonce,h=/([a-z]+)=([^,]+)(,|$)/;t.match(h);){var p=t.match(h);switch(t=t.replace(p[0],""),p[1]){case"r":n=p[2];break;case"s":s=p[2];break;case"i":r=p[2]}}if(n.substr(0,d.length)!==d)return e._sasl_data={},e._sasl_failure_cb();E+=l+="r="+n,s=atob(s),s+="\0\0\0";var S=T.default.utf16to8(e.pass);for(o=a=f.default.core_hmac_sha1(S,s),c=1;c<r;c++){for(i=f.default.core_hmac_sha1(S,f.default.binb2str(a)),u=0;u<5;u++)o[u]^=i[u];a=i}o=f.default.binb2str(o);var g=f.default.core_hmac_sha1(o,"Client Key"),C=f.default.str_hmac_sha1(o,"Server Key"),_=f.default.core_hmac_sha1(f.default.str_sha1(f.default.binb2str(g)),E);for(e._sasl_data["server-signature"]=f.default.b64_hmac_sha1(C,E),u=0;u<5;u++)g[u]^=_[u];return l+=",p="+btoa(f.default.binb2str(g))},r},g.SASLMD5=function(){},g.SASLMD5.prototype=new g.SASLMechanism("DIGEST-MD5",!1,60),g.SASLMD5.prototype.test=function(e){return null!==e.authcid},g.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},g.SASLMD5.prototype.onChallenge=function(e,t,n){for(var s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,r=n||p.default.hexdigest(""+1234567890*Math.random()),o="",i=null,a="";t.match(s);){var c=t.match(s);switch(t=t.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":o=c[2];break;case"nonce":a=c[2];break;case"qop":c[2];break;case"host":i=c[2]}}var u=e.servtype+"/"+e.domain;null!==i&&(u=u+"/"+i);var l=T.default.utf16to8(e.authcid+":"+o+":"+this._connection.pass),E=p.default.hash(l)+":"+a+":"+r,d="AUTHENTICATE:"+u,h="";return h+="charset=utf-8,",h+="username="+this._quote(T.default.utf16to8(e.authcid))+",",h+="realm="+this._quote(o)+",",h+="nonce="+this._quote(a)+",",h+="nc=00000001,",h+="cnonce="+this._quote(r)+",",h+="digest-uri="+this._quote(u)+",",h+="response="+p.default.hexdigest(p.default.hexdigest(E)+":"+a+":00000001:"+r+":auth:"+p.default.hexdigest(d))+",",h+="qop=auth",this.onChallenge=function(){return""},h},g.SASLOAuthBearer=function(){},g.SASLOAuthBearer.prototype=new g.SASLMechanism("OAUTHBEARER",!0,40),g.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},g.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",T.default.utf16to8(t)},g.SASLExternal=function(){},g.SASLExternal.prototype=new g.SASLMechanism("EXTERNAL",!0,10),g.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},g.SASLXOAuth2=function(){},g.SASLXOAuth2.prototype=new g.SASLMechanism("X-OAUTH2",!0,30),g.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},g.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,T.default.utf16to8(t)},t.default={Strophe:g,$build:i,$iq:r,$msg:function(e){return new g.Builder("message",e)},$pres:s,SHA1:f.default,MD5:p.default,b64_hmac_sha1:f.default.b64_hmac_sha1,b64_sha1:f.default.b64_sha1,str_hmac_sha1:f.default.str_hmac_sha1,str_sha1:f.default.str_sha1}},"./src/md5.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return o});var E=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},s=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},a=function(e,t,n,s,r,o){return E((i=E(E(t,e),E(s,o)))<<(a=r)|i>>>32-a,n);var i,a},d=function(e,t,n,s,r,o,i){return a(t&n|~t&s,e,t,r,o,i)},h=function(e,t,n,s,r,o,i){return a(t&s|n&~s,e,t,r,o,i)},p=function(e,t,n,s,r,o,i){return a(t^n^s,e,t,r,o,i)},S=function(e,t,n,s,r,o,i){return a(n^(t|~s),e,t,r,o,i)},r=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,s,r,o,i=1732584193,a=-271733879,c=-1732584194,u=271733878,l=0;l<e.length;l+=16)i=d(n=i,s=a,r=c,o=u,e[l+0],7,-680876936),u=d(u,i,a,c,e[l+1],12,-389564586),c=d(c,u,i,a,e[l+2],17,606105819),a=d(a,c,u,i,e[l+3],22,-1044525330),i=d(i,a,c,u,e[l+4],7,-176418897),u=d(u,i,a,c,e[l+5],12,1200080426),c=d(c,u,i,a,e[l+6],17,-1473231341),a=d(a,c,u,i,e[l+7],22,-45705983),i=d(i,a,c,u,e[l+8],7,1770035416),u=d(u,i,a,c,e[l+9],12,-1958414417),c=d(c,u,i,a,e[l+10],17,-42063),a=d(a,c,u,i,e[l+11],22,-1990404162),i=d(i,a,c,u,e[l+12],7,1804603682),u=d(u,i,a,c,e[l+13],12,-40341101),c=d(c,u,i,a,e[l+14],17,-1502002290),a=d(a,c,u,i,e[l+15],22,1236535329),i=h(i,a,c,u,e[l+1],5,-165796510),u=h(u,i,a,c,e[l+6],9,-1069501632),c=h(c,u,i,a,e[l+11],14,643717713),a=h(a,c,u,i,e[l+0],20,-373897302),i=h(i,a,c,u,e[l+5],5,-701558691),u=h(u,i,a,c,e[l+10],9,38016083),c=h(c,u,i,a,e[l+15],14,-660478335),a=h(a,c,u,i,e[l+4],20,-405537848),i=h(i,a,c,u,e[l+9],5,568446438),u=h(u,i,a,c,e[l+14],9,-1019803690),c=h(c,u,i,a,e[l+3],14,-187363961),a=h(a,c,u,i,e[l+8],20,1163531501),i=h(i,a,c,u,e[l+13],5,-1444681467),u=h(u,i,a,c,e[l+2],9,-51403784),c=h(c,u,i,a,e[l+7],14,1735328473),a=h(a,c,u,i,e[l+12],20,-1926607734),i=p(i,a,c,u,e[l+5],4,-378558),u=p(u,i,a,c,e[l+8],11,-2022574463),c=p(c,u,i,a,e[l+11],16,1839030562),a=p(a,c,u,i,e[l+14],23,-35309556),i=p(i,a,c,u,e[l+1],4,-1530992060),u=p(u,i,a,c,e[l+4],11,1272893353),c=p(c,u,i,a,e[l+7],16,-155497632),a=p(a,c,u,i,e[l+10],23,-1094730640),i=p(i,a,c,u,e[l+13],4,681279174),u=p(u,i,a,c,e[l+0],11,-358537222),c=p(c,u,i,a,e[l+3],16,-722521979),a=p(a,c,u,i,e[l+6],23,76029189),i=p(i,a,c,u,e[l+9],4,-640364487),u=p(u,i,a,c,e[l+12],11,-421815835),c=p(c,u,i,a,e[l+15],16,530742520),a=p(a,c,u,i,e[l+2],23,-995338651),i=S(i,a,c,u,e[l+0],6,-198630844),u=S(u,i,a,c,e[l+7],10,1126891415),c=S(c,u,i,a,e[l+14],15,-1416354905),a=S(a,c,u,i,e[l+5],21,-57434055),i=S(i,a,c,u,e[l+12],6,1700485571),u=S(u,i,a,c,e[l+3],10,-1894986606),c=S(c,u,i,a,e[l+10],15,-1051523),a=S(a,c,u,i,e[l+1],21,-2054922799),i=S(i,a,c,u,e[l+8],6,1873313359),u=S(u,i,a,c,e[l+15],10,-30611744),c=S(c,u,i,a,e[l+6],15,-1560198380),a=S(a,c,u,i,e[l+13],21,1309151649),i=S(i,a,c,u,e[l+4],6,-145523070),u=S(u,i,a,c,e[l+11],10,-1120210379),c=S(c,u,i,a,e[l+2],15,718787259),a=S(a,c,u,i,e[l+9],21,-343485551),i=E(i,n),a=E(a,s),c=E(c,r),u=E(u,o);return[i,a,c,u]},o={hexdigest:function(e){return function(e){for(var t="0123456789abcdef",n="",s=0;s<4*e.length;s++)n+=t.charAt(e[s>>2]>>s%4*8+4&15)+t.charAt(e[s>>2]>>s%4*8&15);return n}(r(s(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(r(s(e),8*e.length))}}},"./src/sha1.js":function(e,t,n){"use strict";function a(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,s,r,o,i,a,c,u,l,E=new Array(80),d=1732584193,h=-271733879,p=-1732584194,S=271733878,g=-1009589776;for(n=0;n<e.length;n+=16){for(o=d,i=h,a=p,c=S,u=g,s=0;s<80;s++)E[s]=s<16?e[n+s]:f(E[s-3]^E[s-8]^E[s-14]^E[s-16],1),r=_(_(f(d,5),C(s,h,p,S)),_(_(g,E[s]),(l=s)<20?1518500249:l<40?1859775393:l<60?-1894007588:-899497514)),g=S,S=p,p=f(h,30),h=d,d=r;d=_(d,o),h=_(h,i),p=_(p,a),S=_(S,c),g=_(g,u)}return[d,h,p,S,g]}function C(e,t,n,s){return e<20?t&n|~t&s:e<40?t^n^s:e<60?t&n|t&s|n&s:t^n^s}function s(e,t){var n=c(e);16<n.length&&(n=a(n,8*e.length));for(var s=new Array(16),r=new Array(16),o=0;o<16;o++)s[o]=909522486^n[o],r[o]=1549556828^n[o];var i=a(s.concat(c(t)),512+8*t.length);return a(r.concat(i),672)}function _(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){return e<<t|e>>>32-t}function c(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function r(e){for(var t,n,s="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return s}function o(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}n.r(t),n.d(t,"default",function(){return i});var i={b64_hmac_sha1:function(e,t){return r(s(e,t))},b64_sha1:function(e){return r(a(c(e),8*e.length))},binb2str:o,core_hmac_sha1:s,str_hmac_sha1:function(e,t){return o(s(e,t))},str_sha1:function(e){return o(a(c(e),8*e.length))}}},"./src/strophe.js":function(e,t,n){"use strict";n.r(t);n("./src/bosh.js"),n("./src/websocket.js");var s=n("./src/core.js");n.d(t,"default",function(){return s.default})},"./src/utils.js":function(e,t,n){"use strict";function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"default",function(){return s});var s={utf16to8:function(e){var t,n,s="",r=e.length;for(t=0;t<r;t++)0<=(n=e.charCodeAt(t))&&n<=127?s+=e.charAt(t):(2047<n?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63)):s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",s="",r="",o=e[t],i="object"===c(o),a=escape(unescape(i?o.value:o));i&&(n=o.expires?";expires="+o.expires:"",s=o.domain?";domain="+o.domain:"",r=o.path?";path="+o.path:""),document.cookie=t+"="+a+n+s+r}}}},"./src/websocket.js":function(e,t,n){"use strict";n.r(t);var s=n("./src/core.js"),u=s.default.Strophe,r=s.default.$build;u.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},u.Websocket.prototype={_buildStream:function(){return r("open",{xmlns:u.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(u.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var s=n[0],r="",o="",i=0;i<s.childNodes.length;i++){var a=s.childNodes[i];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:r=a.nodeName}var c="WebSocket stream error: ";return c+=r||"unknown",o&&(c+=" - "+o),u.error(c),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,u.Status.CONNFAIL))return u.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==u.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var s=e.getAttribute("version");return"string"!=typeof s?t="Missing version in <open />":"1.0"!==s&&(t="Wrong version in <open />: "+s),!t||(this._conn._changeConnectStatus(u.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var s=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data);var r=s.getAttribute("see-other-uri");if(r){var o=this._conn.service;(0<=o.indexOf("wss:")&&0<=r.indexOf("wss:")||0<=o.indexOf("ws:"))&&(this._conn._changeConnectStatus(u.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect())}else this._conn._changeConnectStatus(u.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var i=this._streamWrap(e.data),a=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=r("close",{xmlns:u.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=u.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){u.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){u.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){u.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(u.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(u.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(u.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):u.info("Websocket closed")},_no_auth_received:function(e){u.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(u.Status.CONNFAIL,u.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){u.error("Websocket error "+e),this._conn._changeConnectStatus(u.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(0<e.length&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var s=u.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var s=this._streamWrap(e.data);t=(new DOMParser).parseFromString(s,"text/xml").documentElement}return this._check_streamerror(t,u.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(u.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){u.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=u.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=s()},function(e,t,n){"use strict";t.__esModule=!0;var s=n(6),r=n(0),o=n(1),i=function(){function e(){}return e.trasformJSONGroup=function(e){var t;try{t=new s.Group(e[r.GroupConstants.KEYS.GUID],e[r.GroupConstants.KEYS.NAME],e[r.GroupConstants.KEYS.TYPE]),e.wsChannel&&delete e.wsChannel,Object.assign(t,e),e=t}catch(e){o.Logger.error("GroupsController:transformJSONGroup",e)}return e},e}();t.GroupsController=i},function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var r=n(10),a=n(0),c=n(4),u=n(6),l=n(1),E=function(r){function e(e,t,n){var s=r.call(this,e,"text",n,a.MessageCategory.MESSAGE)||this;return s.type="text",s.data={text:t},s.text=t,s}return o(e,r),e.prototype.getSender=function(){try{return this.getSenderFromData()}catch(e){return this.sender}},e.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(e){return this.receiver}},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getText=function(){return this.text},e.prototype.setText=function(e){this.text=e,this.data.text=e},e.prototype.setProcessedText=function(e){this.processedText=e},e.prototype.getProcessedText=function(){return this.processedText},e.prototype.getSenderFromData=function(){try{var e=this.getData();if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(e){l.Logger.error("TextMessageModel: getSenderFromData",e)}},e.prototype.getReceiverFromData=function(){try{var e=this.getData(),t=e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new c.User(t);var n=new u.Group(t[a.GroupConstants.KEYS.GUID],t[a.GroupConstants.KEYS.NAME],t[a.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,t)}catch(e){l.Logger.error("TextMessageModel: getReceiverFromData",e)}},e.TYPE=a.MessageConstatnts.TYPE.TEXT,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY.MESSAGE,e}(r.BaseMessage);t.TextMessage=E},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var o=n(10),a=n(0),c=n(4),u=n(19),l=n(6),E=n(1),d=function(o){function e(e,t,n,s){var r=o.call(this,e,n,s,a.MessageCategory.MESSAGE)||this;return r.data={},"object"!=typeof t?r.data={url:t}:r.file=t,r}return r(e,o),e.prototype.setCaption=function(e){this.caption=e,this.data[a.MessageConstatnts.KEYS.TEXT]=e},e.prototype.getCaption=function(){return this.data[a.MessageConstatnts.KEYS.TEXT]},e.prototype.getSender=function(){try{return this.getSenderFromData()}catch(e){return this.sender}},e.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(e){return this.receiver}},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getAttachment=function(){return new u.Attachment(this.data.attachments[0])},e.prototype.setAttachment=function(e){this.data.attachments=[e.toJSON(e)]},e.prototype.getURL=function(){try{var e=this.getData();if(e[a.MessageConstatnts.KEYS.URL])return e[a.MessageConstatnts.KEYS.URL]}catch(e){E.Logger.error("MediaMessageModel: getURL",e)}},e.prototype.getSenderFromData=function(){try{var e=this.getData();if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(e){E.Logger.error("MediaMessageModel: getSenderFromData",e)}},e.prototype.getReceiverFromData=function(){try{var e=this.getData(),t=e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(e[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new c.User(t);var n=new l.Group(t[a.GroupConstants.KEYS.GUID],t[a.GroupConstants.KEYS.NAME],t[a.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,t)}catch(e){E.Logger.error("MediaMessageModel: getReceiverFromData",e)}},e.TYPE=a.MessageConstatnts.TYPE,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY,e}(o.BaseMessage);t.MediaMessage=d},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function t(e){e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION)&&(this.extension=e[s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE)&&(this.mimeType=e[s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.NAME)&&(this.name=e[s.ATTACHMENTS_CONSTANTS.KEYS.NAME]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.SIZE)&&(this.size=e[s.ATTACHMENTS_CONSTANTS.KEYS.SIZE]),e.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.URL)&&(this.url=e[s.ATTACHMENTS_CONSTANTS.KEYS.URL])}return t.prototype.createFileFromJSON=function(e){return new t(e)},t.prototype.toJSON=function(e){return{extension:e.getExtension(),mimeType:e.getMimeType(),name:e.getName(),url:e.getUrl(),size:e.getSize()}},t.prototype.getExtension=function(){return this.extension},t.prototype.setExtension=function(e){this.extension=e},t.prototype.getMimeType=function(){return this.mimeType},t.prototype.setMimeType=function(e){this.mimeType=e},t.prototype.getName=function(){return this.name},t.prototype.setName=function(e){this.name=e},t.prototype.getSize=function(){return this.size},t.prototype.setSize=function(e){this.size=e},t.prototype.getUrl=function(){return this.url},t.prototype.setUrl=function(e){this.url=e},t}();t.Attachment=r},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var i=n(10),c=n(0),u=n(4),l=n(1),E=n(6),a=function(a){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(3==e.length){var s=e[0],r=e[1],o=e[2];n=a.call(this,s,c.MessageConstatnts.TYPE.CUSTOM,r,c.MessageCategory.MESSAGE)||this,("object"!=typeof o||Array.isArray(o))&&(o={}),n.customData=o,l.isFalsy(n.data)&&(n.data={}),n.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=o}if(4==e.length){s=e[0],r=e[1];var i=e[2];o=e[3];n=a.call(this,s,i,r,c.MessageCategory.CUSTOM)||this,("object"!=typeof o||Array.isArray(o))&&(o={}),n.customData=o,l.isFalsy(n.data)&&(n.data={}),n.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=o}return n}return r(e,a),e.prototype.getCustomData=function(){return this.customData},e.prototype.setCustomData=function(e){this.customData=e,this.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=e},e.prototype.getSender=function(){try{return this.getSenderFromData()}catch(e){return this.sender}},e.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(e){return this.receiver}},e.prototype.getSubType=function(){return this.subType},e.prototype.setSubType=function(e){this.subType=e,this.data=o({},this.data,{subType:e})},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e,this.data=o({},this.data,{metadata:e})},e.prototype.getData=function(){return this.data},e.prototype.getSenderFromData=function(){try{var e=this.getData();if(e[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.SENDER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new u.User(e[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.SENDER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(e){l.Logger.error("CustomMessageModel: getSenderFromData",e)}},e.prototype.getReceiverFromData=function(){try{var e=this.getData(),t=e[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.RECEIVER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(e[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.RECEIVER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new u.User(t);var n=new E.Group(t[c.GroupConstants.KEYS.GUID],t[c.GroupConstants.KEYS.NAME],t[c.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,t)}catch(e){l.Logger.error("CustomMessageModel: getReceiverFromData",e)}},e}(i.BaseMessage);t.CustomMessage=a},function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var r=n(1),o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onAction=void 0,this.onTextMessageReceived=void 0,this.onMediaMessageReceived=void 0,this.onCustomMessageReceived=void 0,this.onCall=void 0,this.onTypingStarted=void 0,this.onTypingEnded=void 0,this.onMessagesDelivered=void 0,this.onMessagesRead=void 0,this.onMessageEdited=void 0,this.onMessageDeleted=void 0,r.isFalsy(e[0].onAction)||(this.onAction=e[0].onAction),r.isFalsy(e[0].onTextMessageReceived)||(this.onTextMessageReceived=e[0].onTextMessageReceived),r.isFalsy(e[0].onMediaMessageReceived)||(this.onMediaMessageReceived=e[0].onMediaMessageReceived),r.isFalsy(e[0].onCall)||(this.onCall=e[0].onCall),r.isFalsy(e[0].onTypingStarted)||(this.onTypingStarted=e[0].onTypingStarted),r.isFalsy(e[0].onTypingEnded)||(this.onTypingEnded=e[0].onTypingEnded),r.isFalsy(e[0].onMessagesDelivered)||(this.onMessagesDelivered=e[0].onMessagesDelivered),r.isFalsy(e[0].onMessagesRead)||(this.onMessagesRead=e[0].onMessagesRead),r.isFalsy(e[0].onCustomMessageReceived)||(this.onCustomMessageReceived=e[0].onCustomMessageReceived),r.isFalsy(e[0].onMessageEdited)||(this.onMessageEdited=e[0].onMessageEdited),r.isFalsy(e[0].onMessageDeleted)||(this.onMessageDeleted=e[0].onMessageDeleted)};t.MessageEventListener=o;var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onIncomingCallReceived=void 0,this.onOutgoingCallAccepted=void 0,this.onOutgoingCallRejected=void 0,this.onIncomingCallCancelled=void 0,r.isFalsy(e[0].onIncomingCallReceived)||(this.onIncomingCallReceived=e[0].onIncomingCallReceived),r.isFalsy(e[0].onOutgoingCallAccepted)||(this.onOutgoingCallAccepted=e[0].onOutgoingCallAccepted),r.isFalsy(e[0].onOutgoingCallRejected)||(this.onOutgoingCallRejected=e[0].onOutgoingCallRejected),r.isFalsy(e[0].onIncomingCallCancelled)||(this.onIncomingCallCancelled=e[0].onIncomingCallCancelled)};t.CallEventListener=a;var c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onUserOnline)||(this.onUserOnline=e[0].onUserOnline),r.isFalsy(e[0].onUserOffline)||(this.onUserOffline=e[0].onUserOffline)};t.UserEventListener=c;var u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onGroupMemberJoined)||(this.onUserJoined=e[0].onGroupMemberJoined),r.isFalsy(e[0].onGroupMemberLeft)||(this.onUserLeft=e[0].onGroupMemberLeft),r.isFalsy(e[0].onGroupMemberKicked)||(this.onUserKicked=e[0].onGroupMemberKicked),r.isFalsy(e[0].onGroupMemberBanned)||(this.onUserBanned=e[0].onGroupMemberBanned),r.isFalsy(e[0].onGroupMemberUnbanned)||(this.onUserUnbanned=e[0].onGroupMemberUnbanned),r.isFalsy(e[0].onGroupMemberScopeChanged)||(this.onMemberScopeChanged=e[0].onGroupMemberScopeChanged),r.isFalsy(e[0].onMemberAddedToGroup)||(this.onMemberAddedToGroup=e[0].onMemberAddedToGroup)};t.GroupEventListener=u;var l=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].onYouLeft)||(this.onYouLeft=e[0].onYouLeft),r.isFalsy(e[0].onYouJoined)||(this.onYouJoined=e[0].onYouJoined),r.isFalsy(e[0].onUserJoined)||(this.onUserJoined=e[0].onUserJoined),r.isFalsy(e[0].onUserLeft)||(this.onUserLeft=e[0].onUserLeft),r.isFalsy(e[0].onUserListUpdated)||(this.onUserListUpdated=e[0].onUserListUpdated),r.isFalsy(e[0].onMediaDeviceListUpdated)||(this.onMediaDeviceListUpdated=e[0].onMediaDeviceListUpdated),r.isFalsy(e[0].onRecordingStarted)||(this.onRecordingStarted=e[0].onRecordingStarted),r.isFalsy(e[0].onRecordingStopped)||(this.onRecordingStopped=e[0].onRecordingStopped),r.isFalsy(e[0].onUserMuted)||(this.onUserMuted=e[0].onUserMuted),r.isFalsy(e[0].onCallEnded)||(this.onCallEnded=e[0].onCallEnded),r.isFalsy(e[0].onError)||(this.onError=e[0].onError)};t.UserCallEventListener=l;var E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFalsy(e[0].loginSuccess)||(this.loginSuccess=e[0].loginSuccess),r.isFalsy(e[0].loginFailure)||(this.loginFailure=e[0].loginFailure),r.isFalsy(e[0].logoutSuccess)||(this.logoutSuccess=e[0].logoutSuccess),r.isFalsy(e[0].logoutFailure)||(this.logoutFailure=e[0].logoutFailure)};t.LoginEventListener=E;var d=function(e,t){this._name=e,this._callback=t},h=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(t.Listener=d);t.MessageListener=h;var p=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(d);t.UserListener=p;var S=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(d);t.GroupListener=S;var g=function(r){function e(e,t,n){var s=r.call(this,"callListner",n)||this;return s._eventListener=e,s}return i(e,r),e}(d);t.UserCallListener=g;var C=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,r}return i(e,o),e}(d);t.CallListener=C;var _=function(o){function e(e,t,n,s){var r=o.call(this,e,s)||this;return r._eventListener=t,n&&(r._cursor=n),r}return i(e,o),e}(d);t.LoginListener=_},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var s=n(3),c=n(1),u=n(0),r=n(12),o=function(){function e(e){this.store=u.constants.DEFAULT_STORE,c.isFalsy(e)||(this.store=e),this.messagesStore=r.createInstance({name:c.format(u.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),u.LOCAL_STORE.MESSAGES_STORE)}),this.messagesStore.setDriver([r.LOCALSTORAGE,r.INDEXEDDB,r.WEBSQL])}return e.getInstance=function(){return null==e.MessagesStore&&(e.MessagesStore=new e),e.MessagesStore},e.prototype.set=function(e,t){return this.messagesStore.setItem(e,t)},e.prototype.remove=function(e){this.messagesStore.removeItem(e)},e.prototype.get=function(e){return this.messagesStore.getItem(e)},e.prototype.clearStore=function(){var n=this;return new Promise(function(e,t){n.messagesStore.clear().then(function(){e(!0)}).catch(function(e){t(e)})})},e.prototype.getAllMessages=function(){var n=this,s={};return new Promise(function(e,t){n.messagesStore.iterate(function(e,t,n){t!=u.constants.MSG_VER_POST&&t!=u.constants.MSG_VER_POST&&(s=a({},s,e))}).then(function(){e(s)})})},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.prototype.storeMessages=function(e){var n=this;if(s.CometChat.user.getUid()){var r=s.CometChat.user.getUid(),o={},i=0;return this.get(u.constants.MSG_VER_POST).then(function(s){e.map(function(e){var t;if(!c.isFalsy(e)){0==i&&(i=parseInt(e.getId().toString())),i>e.getId()&&(i=parseInt(e.getId().toString())),s<e.getId()&&(s=parseInt(e.getId().toString()));var n=void 0;n=e.getSender()instanceof Object?e.getSender().getUid():e.getSender(),e.getReceiverType()==u.MessageConstatnts.RECEIVER_TYPE.GROUP&&(n=e.getReceiver()),e.getSender()instanceof Object?e.getSender().getUid()==r&&(n=e.getReceiver()):e.getSender()==r&&(n=e.getReceiver()),o[n]||(o[n]={}),o[n]=a({},o[n],((t={})[e.getId()]=e,t))}}),n.get(u.constants.MSG_VER_PRE).then(function(e){(0<i&&i<e||null==e)&&n.set(u.constants.MSG_VER_PRE,i)})&&0<s&&n.set(u.constants.MSG_VER_POST,s),Object.keys(o).map(function(t){n.get(t).then(function(e){null==e&&(e={}),n.set(t,a({},o[t],e))})})}),!0}},e}();t.MessagesStore=o},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var i=n(10),u=n(6),l=n(4),E=n(0),a=n(1),d=n(7),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.actionFromJSON=function(e){var t=new this(e[E.MessageConstatnts.KEYS.RECEIVER],e[E.MessageConstatnts.KEYS.TYPE],e[E.MessageConstatnts.KEYS.RECEIVER_TYPE],E.MessageCategory.ACTION),n=e[E.MessageConstatnts.KEYS.DATA];if(t.data=n,t.setAction(n[E.MessageConstatnts.KEYS.ACTION]),n[E.ActionConstatnts.ACTION_KEYS.EXTRAS]){var s=n[E.ActionConstatnts.ACTION_KEYS.EXTRAS];if(s[E.ActionConstatnts.ACTION_KEYS.SCOPE]){var r=s[E.ActionConstatnts.ACTION_KEYS.SCOPE];r[E.ActionConstatnts.ACTION_KEYS.NEW]&&r[E.ActionConstatnts.ACTION_KEYS.OLD]&&(t.setOldScope(r[E.ActionConstatnts.ACTION_KEYS.OLD]),t.setNewScope(r[E.ActionConstatnts.ACTION_KEYS.NEW]))}}n[E.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(n[E.MessageConstatnts.KEYS.METADATA]);var o=n[E.ActionConstatnts.ACTION_KEYS.ENTITIES];if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var i=new l.User(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionBy=i,t.setSender(i)}else{var a=new u.Group("","","");Object.assign(a,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionBy=a}if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR])if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){i=new l.User(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionFor=i}else{a=new u.Group("","","");Object.assign(a,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionFor=a}if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON])if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){i=new l.User(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionOn=i}else if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.GROUP){a=new u.Group("","","");Object.assign(a,o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t.actionOn=a}else if(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.MESSAGE){var c=d.MessageController.trasformJSONMessge(o[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]);t.actionOn=c}return t.setMessage(t.getActionMessage(t)),t},t.prototype.getOldScope=function(){return this.oldScope},t.prototype.getNewScope=function(){return this.newScope},t.prototype.setNewScope=function(e){this.newScope=e},t.prototype.setOldScope=function(e){this.oldScope=e},t.prototype.setRawData=function(e){this.rawData=e},t.prototype.getRawData=function(){return this.rawData},t.prototype.setMessage=function(e){this.message=e},t.prototype.getMessage=function(){return this.message},t.prototype.setAction=function(e){this.action=e},t.prototype.getAction=function(){return this.action},t.prototype.getSender=function(){try{return this.getSenderFromData()}catch(e){return this.sender}},t.prototype.setActionBy=function(e){this.actionBy=e},t.prototype.getActionBy=function(){return this.actionBy},t.prototype.setActionOn=function(e){this.actionOn=e},t.prototype.getActionOn=function(){return this.actionOn},t.prototype.setActionFor=function(e){this.actionFor=e},t.prototype.getActionFor=function(){return this.actionFor},t.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},t.prototype.setMetadata=function(e){this.metadata=e,this.data=o({},this.data,{metadata:e})},t.prototype.getActionMessage=function(e){var t="";switch(e.getType()){case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_USER:case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP:switch(e.getAction()){case E.ActionConstatnts.ACTION_KEYS.ACTION_CREATED:case E.ActionConstatnts.ACTION_KEYS.ACTION_UPDATED:case E.ActionConstatnts.ACTION_KEYS.ACTION_DELETED:}break;case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP_MEMBER:switch(e.getAction()){case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_JOINED:var n=e.getActionBy();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_GROUP_JOINED_MESSAGE,n.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_LEFT:n=e.getActionBy();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_GROUP_LEFT_MESSAGE,n.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_KICKED:n=e.getActionBy();var s=e.getActionOn();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_KICKED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_BANNED:n=e.getActionBy(),s=e.getActionOn();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_BANNED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_UNBANNED:n=e.getActionBy(),s=e.getActionOn();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_UNBANNED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.ACTION_SCOPE_CHANGED:n=e.getActionBy(),s=e.getActionOn();var r=e.getNewScope();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_SCOPE_CHANGED,n.getName(),s.getName(),r);break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_ADDED:n=e.getActionBy(),s=e.getActionOn();t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_ADDED_TO_GROUP,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MESSAGE_EDITED:t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MESSAGE_EDITED_MESSAGE,"");break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MESSAGE_DELETED:t=a.format(E.ActionConstatnts.ActionMessages.ACTION_MESSAGE_DELETED_MESSAGE,"")}}return t},t.prototype.getSenderFromData=function(){var e=this.data[E.ActionConstatnts.ACTION_KEYS.ENTITIES];if(e[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY]&&e[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var t=new l.User(e[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]);return Object.assign(t,e[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),t}},t.TYPE=E.MessageConstatnts.TYPE,t.RECEIVER_TYPE=E.MessageConstatnts.RECEIVER_TYPE,t.CATEGORY=E.MessageConstatnts.CATEGORY,t.ACTION_TYPE=E.ActionConstatnts.ACTION_TYPE,t}(i.BaseMessage);t.Action=c},function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.__esModule=!0;var r=n(10),a=n(6),c=n(0),u=n(1),l=n(4),E=function(r){function e(e,t,n,s){return u.isFalsy(s)?r.call(this,e,t,n,c.MessageCategory.CALL)||this:r.call(this,e,t,n,s)||this}return o(e,r),e.prototype.getCallInitiator=function(){return this.getCallInitiatedByFromData()},e.prototype.getCallReceiver=function(){return this.getCallReceivedByFromData()},e.prototype.setCallInitiator=function(e){this.callInitiator=e},e.prototype.setCallReceiver=function(e){this.callReceiver=e},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getSessionId=function(){return this.sessionId},e.prototype.setSessionId=function(e){this.sessionId=e},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.getSender=function(){try{return this.getSenderFromData()}catch(e){return this.sender}},e.prototype.setMetadata=function(e){this.metadata=e,this.data=i({},this.data,{metadata:e})},e.prototype.getAction=function(){return this.action},e.prototype.setAction=function(e){this.action=e},e.prototype.getInitiatedAt=function(){return this.initiatedAt},e.prototype.setInitiatedAt=function(e){this.initiatedAt=e},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.setJoinedAt=function(e){this.joinedAt=e},e.prototype.setRawData=function(e){this.rawData=e},e.prototype.getRawData=function(){return this.rawData},e.prototype.setSender=function(e){this.sender=e},e.prototype.setReceiver=function(e){this.receiver=e},e.callFromJSON=function(e){try{var t=new this(e[c.MessageConstatnts.KEYS.RECEIVER],e[c.MessageConstatnts.KEYS.TYPE],e[c.MessageConstatnts.KEYS.RECEIVER_TYPE],c.MessageCategory.CALL),n=e[c.MessageConstatnts.KEYS.DATA];t.setAction(n[c.MessageConstatnts.KEYS.ACTION]),n[c.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(n[c.MessageConstatnts.KEYS.METADATA]);var s=n[c.ActionConstatnts.ACTION_KEYS.ENTITIES];if(s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY];if(s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]){var r=s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON];if(r[c.CallConstants.CALL_KEYS.CALL_ENTITY]){var o=r[c.CallConstants.CALL_KEYS.CALL_ENTITY];if(o[c.CallConstants.CALL_KEYS.CALL_SESSION_ID]&&(t.sessionId=o[c.CallConstants.CALL_KEYS.CALL_SESSION_ID]),o[c.CallConstants.CALL_KEYS.CALL_STATUS]&&(t.status=o[c.CallConstants.CALL_KEYS.CALL_STATUS]),o[c.CallConstants.CALL_KEYS.CALL_DATA]){var i=o[c.CallConstants.CALL_KEYS.CALL_DATA];if(i[c.CallConstants.CALL_KEYS.CALL_METADATA]&&(t.metadata=i[c.CallConstants.CALL_KEYS.CALL_METADATA]),i[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES])i[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES]}o[c.CallConstants.CALL_KEYS.CALL_INITIATED_AT]&&(t.initiatedAt=o[c.CallConstants.CALL_KEYS.CALL_INITIATED_AT]),o[c.CallConstants.CALL_KEYS.CALL_JOINED_AT]&&(t.joinedAt=o[c.CallConstants.CALL_KEYS.CALL_JOINED_AT]),o[c.CallConstants.CALL_KEYS.CALL_LEFT_AT]&&(t.joinedAt=o[c.CallConstants.CALL_KEYS.CALL_LEFT_AT])}}return t}catch(e){u.Logger.error("CallModel: callFromJSON",e)}},e.prototype.getSenderFromData=function(){try{var e=this.getData();if((e=e[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.CallConstants.CALL_KEYS.CALL_ENTITY])return new l.User(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.CallConstants.CALL_KEYS.CALL_ENTITY])}catch(e){u.Logger.error("CallModel:getSenderFromData",e)}},e.prototype.getCallInitiatedByFromData=function(){try{var e=this.getData();if((e=e[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.CallConstants.CALL_KEYS.CALL_DATA][c.ActionConstatnts.ACTION_KEYS.ENTITIES][c.CallConstants.CALL_KEYS.CALL_SENDER])return new l.User(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.CallConstants.CALL_KEYS.CALL_DATA][c.ActionConstatnts.ACTION_KEYS.ENTITIES][c.CallConstants.CALL_KEYS.CALL_SENDER][c.CallConstants.CALL_KEYS.CALL_ENTITY])}catch(e){u.Logger.error("CallModel:getCallInitiatedByFromData",e)}},e.prototype.getCallReceivedByFromData=function(){try{var e=this.getData();if((e=e[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY]){if(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY_TYPE]==c.CallConstants.CALL_KEYS.CALL_ENTITY_USER)return new l.User(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY]);var t=new a.Group(e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.GUID],e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.NAME],e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.TYPE]);return Object.assign(t,e[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY])}}catch(e){u.Logger.error("CallModel:getCallReceivedByFromData",e)}},e.TYPE=c.MessageConstatnts.TYPE,e.RECEIVER_TYPE=c.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=c.MessageConstatnts.CATEGORY,e.ACTION_TYPE=c.ActionConstatnts.ACTION_TYPE,e}(r.BaseMessage);t.Call=E},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(12),i=n(3),a=function(){function e(e){this.store=r.constants.DEFAULT_STORE,s.isFalsy(e)||(this.store=e),this.settingsStore=o.createInstance({name:s.format(r.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),r.LOCAL_STORE.MESSAGE_LISTENERS_LIST)}),this.settingsStore.setDriver([o.LOCALSTORAGE,o.INDEXEDDB,o.WEBSQL])}return e.getInstance=function(){return null==e.settingsStore&&(e.settingsStore=new e),e.settingsStore},e.prototype.set=function(e,t){return this.settingsStore.setItem(e,t)},e.prototype.remove=function(e){this.settingsStore.removeItem(e)},e.prototype.get=function(e){return this.settingsStore.getItem(e)},e.prototype.clearStore=function(){return this.settingsStore.clear()},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.settingsStore=null,e}();t.MessageListnerMaping=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},a=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var o=n(37),c=n(1),u=n(7),s=n(0),r=function(){function e(){}return e.executeInSync=function(r,o){var t=this;return new Promise(function(s,e){return i(t,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:return t=r,o?(n=setTimeout(function(){s(r)},this.SMALL_TIMEOUT),[4,o(r)]):[3,2];case 1:t=e.sent(),e.label=2;case 2:return clearTimeout(n),s(t),[2]}})})})},e.hookBeforeMessageSent=function(s){return i(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:t=0,e.label=1;case 1:return t<o.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!e.sent()[o.ExtensionManager.cometChatExtensionList[t].getExtensionId()])return[3,6];if(!o.ExtensionManager.cometChatExtensionList[t].beforeMessageSent)return[3,6];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.executeInSync(s,o.ExtensionManager.cometChatExtensionList[t].beforeMessageSent)];case 4:return s=e.sent(),[3,6];case 5:return n=e.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return t++,[3,1];case 7:return[2,s]}})})},e.hookAfterMessageSent=function(s){return i(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:t=0,e.label=1;case 1:return t<o.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!e.sent()[o.ExtensionManager.cometChatExtensionList[t].getExtensionId()])return[3,6];if(!o.ExtensionManager.cometChatExtensionList[t].afterMessageSent)return[3,6];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.executeInSync(s,o.ExtensionManager.cometChatExtensionList[t].afterMessageSent)];case 4:return s=e.sent(),[3,6];case 5:return n=e.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return t++,[3,1];case 7:return[2,s]}})})},e.hookOnInit=function(s,r){return i(this,void 0,void 0,function(){var n=this;return a(this,function(e){return o.ExtensionManager.cometChatExtensionList.map(function(t){return i(n,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.getExtensionList()];case 1:return e.sent()[t.getExtensionId()]?s&&r&&t.onInit?[4,t.onInit(s,r)]:[3,3]:[3,5];case 2:return e.sent(),[3,5];case 3:return s&&t.onInit?[4,t.onInit(s)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[2]}})})}),[2]})})},e.hookOnMessageReceived=function(r){return i(this,void 0,void 0,function(){var t,n,s;return a(this,function(e){switch(e.label){case 0:t=u.MessageController.trasformJSONMessge(r),n=0,e.label=1;case 1:return n<o.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!e.sent()[o.ExtensionManager.cometChatExtensionList[n].getExtensionId()])return[3,6];if(!o.ExtensionManager.cometChatExtensionList[n].onMessageReceived)return[3,6];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.executeInSync(t,o.ExtensionManager.cometChatExtensionList[n].onMessageReceived)];case 4:return r=e.sent(),[3,6];case 5:return s=e.sent(),c.Logger.error("Logging error",s),[3,6];case 6:return n++,[3,1];case 7:return[2,r]}})})},e.hookOnLogin=function(s){return i(this,void 0,void 0,function(){var n=this;return a(this,function(e){return o.ExtensionManager.cometChatExtensionList.map(function(t){return i(n,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.getExtensionList()];case 1:return e.sent()[t.getExtensionId()]&&(s&&t.onLogin)?[4,t.onLogin(s)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}),[2]})})},e.executeInSyncBulk=function(r,o){var t=this;return new Promise(function(s,e){return i(t,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:return t=r,o?(n=setTimeout(function(){s(r)},this.BIG_TIMEOUT),[4,o(r)]):[3,2];case 1:t=e.sent(),e.label=2;case 2:return clearTimeout(n),s(t),[2]}})})})},e.hookOnMessageListIsFetched=function(s){return i(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:t=0,e.label=1;case 1:return t<o.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!e.sent()[o.ExtensionManager.cometChatExtensionList[t].getExtensionId()])return[3,6];if(!o.ExtensionManager.cometChatExtensionList[t].onMessageListFetched)return[3,6];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.executeInSyncBulk(s,o.ExtensionManager.cometChatExtensionList[t].onMessageListFetched)];case 4:return s=e.sent(),[3,6];case 5:return n=e.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return t++,[3,1];case 7:return[2,s]}})})},e.getExtensionList=function(){return i(this,void 0,void 0,function(){var t=this;return a(this,function(e){switch(e.label){case 0:return c.isFalsy(this.extentionList)?[4,c.getAppSettings()]:[3,2];case 1:e.sent()[s.APP_SETTINGS.KEYS.EXTENSION_LIST].map(function(e){t.extentionList[e.id]=e}),e.label=2;case 2:return[2,this.extentionList]}})})},e.SMALL_TIMEOUT=5e3,e.BIG_TIMEOUT=2e4,e.extentionList={},e}();t.ExtensionController=r},function(e,t,n){"use strict";t.__esModule=!0;var i=n(41),a=n(1),s=function(){function e(){}return e.trasformJSONConversation=function(e,t,n,s,r){var o;try{o=new i.Conversation(e,t,n,s,r)}catch(e){a.Logger.error("ConversationController:transformJSONConversation",e)}return o},e}();t.ConversationController=s},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.__esModule=!0;var i=n(1),a=n(0),c=n(9),u=n(3),l=n(2),s=function(){function o(){this.baseUrl="https://apiclient-%s.cometchat.io/",this.apiVersion="v2.0",this.apiBaseUrl=this.baseUrl+this.apiVersion+"/",this.adminApiUrl="https://api-%s.cometchat.io/",this.adminApiVersion="v2.0",this.extensionApi="https://%s-%s.cometchat.io/%s",this.prosodyApi="https://%s.%s/%s",this.uriEndpoints={authToken:{endpoint:"users/{{uid}}/auth_tokens",method:"POST",data:{uid:"string|max:100"},isAdminApi:!0},appSettings:{endpoint:"settings",method:"GET"},login:{endpoint:"admin/users/auth",method:"POST",data:{uid:"string|max:100"}},logout:{endpoint:"admin/users/auth/{{authToken}}",method:"DELETE"},getMyDetails:{endpoint:"me",method:"GET"},updateMyDetails:{endpoint:"me",method:"PUT"},getJWT:{endpoint:"me/jwt",method:"POST"},users:{endpoint:"users",method:"GET"},user:{endpoint:"users/{{uid}}",method:"GET"},blockUsers:{endpoint:"blockedusers",method:"POST"},blockedUsersList:{endpoint:"blockedusers",method:"GET"},unblockUsers:{endpoint:"blockedusers",method:"DELETE"},userLogout:{endpoint:"me",method:"DELETE"},createUser:{endpoint:"users",method:"POST",isAdminApi:!0},updateUser:{endpoint:"users/{{uid}}",method:"PUT",isAdminApi:!0},sendFriendRequests:{endpoint:"user/friends",method:"POST",data:{uids:"array<string|max:100>"}},getFriends:{endpoint:"user/friends",method:"GET"},unfriend:{endpoint:"user/friends/{{uid}}/{{gid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},acceptFriendRequest:{endpoint:"user/friends/{{uid}}/accept",method:"PUT",data:{uids:"array<string|max:100>"}},rejectFriendRequest:{endpoint:"user/friends/{{uid}}/reject",method:"DELETE",data:{uids:"array<string|max:100>"}},createGroup:{endpoint:"groups",method:"POST",data:{guid:"required|string|max:100",name:"required|string|max:100",type:"enum|public,protected,password",password:"filled|string|max:100"}},getGroups:{endpoint:"groups",method:"GET"},getGroup:{endpoint:"groups/{{guid}}",method:"GET"},updateGroup:{endpoint:"groups/{{guid}}",method:"PUT"},deleteGroup:{endpoint:"groups/{{guid}}",method:"DELETE"},addGroupMembers:{endpoint:"groups/{{guid}}/members",method:"POST",data:{uids:"array<string|max:100>"}},getGroupMembers:{endpoint:"groups/{{guid}}/members",method:"GET"},joinGroup:{endpoint:"groups/{{guid}}/members",method:"POST"},leaveGroup:{endpoint:"groups/{{guid}}/members",method:"DELETE"},kickGroupMembers:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},changeScopeOfMember:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"PUT",data:{uids:"array<string|max:100>"}},banGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"POST",data:{uids:"array<string|max:100>"}},unbanGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},addMemebersToGroup:{endpoint:"groups/{{guid}}/members",method:"PUT"},getBannedGroupMembers:{endpoint:"groups/{{guid}}/bannedusers",method:"GET"},promotemoteGroupMember:{endpoint:"groups/{{guid}}/promote",method:"PUT",data:{uids:"array<string|max:100>"}},demoteGroupMember:{endpoint:"groups/{{guid}}/demote",method:"DELETE",data:{uids:"array<string|max:100>"}},transferOwnership:{endpoint:"groups/{{guid}}/owner",method:"PATCH"},sendMessage:{endpoint:"messages",method:"POST",data:{sender:"array:string:max:100>",isGroupMember:"filled|boolean|bail",data:"required|json"}},sendMessageInThread:{endpoint:"messages/{{parentId}}/thread",method:"POST",data:{sender:"array:string:max:100>",isGroupMember:"filled|boolean|bail",data:"required|json"}},getMessages:{endpoint:"messages",method:"GET"},getMessageDetails:{endpoint:"messages/{{messageId}}",method:"GET"},getUserMessages:{endpoint:"users/{{listId}}/messages",method:"GET"},getGroupMessages:{endpoint:"groups/{{listId}}/messages",method:"GET"},getThreadMessages:{endpoint:"messages/{{listId}}/thread",method:"GET"},getMessage:{endpoint:"user/messages/{{muid}}",method:"GET"},updateMessage:{endpoint:"messages/{{messageId}}",method:"PUT"},deleteMessage:{endpoint:"messages/{{messageId}}",method:"DELETE"},createCallSession:{endpoint:"calls",method:"POST",data:{}},updateCallSession:{endpoint:"calls/{{sessionid}}",method:"put",data:{}},getConversations:{endpoint:"conversations",method:"GET"},getUserConversation:{endpoint:"users/{{uid}}/conversation",method:"GET"},getGroupConversation:{endpoint:"groups/{{guid}}/conversation",method:"GET"},deleteUserConversation:{endpoint:"users/{{uid}}/conversation",method:"DELETE"},deleteGroupConversation:{endpoint:"groups/{{guid}}/conversation",method:"DELETE"}}}return o.prototype.getEndpointData=function(r){return new Promise(function(s,t){try{c.LocalStorage.getInstance().get(a.APP_SETTINGS.APP_SETTINGS).then(function(e){if(i.isFalsy(e)){var t={};if((new o).uriEndpoints.hasOwnProperty(r))if((t=(new o).uriEndpoints[r]).hasOwnProperty("isAdminApi")){var n=i.format((new o).adminApiUrl,u.CometChat.appSettings.getRegion())+(new o).adminApiVersion+"/"+t.endpoint;t.endpoint=n}else{n=i.format((new o).baseUrl,u.CometChat.appSettings.getRegion())+(new o).apiVersion+"/"+t.endpoint;t.endpoint=n}s(t)}else{t={};if((new o).uriEndpoints.hasOwnProperty(r))if((t=(new o).uriEndpoints[r]).hasOwnProperty("isAdminApi"))t.endpoint="https://"+e[a.APP_SETTINGS.KEYS.ADMIN_API_HOST]+"/"+(new o).adminApiVersion+"/"+t.endpoint;else{n="https://"+e[a.APP_SETTINGS.KEYS.CLIENT_API_HOST]+"/"+(new o).apiVersion+"/"+t.endpoint;t.endpoint=n}s(t)}},function(e){var t;(new o).uriEndpoints.hasOwnProperty(r)&&((t=(new o).uriEndpoints[r]).hasOwnProperty(["isAdminApi"])?t.endpoint=i.format((new o).adminApiUrl,u.CometChat.appSettings.getRegion())+(new o).adminApiVersion+"/"+t.endpoint:t.endpoint=i.format((new o).baseUrl,u.CometChat.appSettings.getRegion())+(new o).apiVersion+"/"+t.endpoint),s(t)})}catch(e){t(new l.CometChatException(e))}})},o}();t.EndpointFactory=s},function(e,t,n){"use strict";t.__esModule=!0;var s=n(29),i=n(2);t.getEndPoint=function(e,o){void 0===e&&(e=""),void 0===o&&(o={});var t=new s.EndpointFactory;return new Promise(function(s,r){try{t.getEndpointData(e).then(function(e){var t=e;if(t){for(var n in o)t.endpoint=t.endpoint.replace("{{"+n+"}}",o[n]);s(t)}else r({error:"Unknown endPoint name."})})}catch(e){r(new i.CometChatException(e))}})}},function(e,p,t){"use strict";var n=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},S=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};p.__esModule=!0;var s=t(15),g=t(11),C=t(0),_=t(1),f=t(3),T=t(4);p.$iq=s.$iq,p.$build=s.$build,p.$msg=s.$msg,p.$pres=s.$pres,p.Strophe=s.Strophe,p.NS=s.Strophe.NS,p.Status=s.Strophe.Status,window.Strophe=p.Strophe,window.$iq=p.$iq,window.$msg=p.$msg,p.Strophe.addConnectionPlugin("chatstates",{init:function(e){this._connection=e,p.Strophe.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates")},statusChanged:function(e){},addActive:function(e){return e.c("active",{xmlns:p.Strophe.NS.CHATSTATES}).up()},_notificationReceived:function(e){var t=e.getElementsByTagName("composing"),n=e.getElementsByTagName("paused");e.getAttribute("from");return 0<t.length&&JSON.stringify(g.parseHTML(e.getElementsByTagName("body")[0])),n.length,!0},sendActive:function(e,t,n){this._sendNotification(e,t,"active",n)},sendComposing:function(e,t,n,s){this._sendNotification(e,t,"composing",n,s)},sendPaused:function(e,t,n,s){this._sendNotification(e,t,"paused",n,s)},sendInactive:function(e,t){this._sendNotification(e,t,"inactive")},sendGone:function(e,t){this._sendNotification(e,t,"gone")},_sendNotification:function(e,t,n,s,r){var o="";t||(t="chat"),"composing"!==n&&"paused"!==n||s&&(o=JSON.stringify(s)),_.isFalsy(r)?this._connection.send(p.$msg({to:e,from:this._connection.jid,type:t}).c("user",{xmlns:"com.cometchat.models:User"}).t(o).up().c(n,{xmlns:p.Strophe.NS.CHATSTATES})):this._connection.send(p.$msg({to:e,from:this._connection.jid,type:t}).c("user",{xmlns:"com.cometchat.models:User"}).t(o).up().c("body",JSON.stringify(r)).up().c(n,{xmlns:p.Strophe.NS.CHATSTATES}))}}),p.Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,init:function(e){this._conn=e,p.Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(e){if(e===p.Strophe.Status.CONNECTED||e===p.Strophe.Status.ATTACHED){this._conn.addHandler(this._onRequestReceived.bind(this),p.Strophe.NS.RECEIPTS,"message");var t=this;setTimeout(function(){t.resendQueue()},5e3)}},sendMessage:function(e){var t=this._conn.getUniqaueId();e.tree().setAttribute("id",t);var n=p.Strophe.xmlElement("request",{xmlns:p.Strophe.NS.RECEIPTS});return e.tree().appendChild(n),this._msgQueue[t]=e,this._retries[t]=0,this._conn.send(e),this.resendMessage(t),t},resendMessage:function(e){var t=this;setTimeout(function(){if(t._msgQueue[e]){if(!t._conn.connected)return void t.resendMessage(e);if(t._retries[e]++,t._retries[e]>t._resendCount)return;t._msgQueue[e].tree().setAttribute("from",t._conn.jid),t._conn.send(t._msgQueue[e]),t.resendMessage(e)}},this._resendTime)},addReceiptHandler:function(t,e,n,s){var r=this;this._conn.addHandler(function(e){return r._processReceipt(e),t(e)},p.Strophe.NS.RECEIPTS,"message",e,null,n,s)},_processReceipt:function(h,e){return void 0===e&&(e=0),n(this,void 0,void 0,function(){var o,i,a,c,u,l,t,n,E,s,r,d=this;return S(this,function(e){if(f.CometChat.getConnectionStatus()==C.CONNECTION_STATUS.CONNECTED){o=h.getAttribute(C.DELIVERY_RECEIPTS.ID),i=p.Strophe.getBareJidFromJid(h.getAttribute(C.MessageConstatnts.XMPP_KEYS.FROM)),a=g.getUidFromJid(i),c=C.MessageConstatnts.XMPP_KEYS.TYPE_USER,u=C.MessageConstatnts.RECEIVER_TYPE.USER,l=h.getElementsByTagName("request"),t=h.getElementsByTagName("received");try{n=h.getElementsByTagName("body")[0].innerHTML}catch(e){E=n=void 0}void 0!==n&&(E=JSON.parse(n).receiverType),s=f.CometChat.getMode(),(_.isFalsy(s)||s&&s===C.APP_SETTINGS.KEYS.DEFAULT_MODE)&&f.CometChat.getLoggedinUser().then(function(e){var t=new T.User(e);t.setAuthToken("");var n=JSON.stringify(t);if(h.getAttribute(C.MessageConstatnts.XMPP_KEYS.TYPE)==C.MessageConstatnts.XMPP_KEYS.TYPE_GROUP||void 0!==E&&E==C.MessageConstatnts.RECEIVER_TYPE.GROUP){if(u=C.MessageConstatnts.RECEIVER_TYPE.GROUP,i=g.getGroupJidFullGroupJid(h.getAttribute(C.MessageConstatnts.XMPP_KEYS.FROM)),c=C.MessageConstatnts.XMPP_KEYS.TYPE_GROUP,0<i.trim().length&&0<l.length){var s=p.$msg({to:i,type:c,from:d._conn.jid,id:d._conn.getUniqueId()}).c("user",{xmlns:"com.cometchat.models:User"}).t(n).up(),r=p.Strophe.xmlElement("delivered",{type:u,receiverId:a,xmlns:p.Strophe.NS.RECEIPTS,id:o});s.tree().appendChild(r),d._conn.send(s)}}else if(0<l.length){s=p.$msg({to:i,type:c,from:d._conn.jid,id:d._conn.getUniqueId()}).c("user",{xmlns:"com.cometchat.models:User"}).t(n).up(),r=p.Strophe.xmlElement("delivered",{type:u,receiverId:a,xmlns:p.Strophe.NS.RECEIPTS,id:o});s.tree().appendChild(r),d._conn.send(s)}}),0<t.length&&(r=t[0].getAttribute(C.DELIVERY_RECEIPTS.ID))&&(delete this._msgQueue[r],delete this._retries[r])}return[2]})})},resendQueue:function(){if(this._conn.connected)for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&this._conn.send(this._msgQueue[e]);else{var t=this;setTimeout(function(){t.resendQueue()},5e3)}},getUnreceivedMsgs:function(){var e=[];for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&e.push(this._msgQueue[t]);return e},clearMessages:function(){this._msgQueue={}}})},function(e,t,n){"use strict";t.__esModule=!0;var s=n(45),r=n(0),o=n(1),i=function(){function e(){}return e.transformPresence=function(e){return e.getAttribute("type")?new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.OFFLINE,(new Date).getTime()):new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.ONLINE,(new Date).getTime())},e.transformPresences=function(e){var t=[];return e.map(function(e){try{t.push(new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.STATUS),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.LAST_ACTIVE_AT)))}catch(e){o.Logger.error("PresenceController:transformPresences",e)}}),t},e.transformMUCUserPresence=function(e){return e.getAttribute("type")?new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.LEFT,(new Date).getTime()):new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.JOINED,(new Date).getTime())},e.trandformMUCPresence=function(e){0<e.getElementsByTagName("x").length&&this.transformMUCUserPresence(e)},e}();t.PresenceController=i},function(e,t,n){"use strict";t.__esModule=!0;var g=n(4),C=n(0),s=n(14),_=n(1),f=n(3),r=n(32),o=n(2),i=n(21),a=n(9),c=n(34),u=function(){function S(){this.TAG="calling Log",this.CALL_NO_ANSWER_INTERVAL=45e3,this.view=void 0,this.isDev=!1,this.scrollHight=0,this.scrollHight=0}return S.prototype.getCallListner=function(){return S.callListner},S.prototype.setCallListner=function(e){S.callListner=new i.UserCallListener(e)},S.getInstance=function(){try{return null!=this.callController&&null!=this.callController||(this.callController=new S),this.callController}catch(e){_.Logger.error("CallController: getInstance",e)}},S.prototype.getActiveCall=function(){try{return _.isFalsy(this.call)?null:this.call}catch(e){_.Logger.error("CallController: getActiveCall",e)}},S.prototype.initiateCall=function(n){var s=this;return new Promise(function(e,t){try{_.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),s.startCallTimer(),e(n)):t(new o.CometChatException(C.CALL_ERROR.ERROR_IN_CALLING)):t(new o.CometChatException(C.CALL_ERROR.CALL_ALREADY_INITIATED))}catch(e){t(new o.CometChatException(e))}})},S.prototype.onCallInitialized=function(){},S.prototype.joinCall=function(e){_.Logger.log(this.TAG,e)},S.prototype.cancelCall=function(){_.Logger.log(this.TAG,"calceling the call"),this.stopCallTimer()},S.prototype.rejectCall=function(){_.Logger.log(this.TAG,"rejectCall")},S.prototype.sendBusyResponse=function(){_.Logger.log(this.TAG,"sendBusyResponse")},S.prototype.endCall=function(e){var t=this;try{document.getElementsByName("frame").forEach(function(e){t.view&&(t.view.removeChild(e),t.view=void 0)}),this.endCallSession()}catch(e){_.Logger.error("CallController: endCall",e)}},S.prototype.onCallEnded=function(){var t=this;try{if(!_.isFalsy(this.call))if(this.call.getReceiverType()==C.CallConstants.RECEIVER_TYPE_GROUP)_.Logger.info(this.TAG,JSON.stringify(this.call)+"This call ended");else document.getElementsByName("frame").forEach(function(e){t.view.removeChild(e),t.view=void 0}),this.endCallSession()}catch(e){_.Logger.error("CallController:onCallEnded",e)}},S.prototype.unAnswerCall=function(){_.Logger.log(this.TAG,"unAnswerCall")},S.prototype.onCallStarted=function(n){var s=this;return new Promise(function(e,t){try{_.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),e(n)):t(new o.CometChatException(C.CALL_ERROR.ERROR_IN_CALLING)):t(new o.CometChatException(C.CALL_ERROR.CALL_ALREADY_INITIATED))}catch(e){t(new o.CometChatException(e))}})},S.prototype.endCallSession=function(){try{this.call&&this.leaveCallMuc(this.call.getSessionId()),this.call=void 0,S.callController=void 0,this.timer&&this.stopCallTimer(),this.view=void 0,this.removeListener(),S.callScreen=null,S.callSettings=null}catch(e){_.Logger.error("CallController:EndCallSession",{e:e})}},S.prototype.joinCallMuc=function(t){try{!f.CometChat.didMessagesPollingStart()&&f.CometChat.getConnectionStatus()==C.CONNECTION_STATUS.CONNECTED&&s.XMPPConnectionHelper.getInstance().connection?_.getAppSettings().then(function(e){s.XMPPConnectionHelper.getInstance().connection.muc.join(_.format(C.XMPP.muc_jid_string,f.CometChat.getAppId(),t,f.CometChat.getAppId(),"call."+_.getJidHost(e)),s.XMPPConnectionHelper.getInstance().connection.jid,null,function(e){var t=r.PresenceController.transformPresence(e);return s.XMPPConnectionHelper.getInstance().getUsersVCard(t.getUid(),function(e){if(!_.isFalsy(e.getUid()))switch(e.setLastActiveAt(t.getLastActiveAt()),t.getStatus()){case C.PresenceConstatnts.STATUS.ONLINE:e.setStatus(C.PresenceConstatnts.STATUS.ONLINE);break;default:e.setStatus(C.PresenceConstatnts.STATUS.OFFLINE)}}),!0})}):_.Logger.log("CallController: joinCallMuc","Currently the system is on polling mechanism")}catch(e){_.Logger.error("CallController: joinCallMuc",e)}},S.prototype.leaveCallMuc=function(t){try{!f.CometChat.didMessagesPollingStart()&&f.CometChat.getConnectionStatus()==C.CONNECTION_STATUS.CONNECTED&&s.XMPPConnectionHelper.getInstance().connection?_.getAppSettings().then(function(e){s.XMPPConnectionHelper.getInstance().connection.muc.leave(_.format(C.XMPP.muc_jid_string,f.CometChat.getAppId(),t,f.CometChat.getAppId(),"call."+_.getJidHost(e)),s.XMPPConnectionHelper.getInstance().connection.jid)}):_.Logger.log("CallController: leaveCallMuc","Currently the system is on polling mechanism")}catch(e){_.Logger.error("CallController: leaveCallMuc",e)}},S.prototype.startCallTimer=function(){var t=this;try{this.timer=setTimeout(function(){t.call?f.CometChat.sendUnansweredResponse(t.call.getSessionId()).then(function(e){t.endCallSession()}):t.endCallSession()},this.CALL_NO_ANSWER_INTERVAL)}catch(e){_.Logger.error("CallController: startCallTimer",e)}},S.prototype.stopCallTimer=function(){try{clearTimeout(this.timer)}catch(e){_.Logger.error("CallController: stopCallTimer",e)}},S.prototype.startCall=function(t,n){var s=this;try{this.timer&&this.stopCallTimer();var r=document.createElement("iframe");this.getCallUrl().then(function(e){r.src=e+"",r.name="frame",r.setAttribute("allow","camera; microphone; display-capture;"),r.setAttribute("width","100%"),r.setAttribute("height","100%"),S.callScreen=r,S.callSettings=t,n&&(s.view=n),n.appendChild(r),s.addListener()})}catch(e){_.Logger.error("CallController: startCall",e)}},S.prototype.addListener=function(){window.addEventListener("message",this.handler,!0)},S.prototype.removeListener=function(){window.removeEventListener("message",this.handler,!0)},S.prototype.handler=function(e){var t,n=this,s=S.callSettings,r=S.callScreen,o=S.getInstance().getActiveCall();try{if(void 0!==(t=JSON.parse(e.data))&&t.type==C.CallConstants.POST_MESSAGES.TYPES.HANGUP)S.deviceList=null,o?(_.Logger.info(this.TAG,S.callListner),S.getInstance().leaveCallMuc(o.getSessionId()),window.setTimeout(function(){f.CometChat.endCall(o.getSessionId(),!0).then(function(e){_.Logger.info(n.TAG,{call:e})}).catch(function(e){_.Logger.info(n.TAG,"The Call Was Already Ended")})},1e3)):f.CometChat.endCall(s.getSessionId(),!0).then(function(e){_.Logger.info(n.TAG,{call:e})}).catch(function(e){_.Logger.info(n.TAG,"The Call Was Already Ended")});else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.USER_JOINED){if(t.value){var i=void 0,a=t.value;_.isFalsy(a.uid)||_.isFalsy(a.name)||((i=new g.User(a)).setStatus("online"),f.CometChat.user.getUid().toLowerCase()!=i.getUid().toLowerCase()&&S.callListner&&(_.isFalsy(S.callListner._eventListener.onUserJoined)||S.callListner._eventListener.onUserJoined(i)))}}else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.USER_LEFT){if(t.value){i=void 0,a=t.value;_.isFalsy(a.uid)||_.isFalsy(a.name)||((i=new g.User(a)).setStatus("online"),f.CometChat.user.getUid().toLowerCase()!=i.getUid().toLowerCase()&&S.callListner&&(_.isFalsy(S.callListner._eventListener.onUserLeft)||S.callListner._eventListener.onUserLeft(i)))}}else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.USER_LIST_CHANGED){var c=[];if(t.value&&0<t.value.length)t.value.map(function(e){if(!_.isFalsy(e.uid)&&!_.isFalsy(e.name)){var t=new g.User(e);t.setStatus("online"),c.push(t)}}),S.callListner&&(_.isFalsy(S.callListner._eventListener.onUserListUpdated)||S.callListner._eventListener.onUserListUpdated(c))}else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.INITIAL_DEVICE_LIST)_.Logger.info("initialDeviceList received in SDK = ",t),t.value&&(S.deviceList=t.value);else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.DEVICE_CHANGE){if(_.Logger.info("onDeviceChange received in SDK = ",t),t.value){S.deviceList=t.value;var u=S.getAvailableDeviceObject(S.deviceList);S.callListner&&(_.isFalsy(S.callListner._eventListener.onMediaDeviceListUpdated)||S.callListner._eventListener.onMediaDeviceListUpdated(u))}}else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.RECORDING_TOGGLED){if(_.Logger.info("onRecordingToggled received in SDK = ",t),t.value)if((d=t.value).hasOwnProperty("user")&&d.hasOwnProperty("recordingStarted")&&!_.isFalsy(d.user.uid)&&!_.isFalsy(d.user.name)){var l=new g.User(d.user);l.setStatus("online");var E=d.recordingStarted;S.callListner&&(E?_.isFalsy(S.callListner._eventListener.onRecordingStarted)||S.callListner._eventListener.onRecordingStarted(l):_.isFalsy(S.callListner._eventListener.onRecordingStopped)||S.callListner._eventListener.onRecordingStopped(l))}}else if(void 0!==t&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.USER_MUTED){var d;if(_.Logger.info("onUserMuted received in SDK = ",t),t.value)if((d=t.value).hasOwnProperty("muted")&&d.hasOwnProperty("mutedBy")&&!_.isFalsy(d.muted.uid)&&!_.isFalsy(d.muted.name)&&!_.isFalsy(d.mutedBy.uid)&&!_.isFalsy(d.mutedBy.name)){var h=new g.User(d.muted);h.setStatus("online");var p=new g.User(d.mutedBy);p.setStatus("online"),S.callListner&&(_.isFalsy(S.callListner._eventListener.onUserMuted)||S.callListner._eventListener.onUserMuted(h,p))}}else void 0!==t&&t.type&&t.action&&t.type==C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE&&t.action==C.CallConstants.POST_MESSAGES.ACTIONS.LOAD&&null!=r.contentWindow&&r.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.COMETCHAT_RTC_SETTINGS,callsettings:JSON.stringify(s)},"*")}catch(e){t=void 0,_.Logger.error("CallController: startCall",e)}},S.prototype.getCallUrl=function(){var e=this,s=void 0;return new Promise(function(n,t){try{e.isDev?(s="http://localhost:3000/?v="+C.CALLING_COMPONENT_VERSION,n(s)):a.LocalStorage.getInstance().get(C.APP_SETTINGS.APP_SETTINGS).then(function(e){if(_.isFalsy(e))_.getAppSettings().then(function(e){var t="rtc-web"+e[C.APP_SETTINGS.KEYS.WEBRTC_HOST].slice(3);s="https://"+t+"/?v="+C.CALLING_COMPONENT_VERSION,n(s)});else{var t="rtc-web"+e[C.APP_SETTINGS.KEYS.WEBRTC_HOST].slice(3);s="https://"+t+"/?v="+C.CALLING_COMPONENT_VERSION,n(s)}})}catch(e){t(new o.CometChatException(e))}})},S.getAvailableDeviceArray=function(e){var t=[];try{return e&&0<e.length&&e.map(function(e){t.push(new c.MediaDevice(e.deviceId,e.label,e.active))}),t}catch(e){return _.Logger.error("CallController: getAvailableDeviceArray",e),t}},S.getAvailableDeviceObject=function(e){var t=[],n=[],s=[];try{return _.isFalsy(e)||_.isFalsy(e[C.CallConstants.AUDIO_INPUT_DEVICES])||(t=S.getAvailableDeviceArray(e[C.CallConstants.AUDIO_INPUT_DEVICES])),_.isFalsy(e)||_.isFalsy(e[C.CallConstants.AUDIO_OUTPUT_DEVICES])||(n=S.getAvailableDeviceArray(e[C.CallConstants.AUDIO_OUTPUT_DEVICES])),_.isFalsy(e)||_.isFalsy(e[C.CallConstants.VIDEO_INPUT_DEVICES])||(s=S.getAvailableDeviceArray(e[C.CallConstants.VIDEO_INPUT_DEVICES])),{audioInputDevices:t,audioOutputDevices:n,videoInputDevices:s}}catch(e){return _.Logger.error("CallController: getAvailableDeviceObject",e),{audioInputDevices:t,audioOutputDevices:n,videoInputDevices:s}}},S.prototype.getAudioInputDevices=function(){var t=[];try{return _.isFalsy(S.deviceList)||_.isFalsy(S.deviceList[C.CallConstants.AUDIO_INPUT_DEVICES])||(t=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.AUDIO_INPUT_DEVICES])),t}catch(e){return _.Logger.error("CallController: getAudioInputDevices",e),t}},S.prototype.getAudioOutputDevices=function(){var t=[];try{return _.isFalsy(S.deviceList)||_.isFalsy(S.deviceList[C.CallConstants.AUDIO_OUTPUT_DEVICES])||(t=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.AUDIO_OUTPUT_DEVICES])),t}catch(e){return _.Logger.error("CallController: getAudioOutputDevices",e),t}},S.prototype.getVideoInputDevices=function(){var t=[];try{return _.isFalsy(S.deviceList)||_.isFalsy(S.deviceList[C.CallConstants.VIDEO_INPUT_DEVICES])||(t=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.VIDEO_INPUT_DEVICES])),t}catch(e){return _.Logger.error("CallController: getVideoInputDevices",e),t}},S.prototype.setAudioInputDevice=function(t){try{if(S.callScreen&&!_.isFalsy(t)){var e=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.AUDIO_INPUT_DEVICES]).filter(function(e){return e[C.CallConstants.MEDIA_DEVICE.ID]===t&&!e[C.CallConstants.MEDIA_DEVICE.ACTIVE]});e&&0<e.length&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.CHANGE_AUDIO_INPUT,value:t},"*")}}catch(e){_.Logger.error("CallController: setAudioInputDevice",e)}},S.prototype.setAudioOutputDevice=function(t){try{if(S.callScreen&&!_.isFalsy(t)){var e=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.AUDIO_OUTPUT_DEVICES]).filter(function(e){return e[C.CallConstants.MEDIA_DEVICE.ID]===t&&!e[C.CallConstants.MEDIA_DEVICE.ACTIVE]});e&&0<e.length&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.CHANGE_AUDIO_OUTPUT,value:t},"*")}}catch(e){_.Logger.error("CallController: setAudioOutputDevice",e)}},S.prototype.setVideoInputDevice=function(t){try{if(S.callScreen&&!_.isFalsy(t)){var e=S.getAvailableDeviceArray(S.deviceList[C.CallConstants.VIDEO_INPUT_DEVICES]).filter(function(e){return e[C.CallConstants.MEDIA_DEVICE.ID]===t&&!e[C.CallConstants.MEDIA_DEVICE.ACTIVE]});e&&0<e.length&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.CHANGE_VIDEO_INPUT,value:t},"*")}}catch(e){_.Logger.error("CallController: setVideoInputDevice",e)}},S.prototype.muteAudio=function(e){try{S.callScreen&&(e?S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.MUTE_AUDIO},"*"):S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.UNMUTE_AUDIO},"*"))}catch(e){_.Logger.error("CallController: muteAudio",e)}},S.prototype.pauseVideo=function(e){try{S.callScreen&&(e?S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.PAUSE_VIDEO},"*"):S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.UNPAUSE_VIDEO},"*"))}catch(e){_.Logger.error("CallController: pauseVideo",e)}},S.prototype.setMode=function(e){try{S.callScreen&&!_.isFalsy(e)&&(e=e.toUpperCase(),-1<Object.values(C.CallConstants.CALL_MODE).indexOf(e)&&e!=C.CallConstants.CALL_MODE.SINGLE&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.SWITCH_MODE,value:e},"*"))}catch(e){_.Logger.error("CallController: setMode",e)}},S.prototype.startScreenShare=function(){try{S.callScreen&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.START_SCREENSHARE},"*")}catch(e){_.Logger.error("CallController: startScreenShare",e)}},S.prototype.stopScreenShare=function(){try{S.callScreen&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.STOP_SCREENSHARE},"*")}catch(e){_.Logger.error("CallController: stopScreenShare",e)}},S.prototype.startRecording=function(){try{S.callScreen&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.START_RECORDING},"*")}catch(e){_.Logger.error("CallController: startRecording",e)}},S.prototype.stopRecording=function(){try{S.callScreen&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.STOP_RECORDING},"*")}catch(e){_.Logger.error("CallController: stopRecording",e)}},S.prototype.endSession=function(){try{S.callScreen&&S.callScreen.contentWindow.postMessage({type:C.CallConstants.POST_MESSAGES.TYPES.ACTION_MESSAGE,action:C.CallConstants.POST_MESSAGES.ACTIONS.END_CALL},"*")}catch(e){_.Logger.error("CallController: endSession",e)}},S.prototype.destroy=function(){try{_.isFalsy(this.call)||(this.call=void 0),_.isFalsy(this.timer)||(this.timer=void 0),_.isFalsy(this.view)||(this.view=void 0)}catch(e){_.Logger.error("CallController: destroy",e)}},S.callController=void 0,S.callListner=void 0,S}();t.CallController=u},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=function(){function e(e,t,n){this.id="",this.name="",this.active=!1,s.isFalsy(e)||(this.id=e),s.isFalsy(t)||(this.name=t),this.active=!!n}return e.prototype.getId=function(){return this.id},e.prototype.setId=function(e){this.id=e||""},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e||""},e.prototype.getIsActive=function(){return this.active},e.prototype.setIsActive=function(e){this.active=!!e},e}();t.MediaDevice=r},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(e,t,n){this.receiverId=e,this.receiverType=t,this.metadata=n}return e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getReceiverId=function(){return this.receiverId},e.prototype.setReceiverId=function(e){this.receiverId=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e}();t.TypingIndicator=s},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=n(0),o=n(14),i=function(){function e(){}return e.addTypingStarted=function(e){this.TYPING_STARTED_MAP[e]=s.getCurrentTime()},e.removeTypingStarted=function(e){delete this.TYPING_STARTED_MAP[e]},e.getTypingStartedMap=function(e){if(e)return this.TYPING_STARTED_MAP[e]},e.addTypingEnded=function(e){this.TYPING_ENDED_MAP[e]=s.getCurrentTime()},e.removeTypingEnded=function(e){delete this.TYPING_ENDED_MAP[e]},e.getTypingEndedMap=function(e){if(e)return this.TYPING_ENDED_MAP[e]},e.addIncomingTypingStarted=function(e){this.INCOMING_TYPING_STARTED_MAP[e.getReceiverId()]={typingNotification:e,timestamp:s.getCurrentTime()}},e.removeIncomingTypingStarted=function(e){delete this.INCOMING_TYPING_STARTED_MAP[e.getReceiverId()]},e.clearTimer=function(){var n=this;new Promise(function(e,t){Object.keys(n.TYPING_STARTED_MAP).map(function(e){s.getCurrentTime()-n.TYPING_STARTED_MAP[e]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_STARTED_MAP[e]})}),new Promise(function(e,t){Object.keys(n.TYPING_ENDED_MAP).map(function(e){s.getCurrentTime()-n.TYPING_ENDED_MAP[e]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_ENDED_MAP[e]})}),new Promise(function(e,t){Object.keys(n.INCOMING_TYPING_STARTED_MAP).map(function(e){s.getCurrentTime()-n.INCOMING_TYPING_STARTED_MAP[e][r.TYPING_NOTIFICATION.KEYS.TIMESTAMP]>=1e3*r.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(o.XMPPConnectionHelper.getInstance().publishTypinStatusNotification(n.INCOMING_TYPING_STARTED_MAP[e][r.TYPING_NOTIFICATION.KEYS.TYPING_NOTIFICATION],r.TYPING_NOTIFICATION.ACTIONS.ENDED),delete n.INCOMING_TYPING_STARTED_MAP[e])})})},e.TYPING_STARTED_MAP={},e.TYPING_ENDED_MAP={},e.INCOMING_TYPING_STARTED_MAP={},e}();t.TypingNotificationController=i},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},r=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var o=n(3),i=function(){function n(){}return n.addCometChatExtension=function(t){return s(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return n.cometChatExtensionList.push(t),o.CometChat.user?[4,t.onInit(o.CometChat.getAppId(),o.CometChat.user)]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.onInit(o.CometChat.getAppId())];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.cometChatExtensionList=[],n}();t.ExtensionManager=i},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function t(e){this.subscriptionType=t.SUBSCRIPTION_TYPE_NONE,this.roles=null,this.region=s.DEFAULT_VALUES.REGION_DEFAULT,this.autoJoinGroup=!0,this.subscriptionType=e.subscriptionType,this.roles=e.roles,this.region=e.region,this.autoJoinGroup=e.autoJoinGroup}return t.prototype.getSubscriptionType=function(){return this.subscriptionType},t.prototype.getRoles=function(){return this.roles},t.prototype.getRegion=function(){return this.region},t.prototype.getIsAutoJoinEnabled=function(){return this.autoJoinGroup},t.SUBSCRIPTION_TYPE_NONE="NONE",t.SUBSCRIPTION_TYPE_ALL_USERS="ALL_USERS",t.SUBSCRIPTION_TYPE_ROLES="ROLES",t.SUBSCRIPTION_TYPE_FRIENDS="FRIENDS",t.REGION_EU=s.DEFAULT_VALUES.REGION_DEFAULT_EU,t.REGION_US=s.DEFAULT_VALUES.REGION_DEFAULT_US,t.REGION_IN=s.DEFAULT_VALUES.REGION_DEFAULT_IN,t.REGION_PRIVATE=s.DEFAULT_VALUES.REGION_DEFAULT_PRIVATE,t}();t.AppSettings=r;var o=function(){function e(){this.subscriptionType=r.SUBSCRIPTION_TYPE_NONE,this.roles=null,this.region=s.DEFAULT_VALUES.REGION_DEFAULT,this.autoJoinGroup=!0}return e.prototype.subscribePresenceForAllUsers=function(){return this.subscriptionType=r.SUBSCRIPTION_TYPE_ALL_USERS,this},e.prototype.subscribePresenceForRoles=function(e){return this.subscriptionType=r.SUBSCRIPTION_TYPE_ROLES,this.roles=e,this},e.prototype.subscribePresenceForFriends=function(){return this.subscriptionType=r.SUBSCRIPTION_TYPE_FRIENDS,this},e.prototype.setRegion=function(e){return void 0===e&&(e=s.DEFAULT_VALUES.REGION_DEFAULT),this.region=e.toLowerCase(),this},e.prototype.enableAutoJoinForGroups=function(e){return void 0===e&&(e=!0),this.autoJoinGroup=e,this},e.prototype.build=function(){return new r(this)},e}();t.AppSettingsBuilder=o},function(e,t,n){"use strict";t.__esModule=!0;var s=n(3),r=n(1),o=n(0),i=n(12),a=function(){function e(e){this.store=o.constants.DEFAULT_STORE,r.isFalsy(e)||(this.store=e),this.userStore=i.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),o.LOCAL_STORE.USERS_STORE)}),this.userStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}return e.getInstance=function(){return null==e.UserStore&&(e.UserStore=new e),e.UserStore},e.prototype.set=function(e,t){return this.userStore.setItem(e,t)},e.prototype.remove=function(e){this.userStore.removeItem(e)},e.prototype.get=function(e){return this.userStore.getItem(e)},e.prototype.clearStore=function(){var n=this;return new Promise(function(e,t){n.userStore.clear().then(function(){e(!0)}).catch(function(e){t(e)})})},e.prototype.clear=function(e){},e.prototype.selectStore=function(e){this.store=e},e.prototype.storeUsers=function(e){var t=this;return e.map(function(e){t.set(e.getUid(),e)}),!0},e.prototype.storeUser=function(e){return this.set(e.getUid(),e),!0},e}();t.UserStore=a},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function e(e,t){this.joinedAt=0,this.isBanned=0,this.uid=e,t&&(this.scope=t)}return e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e.prototype.getAvatar=function(){return this.avatar},e.prototype.setAvatar=function(e){this.avatar=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getLink=function(){return this.link},e.prototype.setLink=function(e){this.link=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getRole=function(){return this.role},e.prototype.setRole=function(e){this.role=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e.prototype.setGuid=function(e){this.guid=e},e.prototype.setUid=function(e){this.uid=e},e.prototype.setScope=function(e){this.scope=e},e.prototype.setJoinedAt=function(e){this.joinedAt=e},e.prototype.setIsBanned=function(e){this.isBanned=e},e.prototype.setUser=function(e){this.user=e},e.prototype.getGuid=function(){return this.guid},e.prototype.getUid=function(){return this.uid},e.prototype.getuser=function(){return this.user},e.prototype.getScope=function(){return this.scope},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.getIsBanned=function(){return this.isBanned},e.GroupMemberScope=s.GroupMemberScope,e}();t.GroupMember=r},function(e,t,n){"use strict";t.__esModule=!0;var o=n(7),i=n(0),a=n(8),c=n(16),s=function(){function e(e,t,n,s,r){this.conversationId=e,this.conversationType=t,void 0!==n&&void 0!==(this.lastMessage=n).id&&(this.lastMessage=o.MessageController.trasformJSONMessge(n)),this.conversationType==i.MessageConstatnts.RECEIVER_TYPE.USER?this.conversationWith=a.UsersController.trasformJSONUser(s):this.conversationWith=c.GroupsController.trasformJSONGroup(s),this.unreadMessageCount=void 0!==r?parseInt(r):0}return e.prototype.setConversationId=function(e){this.conversationId=e},e.prototype.setConversationType=function(e){this.conversationType=e},e.prototype.setLastMessage=function(e){this.lastMessage=e},e.prototype.setConversationWith=function(e){this.conversationWith=e},e.prototype.setUnreadMessageCount=function(e){this.unreadMessageCount=e},e.prototype.getConversationId=function(){return this.conversationId},e.prototype.getConversationType=function(){return this.conversationType},e.prototype.getLastMessage=function(){return this.lastMessage},e.prototype.getConversationWith=function(){return this.conversationWith},e.prototype.getUnreadMessageCount=function(){return this.unreadMessageCount},e}();t.Conversation=s},function(e,t){function r(e,t){for(var n in e)t[n]=e[n]}function n(e,t){var n=e.prototype;if(!(n instanceof t)){function s(){}s.prototype=t.prototype,r(n,s=new s),e.prototype=n=s}n.constructor!=e&&(n.constructor=e)}var C="http://www.w3.org/1999/xhtml",s={},_=s.ELEMENT_NODE=1,f=s.ATTRIBUTE_NODE=2,T=s.TEXT_NODE=3,m=s.CDATA_SECTION_NODE=4,A=s.ENTITY_REFERENCE_NODE=5,o=s.ENTITY_NODE=6,I=s.PROCESSING_INSTRUCTION_NODE=7,R=s.COMMENT_NODE=8,N=s.DOCUMENT_NODE=9,O=s.DOCUMENT_TYPE_NODE=10,y=s.DOCUMENT_FRAGMENT_NODE=11,i=s.NOTATION_NODE=12,a={},c={},u=(a.INDEX_SIZE_ERR=(c[1]="Index size error",1),a.DOMSTRING_SIZE_ERR=(c[2]="DOMString size error",2),a.HIERARCHY_REQUEST_ERR=(c[3]="Hierarchy request error",3)),l=(a.WRONG_DOCUMENT_ERR=(c[4]="Wrong document",4),a.INVALID_CHARACTER_ERR=(c[5]="Invalid character",5),a.NO_DATA_ALLOWED_ERR=(c[6]="No data allowed",6),a.NO_MODIFICATION_ALLOWED_ERR=(c[7]="No modification allowed",7),a.NOT_FOUND_ERR=(c[8]="Not found",8)),E=(a.NOT_SUPPORTED_ERR=(c[9]="Not supported",9),a.INUSE_ATTRIBUTE_ERR=(c[10]="Attribute in use",10));a.INVALID_STATE_ERR=(c[11]="Invalid state",11),a.SYNTAX_ERR=(c[12]="Syntax error",12),a.INVALID_MODIFICATION_ERR=(c[13]="Invalid modification",13),a.NAMESPACE_ERR=(c[14]="Invalid namespace",14),a.INVALID_ACCESS_ERR=(c[15]="Invalid access",15);function d(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,c[e]),this.message=c[e],Error.captureStackTrace&&Error.captureStackTrace(this,d);return n.code=e,t&&(this.message=this.message+": "+t),n}function h(){}function p(e,t){this._node=e,this._refresh=t,S(this)}function S(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);ne(e,"length",n.length),r(n,e),e._inc=t}}function g(){}function P(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function M(e,t,n,s){if(s?t[P(t,s)]=n:t[t.length++]=n,e){var r=(n.ownerElement=e).ownerDocument;r&&(s&&G(r,e,s),i=e,a=n,(o=r)&&o._inc++,"http://www.w3.org/2000/xmlns/"==a.namespaceURI&&(i._nsMap[a.prefix?a.localName:""]=a.value))}var o,i,a}function v(e,t,n){var s=P(t,n);if(!(0<=s))throw d(l,new Error(e.tagName+"@"+n));for(var r=t.length-1;s<r;)t[s]=t[++s];if(t.length=r,e){var o=e.ownerDocument;o&&(G(o,e,n),n.ownerElement=null)}}function L(e){if(this._features={},e)for(var t in e)this._features=e[t]}function D(){}function U(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function w(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(w(e,t))return!0}while(e=e.nextSibling)}function b(){}function G(e,t,n,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function Y(e,t,n){if(e&&e._inc){e._inc++;var s=t.childNodes;if(n)s[s.length++]=n;else{for(var r=t.firstChild,o=0;r;)r=(s[o++]=r).nextSibling;s.length=o}}}function x(e,t){var n=t.previousSibling,s=t.nextSibling;return n?n.nextSibling=s:e.firstChild=s,s?s.previousSibling=n:e.lastChild=n,Y(e.ownerDocument,e),t}function F(e,t,n){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===y){var r=t.firstChild;if(null==r)return t;var o=t.lastChild}else r=o=t;var i=n?n.previousSibling:e.lastChild;for(r.previousSibling=i,o.nextSibling=n,i?i.nextSibling=r:e.firstChild=r,null==n?e.lastChild=o:n.previousSibling=o;r.parentNode=e,r!==o&&(r=r.nextSibling););return Y(e.ownerDocument||e,e),t.nodeType==y&&(t.firstChild=t.lastChild=null),t}function B(){this._nsMap={}}function K(){}function H(){}function k(){}function V(){}function J(){}function X(){}function j(){}function q(){}function W(){}function Q(){}function z(){}function $(){}function Z(e,t){var n=[],s=9==this.nodeType&&this.documentElement||this,r=s.prefix,o=s.namespaceURI;if(o&&null==r&&null==(r=s.lookupPrefix(o)))var i=[{namespace:o,prefix:null}];return te(this,n,e,t,i),n.join("")}function ee(e,t,n){var s=e.prefix||"",r=e.namespaceURI;if(!s&&!r)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"==r)return!1;for(var o=n.length;o--;){var i=n[o];if(i.prefix==s)return i.namespace!=r}return!0}function te(e,t,n,s,r){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case _:r||(r=[]);r.length;var o=e.attributes,i=o.length,a=e.firstChild,c=e.tagName;n=C===e.namespaceURI||n,t.push("<",c);for(var u=0;u<i;u++){"xmlns"==(l=o.item(u)).prefix?r.push({prefix:l.localName,namespace:l.value}):"xmlns"==l.nodeName&&r.push({prefix:"",namespace:l.value})}for(u=0;u<i;u++){var l;if(ee(l=o.item(u),0,r)){var E=l.prefix||"",d=l.namespaceURI,h=E?" xmlns:"+E:" xmlns";t.push(h,'="',d,'"'),r.push({prefix:E,namespace:d})}te(l,t,n,s,r)}if(ee(e,0,r)){E=e.prefix||"";if(d=e.namespaceURI){h=E?" xmlns:"+E:" xmlns";t.push(h,'="',d,'"'),r.push({prefix:E,namespace:d})}}if(a||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(t.push(">"),n&&/^script$/i.test(c))for(;a;)a.data?t.push(a.data):te(a,t,n,s,r),a=a.nextSibling;else for(;a;)te(a,t,n,s,r),a=a.nextSibling;t.push("</",c,">")}else t.push("/>");return;case N:case y:for(a=e.firstChild;a;)te(a,t,n,s,r),a=a.nextSibling;return;case f:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,U),'"');case T:return t.push(e.data.replace(/[<&]/g,U).replace(/]]>/g,"]]&gt;"));case m:return t.push("<![CDATA[",e.data,"]]>");case R:return t.push("\x3c!--",e.data,"--\x3e");case O:var p=e.publicId,S=e.systemId;if(t.push("<!DOCTYPE ",e.name),p)t.push(" PUBLIC ",p),S&&"."!=S&&t.push(" ",S),t.push(">");else if(S&&"."!=S)t.push(" SYSTEM ",S,">");else{var g=e.internalSubset;g&&t.push(" [",g,"]"),t.push(">")}return;case I:return t.push("<?",e.target," ",e.data,"?>");case A:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ne(e,t,n){e[t]=n}d.prototype=Error.prototype,r(a,d),h.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],s=0;s<this.length;s++)te(this[s],n,e,t);return n.join("")}},p.prototype.item=function(e){return S(this),this[e]},n(p,h),g.prototype={length:0,item:h.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new d(E);var n=this.getNamedItem(e.nodeName);return M(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new d(E);return t=this.getNamedItemNS(e.namespaceURI,e.localName),M(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return v(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return v(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var s=this[n];if(s.localName==t&&s.namespaceURI==e)return s}return null}},L.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var s=new b;if(s.implementation=this,s.childNodes=new h,(s.doctype=n)&&s.appendChild(n),t){var r=s.createElementNS(e,t);s.appendChild(r)}return s},createDocumentType:function(e,t,n){var s=new X;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=n,s}},D.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return F(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return x(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return function e(t,n,s){var r=new n.constructor;for(var o in n){var i=n[o];"object"!=typeof i&&i!=r[o]&&(r[o]=i)}n.childNodes&&(r.childNodes=new h);r.ownerDocument=t;switch(r.nodeType){case _:var a=n.attributes,c=r.attributes=new g,u=a.length;c._ownerElement=r;for(var l=0;l<u;l++)r.setAttributeNode(e(t,a.item(l),!0));break;case f:s=!0}if(s)for(var E=n.firstChild;E;)r.appendChild(e(t,E,s)),E=E.nextSibling;return r}(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==T&&e.nodeType==T?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var s in n)if(n[s]==e)return s;t=t.nodeType==f?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==f?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},r(s,D),r(s,D.prototype),b.prototype={nodeName:"#document",nodeType:N,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType!=y)return null==this.documentElement&&e.nodeType==_&&(this.documentElement=e),F(this,e,t),e.ownerDocument=this,e;for(var n=e.firstChild;n;){var s=n.nextSibling;this.insertBefore(n,t),n=s}return e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),x(this,e)},importNode:function(e,t){return function e(t,n,s){var r;switch(n.nodeType){case _:(r=n.cloneNode(!1)).ownerDocument=t;case y:break;case f:s=!0}r||(r=n.cloneNode(!1));r.ownerDocument=t;r.parentNode=null;if(s)for(var o=n.firstChild;o;)r.appendChild(e(t,o,s)),o=o.nextSibling;return r}(this,e,t)},getElementById:function(t){var n=null;return w(this.documentElement,function(e){if(e.nodeType==_&&e.getAttribute("id")==t)return n=e,!0}),n},getElementsByClassName:function(e){var s=new RegExp("(^|\\s)"+e+"(\\s|$)");return new p(this,function(t){var n=[];return w(t.documentElement,function(e){e!==t&&e.nodeType==_&&s.test(e.getAttribute("class"))&&n.push(e)}),n})},createElement:function(e){var t=new B;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new h,(t.attributes=new g)._ownerElement=t},createDocumentFragment:function(){var e=new Q;return e.ownerDocument=this,e.childNodes=new h,e},createTextNode:function(e){var t=new k;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new V;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new J;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new z;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new K;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new W;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new B,s=t.split(":"),r=n.attributes=new g;return n.childNodes=new h,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=t,r._ownerElement=n},createAttributeNS:function(e,t){var n=new K,s=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=t,n}},n(b,D),b.prototype.getElementsByTagName=(B.prototype={nodeType:_,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===y?this.insertBefore(e,null):function(e,t){var n=t.parentNode;if(n){var s=e.lastChild;n.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,Y(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+n,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(s){return new p(this,function(t){var n=[];return w(t,function(e){e===t||e.nodeType!=_||"*"!==s&&e.tagName!=s||n.push(e)}),n})},getElementsByTagNameNS:function(s,r){return new p(this,function(t){var n=[];return w(t,function(e){e===t||e.nodeType!==_||"*"!==s&&e.namespaceURI!==s||"*"!==r&&e.localName!=r||n.push(e)}),n})}}).getElementsByTagName,b.prototype.getElementsByTagNameNS=B.prototype.getElementsByTagNameNS,n(B,D),K.prototype.nodeType=f,n(K,D),H.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(c[u])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},n(H,D),k.prototype={nodeName:"#text",nodeType:T,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(k,H),V.prototype={nodeName:"#comment",nodeType:R},n(V,H),J.prototype={nodeName:"#cdata-section",nodeType:m},n(J,H),X.prototype.nodeType=O,n(X,D),j.prototype.nodeType=i,n(j,D),q.prototype.nodeType=o,n(q,D),W.prototype.nodeType=A,n(W,D),Q.prototype.nodeName="#document-fragment",Q.prototype.nodeType=y,n(Q,D),z.prototype.nodeType=I,n(z,D),$.prototype.serializeToString=function(e,t,n){return Z.call(e,t,n)},D.prototype.toString=Z;try{if(Object.defineProperty){Object.defineProperty(p.prototype,"length",{get:function(){return S(this),this.$$length}}),Object.defineProperty(D.prototype,"textContent",{get:function(){return function e(t){switch(t.nodeType){case _:case y:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}}(this)},set:function(e){switch(this.nodeType){case _:case y:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.Node=D,t.DOMException=d,t.DOMImplementation=L,t.XMLSerializer=$},function(e,t,n){"use strict";t.__esModule=!0;var s=n(3);t.init=function(e){return s.CometChat.getInstance(e)},t.CometChat=s.CometChat},function(e,t,n){"use strict";t.__esModule=!0;var s=function(){function e(){this.RECEIPT_TYPE={READ_RECEIPT:"read",DELIVERY_RECEIPT:"delivery"},this.receiptType=this.RECEIPT_TYPE.DELIVERY_RECEIPT}return e.prototype.getReceiverType=function(){return this.receiverType},e.prototype.setReceiverType=function(e){this.receiverType=e},e.prototype.getSender=function(){return this.sender},e.prototype.setSender=function(e){this.sender=e},e.prototype.getReceiver=function(){return this.receiver},e.prototype.setReceiver=function(e){this.receiver=e},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.setTimestamp=function(e){this.timestamp=e},e.prototype.setReadAt=function(e){this.readAt=e},e.prototype.getReadAt=function(){return this.readAt},e.prototype.setDeliveredAt=function(e){this.deliveredAt=e},e.prototype.getDeliveredAt=function(){return this.deliveredAt},e.prototype.getMessageId=function(){return this.messageId},e.prototype.setMessageId=function(e){this.messageId=e},e.prototype.getReceiptType=function(){return this.receiptType},e.prototype.setReceiptType=function(e){void 0===e&&(e=this.RECEIPT_TYPE.DELIVERY_RECEIPT),this.receiptType=e},e}();t.MessageReceipt=s},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=n(11),s=function(){function e(e,t,n,s){r.isFalsy(e)||(this.jid=e,this.uid=o.getUidFromJid(e),r.isFalsy(s)||(this.priority=s),r.isFalsy(t)||(this.status=t),r.isFalsy(n)||(this.lastActiveAt=n))}return e.prototype.getUid=function(){return this.uid},e.prototype.setUid=function(e){this.uid=e},e.prototype.getJid=function(){return this.jid},e.prototype.setJid=function(e){this.jid=e},e.prototype.getPriority=function(){return this.priority},e.prototype.setPriority=function(e){this.priority=e},e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(e){this.status=e},e.prototype.getLastActiveAt=function(){return this.lastActiveAt},e.prototype.setLastActiveAt=function(e){this.lastActiveAt=e},e.prototype.getStatusMessage=function(){return this.statusMessage},e.prototype.setStatusMessage=function(e){this.statusMessage=e},e}();t.UserPresence=s},function(e,t,n){!function(d){"use strict";var n,u,a={}.hasOwnProperty,r=function(e,t){return function(){return e.apply(t,arguments)}};d.Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(e){return this._connection=e,this._muc_handler=null,d.Strophe.addNamespace("MUC_OWNER",d.Strophe.NS.MUC+"#owner"),d.Strophe.addNamespace("MUC_ADMIN",d.Strophe.NS.MUC+"#admin"),d.Strophe.addNamespace("MUC_USER",d.Strophe.NS.MUC+"#user"),d.Strophe.addNamespace("MUC_ROOMCONF",d.Strophe.NS.MUC+"#roomconfig"),d.Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(l,e,t,n,s,r,o,i){var a,c,E;return c=this.test_append_nick(l,e),a=d.$pres({from:this._connection.jid,to:c}).c("x",{xmlns:d.Strophe.NS.MUC}),null!=o&&(a=a.c("history",o).up()),null!=r&&a.cnode(d.Strophe.xmlElement("password",[],r)),null!=i&&a.up().cnode(i),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler((E=this,function(e){var t,n,s,r,o,i,a,c,u;if(!(t=e.getAttribute("from")))return!0;if(i=t.split("/")[0],!E.rooms[i])return!0;if(l=E.rooms[i],n={},"message"===e.nodeName)n=l._message_handlers;else if("presence"===e.nodeName&&0<(u=e.getElementsByTagName("x")).length)for(s=0,o=u.length;s<o;s++)if(a=u[s],(c=a.getAttribute("xmlns"))&&c.match(d.Strophe.NS.MUC)){n=l._presence_handlers;break}for(r in n)(0,n[r])(e,l)||delete n[r];return!0}))),this.rooms.hasOwnProperty(l)||(this.rooms[l]=new u(this,l,e,r),n&&this.rooms[l].addHandler("presence",n),t&&this.rooms[l].addHandler("message",t),s&&this.rooms[l].addHandler("roster",s),this.roomNames.push(l)),this._connection.send(a)},leave:function(e,t,n,s){var r,o,i,a;return r=this.roomNames.indexOf(e),delete this.rooms[e],0<=r&&(this.roomNames.splice(r,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),a=this.test_append_nick(e,t),i=this._connection.getUniqueId(),o=d.$pres({type:"unavailable",id:i,from:this._connection.jid,to:a}),null!=s&&o.c("status",s),null!=n&&this._connection.addHandler(n,null,"presence",null,i),this._connection.send(o),i},message:function(e,t,n,s,r,o){var i,a,c;return c=this.test_append_nick(e,t),r=r||(null!=t?"chat":"groupchat"),o=o||this._connection.getUniqueId(),(i=d.$msg({to:c,from:this._connection.jid,type:r,id:o}).c("body").t(n)).up(),null!=s&&(i.c("html",{xmlns:d.Strophe.NS.XHTML_IM}).c("body",{xmlns:d.Strophe.NS.XHTML}).h(s),0===i.node.childNodes.length?(a=i.node.parentNode,i.up().up(),i.node.removeChild(a)):i.up().up()),i.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(i),o},groupchat:function(e,t,n,s){return this.message(e,null,t,n,void 0,s)},invite:function(e,t,n){var s,r;return r=this._connection.getUniqueId(),s=d.$msg({from:this._connection.jid,to:e,id:r}).c("x",{xmlns:d.Strophe.NS.MUC_USER}).c("invite",{to:t}),null!=n&&s.c("reason",n),this._connection.send(s),r},multipleInvites:function(e,t,n){var s,r,o,i,a;for(i=this._connection.getUniqueId(),r=d.$msg({from:this._connection.jid,to:e,id:i}).c("x",{xmlns:d.Strophe.NS.MUC_USER}),s=0,o=t.length;s<o;s++)a=t[s],r.c("invite",{to:a}),null!=n&&(r.c("reason",n),r.up()),r.up();return this._connection.send(r),i},directInvite:function(e,t,n,s){var r,o,i;return i=this._connection.getUniqueId(),r={xmlns:"jabber:x:conference",jid:e},null!=n&&(r.reason=n),null!=s&&(r.password=s),o=d.$msg({from:this._connection.jid,to:t,id:i}).c("x",r),this._connection.send(o),i},queryOccupants:function(e,t,n){var s,r;return s={xmlns:d.Strophe.NS.DISCO_ITEMS},r=d.$iq({from:this._connection.jid,to:e,type:"get"}).c("query",s),this._connection.sendIQ(r,t,n)},configure:function(e,t,n){var s,r;return s=d.$iq({to:e,type:"get"}).c("query",{xmlns:d.Strophe.NS.MUC_OWNER}),r=s.tree(),this._connection.sendIQ(r,t,n)},cancelConfigure:function(e){var t,n;return t=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=t.tree(),this._connection.sendIQ(n)},saveConfiguration:function(e,t,n,s){var r,o,i,a,c;if(i=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_OWNER}),void 0!==d.Strophe.x&&void 0!==d.Strophe.x.Form&&t instanceof d.Strophe.x.Form)t.type="submit",i.cnode(t.toXML());else for(i.c("x",{xmlns:"jabber:x:data",type:"submit"}),o=0,a=t.length;o<a;o++)r=t[o],i.cnode(r).up();return c=i.tree(),this._connection.sendIQ(c,n,s)},createInstantRoom:function(e,t,n){var s;return s=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(s.tree(),t,n)},createConfiguredRoom:function(e,t,n,s){var r,o,i;for(r in(o=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),t)a.call(t,r)&&(i=t[r],o.c("field",{var:r}).c("value").t(i).up().up());return this._connection.sendIQ(o.tree(),n,s)},setTopic:function(e,t){var n;return n=d.$msg({to:e,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(t),this._connection.send(n.tree())},_modifyPrivilege:function(e,t,n,s,r){var o;return o=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_ADMIN}).cnode(t.node),null!=n&&o.c("reason",n),this._connection.sendIQ(o.tree(),s,r)},modifyRole:function(e,t,n,s,r,o){var i;return i=d.$build("item",{nick:t,role:n}),this._modifyPrivilege(e,i,s,r,o)},kick:function(e,t,n,s,r){return this.modifyRole(e,t,"none",n,s,r)},voice:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},mute:function(e,t,n,s,r){return this.modifyRole(e,t,"visitor",n,s,r)},op:function(e,t,n,s,r){return this.modifyRole(e,t,"moderator",n,s,r)},deop:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},modifyAffiliation:function(e,t,n,s,r,o){var i;return i=d.$build("item",{jid:t,affiliation:n}),this._modifyPrivilege(e,i,s,r,o)},ban:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"outcast",n,s,r)},member:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"member",n,s,r)},revoke:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"none",n,s,r)},owner:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"owner",n,s,r)},admin:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"admin",n,s,r)},changeNick:function(e,t){var n,s;return s=this.test_append_nick(e,t),n=d.$pres({from:this._connection.jid,to:s,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(e,t,n,s){var r,o;return o=this.test_append_nick(e,t),r=d.$pres({from:this._connection.jid,to:o}),null!=n&&r.c("show",n).up(),null!=s&&r.c("status",s),this._connection.send(r.tree())},registrationRequest:function(e,a,t){var n;return n=d.$iq({to:e,from:this._connection.jid,type:"get"}).c("query",{xmlns:d.Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(n,function(e){var t,n,s,r,o,i;for((n=e.getElementsByTagName("field")).length,r={required:[],optional:[]},o=0,i=n.length;o<i;o++)t=n[o],s={var:t.getAttribute("var"),label:t.getAttribute("label"),type:t.getAttribute("type")},0<t.getElementsByTagName("required").length?r.required.push(s):r.optional.push(s);return a(r)},t)},submitRegistrationForm:function(e,t,n,s){var r,o,i;for(o in(r=d.$iq({to:e,type:"set"}).c("query",{xmlns:d.Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up(),t)i=t[o],r.c("field",{var:o}).c("value").t(i).up().up();return this._connection.sendIQ(r,n,s)},listRooms:function(e,t,n){var s;return s=d.$iq({to:e,from:this._connection.jid,type:"get"}).c("query",{xmlns:d.Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(s,t,n)},test_append_nick:function(e,t){var n,s;return s=d.Strophe.escapeNode(d.Strophe.getNodeFromJid(e)),n=d.Strophe.getDomainFromJid(e),s+"@"+n+(null!=t?"/"+t:"")}}),u=function(){function i(e,t,n,s){this.client=e,this.name=t,this.nick=n,this.password=s,this._roomRosterHandler=r(this._roomRosterHandler,this),this._addOccupant=r(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=d.Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return i.prototype.join=function(e,t,n){return this.client.join(this.name,this.nick,e,t,n,this.password)},i.prototype.leave=function(e,t){return this.client.leave(this.name,this.nick,e,t),delete this.client.rooms[this.name]},i.prototype.message=function(e,t,n,s){return this.client.message(this.name,e,t,n,s)},i.prototype.groupchat=function(e,t){return this.client.groupchat(this.name,e,t)},i.prototype.invite=function(e,t){return this.client.invite(this.name,e,t)},i.prototype.multipleInvites=function(e,t){return this.client.invite(this.name,e,t)},i.prototype.directInvite=function(e,t){return this.client.directInvite(this.name,e,t,this.password)},i.prototype.configure=function(e){return this.client.configure(this.name,e)},i.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},i.prototype.saveConfiguration=function(e){return this.client.saveConfiguration(this.name,e)},i.prototype.queryOccupants=function(e,t){return this.client.queryOccupants(this.name,e,t)},i.prototype.setTopic=function(e){return this.client.setTopic(this.name,e)},i.prototype.modifyRole=function(e,t,n,s,r){return this.client.modifyRole(this.name,e,t,n,s,r)},i.prototype.kick=function(e,t,n,s){return this.client.kick(this.name,e,t,n,s)},i.prototype.voice=function(e,t,n,s){return this.client.voice(this.name,e,t,n,s)},i.prototype.mute=function(e,t,n,s){return this.client.mute(this.name,e,t,n,s)},i.prototype.op=function(e,t,n,s){return this.client.op(this.name,e,t,n,s)},i.prototype.deop=function(e,t,n,s){return this.client.deop(this.name,e,t,n,s)},i.prototype.modifyAffiliation=function(e,t,n,s,r){return this.client.modifyAffiliation(this.name,e,t,n,s,r)},i.prototype.ban=function(e,t,n,s){return this.client.ban(this.name,e,t,n,s)},i.prototype.member=function(e,t,n,s){return this.client.member(this.name,e,t,n,s)},i.prototype.revoke=function(e,t,n,s){return this.client.revoke(this.name,e,t,n,s)},i.prototype.owner=function(e,t,n,s){return this.client.owner(this.name,e,t,n,s)},i.prototype.admin=function(e,t,n,s){return this.client.admin(this.name,e,t,n,s)},i.prototype.changeNick=function(e){return this.nick=e,this.client.changeNick(this.name,nick)},i.prototype.setStatus=function(e,t){return this.client.setStatus(this.name,this.nick,e,t)},i.prototype.addHandler=function(e,t){var n;switch(n=this._handler_ids++,e){case"presence":this._presence_handlers[n]=t;break;case"message":this._message_handlers[n]=t;break;case"roster":this._roster_handlers[n]=t;break;default:return this._handler_ids--,null}return n},i.prototype.removeHandler=function(e){return delete this._presence_handlers[e],delete this._message_handlers[e],delete this._roster_handlers[e]},i.prototype._addOccupant=function(e){var t;return t=new n(e,this),this.roster[t.nick]=t},i.prototype._roomRosterHandler=function(e){var t,n,s,r,o;switch(t=i._parsePresence(e),r=t.nick,s=t.newnick||null,t.type){case"error":return!0;case"unavailable":s&&(t.nick=s,this.roster[r]&&this.roster[s]&&(this.roster[r].update(this.roster[s]),this.roster[s]=this.roster[r]),this.roster[r]&&!this.roster[s]&&(this.roster[s]=this.roster[r].update(t))),delete this.roster[r];break;default:this.roster[r]?this.roster[r].update(t):this._addOccupant(t)}for(n in o=this._roster_handlers)(0,o[n])(this.roster,this)||delete this._roster_handlers[n];return!0},i._parsePresence=function(e){var t,n,s,r,o,i,a,c,u,l;for((s={}).nick=d.Strophe.getResourceFromJid(e.getAttribute("from")),s.type=e.getAttribute("type"),s.states=[],c=e.childNodes,r=0,i=c.length;r<i;r++)switch((t=c[r]).nodeName){case"error":s.errorcode=t.getAttribute("code"),s.error=null!=(u=t.childNodes[0])?u.nodeName:void 0;break;case"status":s.status=t.textContent||null;break;case"show":s.show=t.textContent||null;break;case"x":if(t.getAttribute("xmlns")===d.Strophe.NS.MUC_USER)for(l=t.childNodes,o=0,a=l.length;o<a;o++)switch((n=l[o]).nodeName){case"item":s.affiliation=n.getAttribute("affiliation"),s.role=n.getAttribute("role"),s.jid=n.getAttribute("jid"),s.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&s.states.push(n.getAttribute("code"))}}return s},i}(),function(){function e(e){this.parse=r(this.parse,this),null!=e&&this.parse(e)}e.prototype.parse=function(e){var t,n,s,r,o,i,a,c,u,l,E,d,h;for(d=e.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,u=d.length;o<u;o++)switch(s=d[o],n=s.attributes,s.nodeName){case"identity":for(i={},a=0,l=n.length;a<l;a++)t=n[a],i[t.name]=t.textContent;this.identities.push(i);break;case"feature":this.features.push(s.getAttribute("var"));break;case"x":if("FORM_TYPE"===!s.childNodes[0].getAttribute("var")||"hidden"===!s.childNodes[0].getAttribute("type"))break;for(h=s.childNodes,c=0,E=h.length;c<E;c++)(r=h[c]).attributes.type||this.x.push({var:r.getAttribute("var"),label:r.getAttribute("label")||"",value:r.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),n=function(){function e(e,t){this.room=t,this.update=r(this.update,this),this.admin=r(this.admin,this),this.owner=r(this.owner,this),this.revoke=r(this.revoke,this),this.member=r(this.member,this),this.ban=r(this.ban,this),this.modifyAffiliation=r(this.modifyAffiliation,this),this.deop=r(this.deop,this),this.op=r(this.op,this),this.mute=r(this.mute,this),this.voice=r(this.voice,this),this.kick=r(this.kick,this),this.modifyRole=r(this.modifyRole,this),this.update(e)}return e.prototype.modifyRole=function(e,t,n,s){return this.room.modifyRole(this.nick,e,t,n,s)},e.prototype.kick=function(e,t,n){return this.room.kick(this.nick,e,t,n)},e.prototype.voice=function(e,t,n){return this.room.voice(this.nick,e,t,n)},e.prototype.mute=function(e,t,n){return this.room.mute(this.nick,e,t,n)},e.prototype.op=function(e,t,n){return this.room.op(this.nick,e,t,n)},e.prototype.deop=function(e,t,n){return this.room.deop(this.nick,e,t,n)},e.prototype.modifyAffiliation=function(e,t,n,s){return this.room.modifyAffiliation(this.jid,e,t,n,s)},e.prototype.ban=function(e,t,n){return this.room.ban(this.jid,e,t,n)},e.prototype.member=function(e,t,n){return this.room.member(this.jid,e,t,n)},e.prototype.revoke=function(e,t,n){return this.room.revoke(this.jid,e,t,n)},e.prototype.owner=function(e,t,n){return this.room.owner(this.jid,e,t,n)},e.prototype.admin=function(e,t,n){return this.room.admin(this.jid,e,t,n)},e.prototype.update=function(e){return this.nick=e.nick||null,this.affiliation=e.affiliation||null,this.role=e.role||null,this.jid=e.jid||null,this.status=e.status||null,this.show=e.show||null,this},e}()}(n(15))},function(e,t,n){var s,r;s=[n(15)],void 0===(r=function(e){var r,o,i;return r=e.Strophe,e.$build,o=e.$iq,e.$msg,e.$pres,i=function(e,t,n){var s=o(t?{type:e,to:t}:{type:e});return s.c("vCard",{xmlns:r.NS.VCARD}),n&&s.cnode(n),s},r.addConnectionPlugin("vcard",{_connection:null,init:function(e){return this._connection=e,r.addNamespace("VCARD","vcard-temp")},get:function(e,t,n){var s=i("get",t);return this._connection.sendIQ(s,e,n)},set:function(e,t,n,s){var r=i("set",n,t);return this._connection.sendIQ(r,e,s)}}),e}.apply(t,s))||(e.exports=r)},function(e,t,n){var s,r;s=[n(15)],void 0===(r=function(e){var i,a;return i=e.Strophe,e.$build,a=e.$iq,e.$msg,e.$pres,i.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,i.addNamespace("PING","urn:xmpp:ping")},ping:function(e,t,n,s){var r=this._c.getUniqueId("ping"),o=a({type:"get",to:e,id:r}).c("ping",{xmlns:i.NS.PING});this._c.sendIQ(o,t,n,s)},pong:function(e){var t=e.getAttribute("from"),n=e.getAttribute("id"),s=a({type:"result",to:t,id:n});this._c.sendIQ(s)},addPingHandler:function(e){return this._c.addHandler(e,i.NS.PING,"iq","get")}}),e}.apply(t,s))||(e.exports=r)},function(e,t,n){"use strict";t.__esModule=!0;var s=n(4),r=n(0),o=n(11),i=function(){function e(){}return e.transformVCard=function(e){var t={};return t[r.UserConstants.NAME]=o.parseHTML(e.getElementsByTagName(r.UserConstants.NAME)[0]),t[r.UserConstants.UID]=o.parseHTML(e.getElementsByTagName(r.UserConstants.UID)[0]),t[r.UserConstants.AVATAR]=o.parseHTML(e.getElementsByTagName(r.UserConstants.AVATAR)[0]),t[r.UserConstants.LINK]=o.parseHTML(e.getElementsByTagName(r.UserConstants.LINK)[0]),t[r.UserConstants.STATUS]=o.parseHTML(e.getElementsByTagName(r.UserConstants.STATUS)[0]),t[r.UserConstants.LAST_ACTIVE_AT]=o.parseHTML(e.getElementsByTagName(r.UserConstants.LAST_ACTIVE_AT)[0]),t[r.UserConstants.ROLE]=o.parseHTML(e.getElementsByTagName(r.UserConstants.ROLE)[0]),t[r.UserConstants.USER_NAME]=o.parseHTML(e.getElementsByTagName(r.UserConstants.USER_NAME)[0]),new s.User(t)},e}();t.VCardController=i},function(e,t,n){"use strict";t.__esModule=!0;var s=n(3),r=n(1),o=n(0),i=n(12),a=n(2),c=function(){function e(e){this.store=o.constants.DEFAULT_STORE,r.isFalsy(e)||(this.store=e),this.keyStore=i.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),o.LOCAL_STORE.KEYS_STORE)}),this.keyStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}return e.getInstance=function(){return null==e.KeyStore&&(e.KeyStore=new e),e.KeyStore},e.prototype.set=function(e,t){return this.keyStore.setItem(e,t)},e.prototype.remove=function(e){this.keyStore.removeItem(e)},e.prototype.get=function(e){var s=this;return new Promise(function(n,t){try{s.keyStore.getItem(e).then(function(t){try{n(JSON.parse(t))}catch(e){n(t)}},function(e){t(e)})}catch(e){t(new a.CometChatException(e))}})},e.prototype.clearStore=function(){return this.keyStore.clear()},e}();t.KeyStore=c},function(e,t,n){"use strict";t.__esModule=!0;var r=n(5),s=n(1),o=n(2),i=n(16),a=n(0),c=function(){function e(e){this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.hasJoined=0,this.withTags=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(e)||(s.isFalsy(e.limit)||(this.limit=e.limit),s.isFalsy(e.searchKeyword)||(this.searchKeyword=e.searchKeyword),s.isFalsy(e.hasJoined)||(this.hasJoined=1),s.isFalsy(e.tags)||(this.tags=e.tags),s.isFalsy(e.showTags)||(this.withTags=e.showTags))}return e.prototype.validateGroupBuilder=function(){if(void 0===this.limit)return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit")));if(isNaN(this.limit))return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(this.limit>a.DEFAULT_VALUES.GROUPS_MAX_LIMIT)return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",a.DEFAULT_VALUES.GROUPS_MAX_LIMIT)));if(this.limit<a.DEFAULT_VALUES.ZERO)return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","setSearchKeyword()")));if(s.isFalsy(this.searchKeyword.trim()))return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(void 0!==this.withTags){if(typeof this.withTags!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"WITH_TAGS","WITH_TAGS","withTags()")));1==this.withTags?this.withTags=!0:this.withTags=!1}return void 0===this.tags||Array.isArray(this.tags)?void 0:new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"TAGS","TAGS","setTags()")))},e.prototype.fetchPrevious=function(){var s=this;return new Promise(function(t,n){try{0==s.next_page&&t([]);var e=s.validateGroupBuilder();return e instanceof o.CometChatException?void n(e):r.makeApiCall("groups",{},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(i.GroupsController.trasformJSONGroup(e))}),t(n)}t([])},function(e){n(new o.CometChatException(e.error))})}catch(e){n(new o.CometChatException(e))}})},e.prototype.fetchNext=function(){var s=this;return new Promise(function(t,n){try{var e=s.validateGroupBuilder();if(e instanceof o.CometChatException)return void n(e);r.makeApiCall("getGroups",{},s.getNextData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(i.GroupsController.trasformJSONGroup(e))}),t(n)}t([])},function(e){n(new o.CometChatException(e.error))})}catch(e){n(new o.CometChatException(e))}})},e.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,s.isFalsy(this.searchKeyword)||(e.searchKey=this.searchKeyword),s.isFalsy(this.hasJoined)||(e.hasJoined=1),s.isFalsy(this.tags)||(e.tags=this.tags),s.isFalsy(this.withTags)||(e.withTags=1),1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},e.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},e.MAX_LIMIT=100,e.DEFAULT_LIMIT=30,e}();t.GroupsRequest=c;var u=function(){function e(){}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyword=function(e){return this.searchKeyword=e,this},e.prototype.joinedOnly=function(e){return this.hasJoined=e,this},e.prototype.setTags=function(e){return this.tags=e,this},e.prototype.withTags=function(e){return this.showTags=e,this},e.prototype.build=function(){return new c(this)},e}();t.GroupsRequestBuilder=u},function(e,t,n){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var o=n(5),i=n(1),a=n(9),c=n(2),u=n(53),l=n(0),E=function(){function e(e){this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.isOutCastReq=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=a.LocalStorage.getInstance(),i.isFalsy(e)||(this.limit=e.limit,this.guid=e.guid,i.isFalsy(e.searchKeyword)||(this.searchKeyword=e.searchKeyword),i.isFalsy(e.scopes)||(this.scopes=e.scopes),e instanceof h&&(this.isOutCastReq=e.isOutCastReq))}return e.prototype.validateGroupMembersBuilder=function(){if(void 0===this.limit)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit")));if(isNaN(this.limit))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(this.limit>l.DEFAULT_VALUES.USERS_MAX_LIMIT)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",l.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<l.DEFAULT_VALUES.ZERO)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==l.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","setSearchKeyword()")));if(i.isFalsy(this.searchKeyword.trim()))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(void 0!==this.guid){if(typeof this.guid!==l.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"GUID","GUID","GroupMembersRequestBuilder()")));if(i.isFalsy(this.guid))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.INVALID),"GUID","GUID","GUID","GUID")))}return void 0===this.scopes||Array.isArray(this.scopes)?void 0:new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"SET_SCOPES","SET_SCOPES","setScopes()")))},e.prototype.fetchPrevious=function(){var s=this;return new Promise(function(n,t){try{0==s.next_page&&n([]);var e=s.validateGroupMembersBuilder();return e instanceof c.CometChatException?void t(e):o.makeApiCall(s.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:s.guid},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var t=[];e.data.map(function(e){e.guid=s.guid,t.push(u.GroupMembersController.trasformJSONGroupMember(e))}),n(t)}n([])},function(e){t(new c.CometChatException(e.error))})}catch(e){t(new c.CometChatException(e))}})},e.prototype.fetchNext=function(){var s=this;return new Promise(function(n,t){try{var e=s.validateGroupMembersBuilder();if(e instanceof c.CometChatException)return void t(e);o.makeApiCall(s.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:s.guid},s.getNextData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var t=[];e.data.map(function(e){e.guid=s.guid,t.push(u.GroupMembersController.trasformJSONGroupMember(e))}),n(t)}else n([])},function(e){t(new c.CometChatException(e.error))})}catch(e){t(new c.CometChatException(e))}})},e.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,i.isFalsy(this.searchKeyword)||(e.searchKey=this.searchKeyword),i.isFalsy(this.scopes)||(e.scopes=this.scopes),1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},e.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},e.MAX_LIMIT=2,e.DEFAULT_LIMIT=1,e}();t.GroupMembersRequest=E;var d=function(){function e(e){this.guid=e}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyword=function(e){return this.searchKeyword=e,this},e.prototype.setScopes=function(e){return this.scopes=e,this},e.prototype.build=function(){return new E(this)},e}(),h=function(n){function e(e){var t=n.call(this,e)||this;return t.isOutCastReq=!0,t}return r(e,n),e.prototype.build=function(){return new E(this)},e}(t.GroupMembersRequestBuilder=d);t.GroupOutCastMembersRequestBuilder=h},function(e,t,n){"use strict";t.__esModule=!0;var s=n(40),r=n(0),o=n(1),i=function(){function e(){}return e.trasformJSONGroupMember=function(t){var e;try{return t.status&&"offline"!==t.status?t.status="online":t.status="offline",e=new s.GroupMember(t[r.GroupMemersConstans.KEYS.UID]),Object.assign(e,t),e}catch(e){return o.Logger.error("GroupMembersController:trasformJSONGroupMember",{e:e,groupMember:t}),t}},e}();t.GroupMembersController=i},function(e,t,n){"use strict";t.__esModule=!0;var o=n(5),i=n(1),a=n(8),c=n(2),s=n(39),u=n(0),l=n(3),r=function(){function r(e){this.next_page=1,this.current_page=1,this.total_pages=-1,this.hideBlockedUsers=!1,this.friendsOnly=!1,this.fetchingInProgress=!1,this.withTags=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},r.userStore=s.UserStore.getInstance(),i.isFalsy(e)||(this.limit=e.limit,i.isFalsy(e.searchKeyword)||(this.searchKeyword=e.searchKeyword),i.isFalsy(e.status)||(e.status==r.USER_STATUS.ONLINE?this.status=u.PresenceConstatnts.STATUS.AVAILABLE:this.status=e.status),i.isFalsy(e.shouldHideBlockedUsers)||(this.hideBlockedUsers=e.shouldHideBlockedUsers),i.isFalsy(e.showFriendsOnly)||(this.friendsOnly=e.showFriendsOnly),i.isFalsy(e.showTags)||(this.withTags=e.showTags),i.isFalsy(e.role)||(this.role=e.role),i.isFalsy(e.roles)||(this.roles=e.roles),i.isFalsy(e.tags)||(this.tags=e.tags),i.isFalsy(e.UIDs)||(this.UIDs=e.UIDs))}return r.prototype.validateUserBuilder=function(){if(void 0===this.limit)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit")));if(isNaN(this.limit))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(this.limit>u.DEFAULT_VALUES.USERS_MAX_LIMIT)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",u.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<u.DEFAULT_VALUES.ZERO)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","setSearchKeyword()")));if(i.isFalsy(this.searchKeyword.trim()))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(this.status){if(typeof this.status!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_STATUS","SET_STATUS","setStatus()")));if("available"!=this.status.toLowerCase()&&"offline"!=this.status.toLowerCase())return new c.CometChatException(u.UserErrors.INVALID_STATUS)}if(void 0!==this.hideBlockedUsers){if(typeof this.hideBlockedUsers!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"HIDE_BLOCKED_USERS","HIDE_BLOCKED_USERS","hideBlockedUsers()")));1==this.hideBlockedUsers?this.hideBlockedUsers=!0:this.hideBlockedUsers=!1}if(void 0!==this.friendsOnly){if(typeof this.friendsOnly!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"FRIENDS_ONLY","FRIENDS_ONLY","friendsOnly()")));1==this.friendsOnly?this.friendsOnly=!0:this.friendsOnly=!1}if(void 0!==this.withTags){if(typeof this.withTags!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"WITH_TAGS","WITH_TAGS","withTags()")));1==this.withTags?this.withTags=!0:this.withTags=!1}return void 0===this.roles||Array.isArray(this.roles)?void 0===this.tags||Array.isArray(this.tags)?void 0===this.UIDs||Array.isArray(this.UIDs)?void 0:new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"UIDs","UIDs","setUIDs()"))):new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"TAGS","TAGS","setTags()"))):new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"ROLES","ROLES","setRoles()")))},r.prototype.fetchPrevious=function(){var s=this;return this.fetchingInProgress=!0,new Promise(function(t,n){try{0==s.next_page&&(t([]),s.fetchingInProgress=!1);var e=s.validateUserBuilder();if(e instanceof c.CometChatException)return void n(e);if(!s.fetchingInProgress)return o.makeApiCall("users",{},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(a.UsersController.trasformJSONUser(e))}),r.userStore.storeUsers(n),t(n),s.fetchingInProgress=!1}t([]),s.fetchingInProgress=!1},function(e){n(new c.CometChatException(e.error)),s.fetchingInProgress=!1});t([])}catch(e){s.fetchingInProgress=!1,n(new c.CometChatException(e))}})},r.prototype.fetchNext=function(){var r=this;return new Promise(function(s,t){try{if(r.fetchingInProgress)r.fetchingInProgress=!1,s([]);else{r.fetchingInProgress=!0;var e=r.validateUserBuilder();if(e instanceof c.CometChatException)return void t(e);o.makeApiCall("users",{},r.getNextData()).then(function(e){if(e.meta&&(r.total_pages=e.meta.pagination.total_pages),0<e.data.length){r.pagination=e.meta.pagination;var t=[],n=[];e.data.map(function(e){t.push(a.UsersController.trasformJSONUser(e)),n.push(i.format(u.XMPP.username_string,l.CometChat.getAppId(),e[u.UserConstants.UID]))}),s(t)}else s([]);r.fetchingInProgress=!1},function(e){r.fetchingInProgress=!1,t(new c.CometChatException(e.error))})}}catch(e){r.fetchingInProgress=!1,t(new c.CometChatException(e))}})},r.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,i.isFalsy(this.searchKeyword)||(e.searchKey=this.searchKeyword),i.isFalsy(this.status)||(e.status=this.status),i.isFalsy(this.hideBlockedUsers)||(e.hideBlockedUsers=1),i.isFalsy(this.role)||(e.roles=this.role),i.isFalsy(this.roles)||(e.roles=this.roles),i.isFalsy(this.tags)||(e.tags=this.tags),i.isFalsy(this.friendsOnly)||(e.friendsOnly=1),i.isFalsy(this.withTags)||(e.withTags=1),i.isFalsy(this.UIDs)||(e.uids=this.UIDs),1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},r.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},r.USER_STATUS={ONLINE:u.PresenceConstatnts.STATUS.ONLINE,OFFLINE:u.PresenceConstatnts.STATUS.OFFLINE},r}();t.UsersRequest=r;var E=function(){function e(){this.shouldHideBlockedUsers=!1}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setStatus=function(e){return this.status=e,this},e.prototype.setSearchKeyword=function(e){return this.searchKeyword=e,this},e.prototype.hideBlockedUsers=function(e){return this.shouldHideBlockedUsers=e,this},e.prototype.setRole=function(e){return this.role=e,this},e.prototype.setRoles=function(e){return this.roles=e,this},e.prototype.friendsOnly=function(e){return this.showFriendsOnly=e,this},e.prototype.setTags=function(e){return this.tags=e,this},e.prototype.withTags=function(e){return this.showTags=e,this},e.prototype.setUIDs=function(e){return this.UIDs=e,this},e.prototype.build=function(){return this.role&&this.roles&&this.roles.push(this.role),new r(this)},e}();t.UsersRequestBuilder=E},function(e,t,n){"use strict";t.__esModule=!0;var r=n(5),s=n(1),o=n(2),i=n(27),a=n(0),c=function(){function e(e){this.limit=100,this.next_page=1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(e)||(this.limit=e.limit,s.isFalsy(e.conversationType)||(this.conversationType=e.conversationType))}return e.prototype.validateConversationBuilder=function(){return void 0===this.limit?new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit"))):isNaN(this.limit)?new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()"))):this.limit>a.DEFAULT_VALUES.CONVERSATION_MAX_LIMIT?new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",a.DEFAULT_VALUES.CONVERSATION_MAX_LIMIT))):this.limit<a.DEFAULT_VALUES.ZERO?new o.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()"))):void 0},e.prototype.fetchNext=function(){var s=this;return new Promise(function(n,t){try{if(s.fetchingInProgress)s.fetchingInProgress=!1,n([]);else{s.fetchingInProgress=!0;var e=s.validateConversationBuilder();if(e instanceof o.CometChatException)return void t(e);r.makeApiCall("getConversations",{},s.getNextData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var t=[];e.data.map(function(e){t.push(i.ConversationController.trasformJSONConversation(e.conversationId,e.conversationType,e.lastMessage,e.conversationWith,e.unreadMessageCount))}),n(t)}else n([]);s.fetchingInProgress=!1},function(e){s.fetchingInProgress=!1,t(new o.CometChatException(e.error))})}}catch(e){s.fetchingInProgress=!1,t(new o.CometChatException(e))}})},e.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,s.isFalsy(this.conversationType)||(e.conversationType=this.conversationType),1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},e}();t.ConversationsRequest=c;var u=function(){function e(){}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setConversationType=function(e){return this.conversationType=e,this},e.prototype.build=function(){return new c(this)},e}();t.ConversationsRequestBuilder=u},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(o,i,a,c){return new(a||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function s(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,s)}r((c=c.apply(o,i||[])).next())})},a=this&&this.__generator||function(n,s){var r,o,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=s.call(n,a)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};t.__esModule=!0;var C=n(2),_=n(5),f=n(7),T=n(1),r=n(22),m=n(0),c=n(13),A=n(3),I=n(14),R=n(11),N=n(25),u=n(26),O=n(4),y=n(31),o=function(){function e(e){this.limit=m.DEFAULT_VALUES.MSGS_LIMIT,this.timestamp=0,this.id=m.DEFAULT_VALUES.DEFAULT_MSG_ID,this.messageStore=r.MessagesStore.getInstance(),this.endpointName="getUserMessages",this.listId="",this.totalPages=0,this.unread=!1,this.inProgress=!1,this.hideMessagesFromBlockedUsers=!1,this.updatedAt=0,this.onlyUpdates=0,this.paginationMeta={},this.hideDeletedMessages=!1,this.limit=e.limit,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,this.uid=e.uid,this.guid=e.guid,this.parentMessageId=e.parentMessageId,this.timestamp=e.timestamp,this.timestamp&&(this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=this.timestamp),this.id=e.id,this.id!=m.DEFAULT_VALUES.DEFAULT_MSG_ID&&(this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.ID]=this.id),this.hideMessagesFromBlockedUsers=e.HideMessagesFromBlockedUsers,this.hideMessagesFromBlockedUsers&&(this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_MESSAGES_FROM_BLOCKED_USER]=this.hideMessagesFromBlockedUsers),this.unread=e.unread,this.unread&&(this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.UNREAD]=this.unread),e.searchKey&&(this.searchKey=e.searchKey,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY]=this.searchKey),e.onlyUpdate&&(this.onlyUpdates=e.onlyUpdate,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.ONLY_UPDATES]=this.onlyUpdates),e.updatedAt&&(this.updatedAt=e.updatedAt,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.UPDATED_AT]=this.updatedAt),e.category&&(this.category=e.category),e.categories&&(this.categories=e.categories),e.type&&(this.type=e.type),e.types&&(this.types=e.types),e.HideReplies&&(this.hideReplies=e.HideReplies,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_REPLIES]=this.hideReplies),this.hideDeletedMessages=e.HideDeletedMessages,this.hideDeletedMessages&&(this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_DELETED_MESSAGES]=this.hideDeletedMessages)}return e.prototype.fetchNext=function(){var e=this;return new Promise(function(o,i){return s(e,void 0,void 0,function(){var t,n,s,r;return a(this,function(e){switch(e.label){case 0:if(e.trys.push([0,6,,7]),this.inProgress)return this.inProgress=!1,i(new C.CometChatException(c.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),[2];if(this.inProgress=!0,this.onlyUpdates){if(0==this.updatedAt)return this.inProgress=!1,i(new C.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2]}else if(0==this.timestamp&&0==this.id&&0==this.updatedAt)return this.inProgress=!1,i(new C.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2];this.affix=m.MessageConstatnts.PAGINATION.AFFIX.APPEND,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=m.MessageConstatnts.PAGINATION.AFFIX.APPEND,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return t=e.sent(),[4,u.ExtensionController.hookOnMessageListIsFetched(t)];case 3:return n=e.sent(),o(n),this.inProgress=!1,[3,5];case 4:return s=e.sent(),this.inProgress=!1,i(new C.CometChatException(s)),[3,5];case 5:return[3,7];case 6:return r=e.sent(),this.inProgress=!1,i(new C.CometChatException(r)),[3,7];case 7:return[2]}})})})},e.prototype.fetchPrevious=function(){var e=this;return new Promise(function(o,i){return s(e,void 0,void 0,function(){var t,n,s,r;return a(this,function(e){switch(e.label){case 0:if(e.trys.push([0,6,,7]),this.inProgress)return i(new C.CometChatException(c.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),this.inProgress=!1,[2];if(this.inProgress=!0,this.onlyUpdates&&0==this.updatedAt)return this.inProgress=!1,i(new C.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2];this.affix=m.MessageConstatnts.PAGINATION.AFFIX.PREPEND,this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=m.MessageConstatnts.PAGINATION.AFFIX.PREPEND,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return t=e.sent(),[4,u.ExtensionController.hookOnMessageListIsFetched(t)];case 3:return n=e.sent(),o(n),this.inProgress=!1,[3,5];case 4:return s=e.sent(),this.inProgress=!1,i(new C.CometChatException(s)),[3,5];case 5:return[3,7];case 6:return r=e.sent(),this.inProgress=!1,i(new C.CometChatException(r)),[3,7];case 7:return[2]}})})})},e.prototype.makeAPICall=function(){var g=this;return new Promise(function(s,t){try{var e=g.uid;if(void 0!==e){if(typeof e!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"UID","UID","setUID()"))));if(T.isFalsy(e.trim()))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.INVALID),"UID","UID","UID","UID"))));g.uid=e.trim()}var n=g.guid;if(void 0!==n){if(typeof n!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"GUID","GUID","setGUID()"))));if(T.isFalsy(n.trim()))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.INVALID),"GUID","GUID","GUID","GUID"))));g.guid=n.trim()}var r=g.parentMessageId;if(void 0!==r){if(isNaN(r))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"PARENT_MESSAGE_ID","PARENT_MESSAGE_ID","setParentMessageId()"))));if(r<m.DEFAULT_VALUES.ZERO)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"PARENT_MESSAGE_ID","PARENT_MESSAGE_ID","setParentMessageId()"))))}var o=g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.PER_PAGE];if(void 0===o)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit"))));if(isNaN(o))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()"))));if(o>m.DEFAULT_VALUES.MSGS_MAX_LIMIT)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",m.DEFAULT_VALUES.MSGS_MAX_LIMIT))));if(o<m.DEFAULT_VALUES.ZERO)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()"))));var i=g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY];if(void 0!==i){if(typeof i!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","setSearchKeyword()"))));if(T.isFalsy(i.trim()))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword","search keyword"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY]=i.trim()}var c=g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.ID];if(void 0!==c){if(isNaN(c))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"MESSAGE_ID","MESSAGE_ID","setMessageId()"))));if(c<m.DEFAULT_VALUES.ZERO)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"MESSAGE_ID","MESSAGE_ID","setMessageId()"))))}var a=g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SENT_AT];if(void 0!==a){if(isNaN(a))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"TIMESTAMP","TIMESTAMP","setTimestamp()"))));if(a<m.DEFAULT_VALUES.ZERO)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"TIMESTAMP","TIMESTAMP","setTimestamp()"))))}var u=g.hideMessagesFromBlockedUsers;if(void 0!==u){if(typeof u!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"HIDE_MESSAGES_FROM_BLOCKED_USERS","HIDE_MESSAGES_FROM_BLOCKED_USERS","hideMessagesFromBlockedUsers()"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_MESSAGES_FROM_BLOCKED_USER]=1==u?1:0}var l=g.unread;if(void 0!==l){if(typeof l!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"UNREAD","UNREAD","setUnread()"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.UNREAD]=1==l?1:0}var E=g.category;if(void 0!==E){if(typeof E!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_CATEGORY","SET_CATEGORY","setCategory()"))));if(T.isFalsy(E.trim()))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.INVALID),"SET_CATEGORY","SET_CATEGORY","category","category"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.CATEGORIES]=E.trim()}var d=g.categories;if(void 0!==d){if(!Array.isArray(d))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"SET_CATEGORIES","SET_CATEGORIES","setCategories()"))));0<d.length&&(g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.CATEGORIES]=d)}var h=g.type;if(void 0!==h){if(typeof h!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_TYPE","SET_TYPE","setType()"))));if(T.isFalsy(h.trim()))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.INVALID),"SET_TYPE","SET_TYPE","type","type"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.TYPES]=h.trim()}var p=g.types;if(void 0!==p){if(!Array.isArray(p))return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_AN_ARRAY),"SET_TYPES","SET_TYPES","setTypes()"))));0<p.length&&(g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.TYPES]=p)}var S=g.hideDeletedMessages;if(void 0!==S){if(typeof S!==m.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return void t(new C.CometChatException(JSON.parse(T.format(JSON.stringify(m.GENERAL_ERROR.PARAMETER_MUST_BE_A_BOOLEAN),"HIDE_DELETED_MESSAGES","HIDE_DELETED_MESSAGES","hideDeletedMessages()"))));g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_DELETED_MESSAGES]=1==S?1:0}if(g.createEndpoint(),g.totalPages)if(1!=g.totalPages);else if(g.lastAffix==g.affix)return void s([]);_.makeApiCall(g.endpointName,{listId:g.listId},g.paginationMeta).then(function(e){var t=[];if(e[m.ResponseConstants.RESPONSE_KEYS.KEY_META][m.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(m.MessageConstatnts.PAGINATION.KEYS.ID)&&0==g.id&&(g.id=parseInt(e.meta.cursor[m.MessageConstatnts.PAGINATION.KEYS.ID])),e[m.ResponseConstants.RESPONSE_KEYS.KEY_META][m.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(m.MessageConstatnts.PAGINATION.KEYS.SENT_AT)&&0==g.timestamp&&(g.timestamp=e.meta.cursor[m.MessageConstatnts.PAGINATION.KEYS.SENT_AT]),e.meta.pagination.hasOwnProperty("total_pages")&&(g.totalPages=e.meta.pagination.total_pages),e.meta.cursor.hasOwnProperty("affix")&&(g.lastAffix=e.meta.cursor.affix),e.data[0]){0<g.id&&(g.id=parseInt(e.data[0].id)),0<g.timestamp&&(g.timestamp=e.data[0].sentAt);var d=e.data[e.data.length-1];if(!A.CometChat.didMessagesPollingStart()&&A.CometChat.getConnectionStatus()==m.CONNECTION_STATUS.CONNECTED&&I.XMPPConnectionHelper.getInstance().connection&&d.sender.toLowerCase()!=R.getUidFromJid(I.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()&&(void 0!==g.guid||void 0!==g.uid||void 0!==g.parentMessageId)&&void 0!==d){var a=d.receiverType,n=A.CometChat.getMode();(T.isFalsy(n)||n&&n===m.APP_SETTINGS.KEYS.DEFAULT_MODE)&&A.CometChat.getLoggedInUser().then(function(e){var t=new O.User(e);t.setAuthToken("");var s=JSON.stringify(t);if(a==m.MessageConstatnts.RECEIVER_TYPE.USER){if(T.isFalsy(d.deliveredAt)){var r=d.receiver,o=d.id,n=d.sender;R.getJidFromUid(n).then(function(e){var t=y.$msg({to:e,from:I.XMPPConnectionHelper.getInstance().connection.jid,id:I.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:m.MessageConstatnts.XMPP_KEYS.TYPE_USER}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=y.Strophe.xmlElement("delivered",{type:a,receiverId:r,xmlns:"urn:xmpp:receipts",id:"["+A.CometChat.getAppId()+"]"+o});t.tree().appendChild(n),I.XMPPConnectionHelper.getInstance().connection.send(t)})}}else{var i=d.receiver;c=d.id,R.getGroupJidFromGUID(i).then(function(e){var t=y.$msg({to:e,from:I.XMPPConnectionHelper.getInstance().connection.jid,id:I.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:m.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=y.Strophe.xmlElement("delivered",{type:a,receiverId:i,xmlns:"urn:xmpp:receipts",id:"["+A.CometChat.getAppId()+"]"+c});t.tree().appendChild(n),I.XMPPConnectionHelper.getInstance().connection.send(t)})}})}e.data.map(function(l){if(!A.CometChat.didMessagesPollingStart()&&A.CometChat.getConnectionStatus()==m.CONNECTION_STATUS.CONNECTED&&I.XMPPConnectionHelper.getInstance().connection&&l.sender.toLowerCase()!=R.getUidFromJid(I.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()&&void 0===g.guid&&void 0===g.uid&&void 0===g.parentMessageId){var E=l.receiverType,e=A.CometChat.getMode();(T.isFalsy(e)||e&&e===m.APP_SETTINGS.KEYS.DEFAULT_MODE)&&A.CometChat.getLoggedInUser().then(function(e){var t=new O.User(e);t.setAuthToken("");var s=JSON.stringify(t);if(E==m.MessageConstatnts.RECEIVER_TYPE.USER){if(T.isFalsy(l.deliveredAt)){var r=d.receiver,o=d.id,n=d.sender,i=m.MessageConstatnts.XMPP_KEYS.TYPE_USER;R.getJidFromUid(n).then(function(e){var t=y.$msg({to:e,from:I.XMPPConnectionHelper.getInstance().connection.jid,id:I.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:i}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=y.Strophe.xmlElement("delivered",{type:i,receiverId:r,xmlns:"urn:xmpp:receipts",id:"["+A.CometChat.getAppId()+"]"+o});t.tree().appendChild(n),I.XMPPConnectionHelper.getInstance().connection.send(t)})}}else if(T.isFalsy(l.myReceipt)){var a=l.receiver,c=d.id,u=m.MessageConstatnts.XMPP_KEYS.TYPE_GROUP;R.getGroupJidFromGUID(a).then(function(e){var t=y.$msg({to:e,from:I.XMPPConnectionHelper.getInstance().connection.jid,id:I.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:u}).c("user",{xmlns:"com.cometchat.models:User"}).t(s).up(),n=y.Strophe.xmlElement("delivered",{type:u,receiverId:a,xmlns:"urn:xmpp:receipts",id:"["+A.CometChat.getAppId()+"]"+c});t.tree().appendChild(n),I.XMPPConnectionHelper.getInstance().connection.send(t)})}})}N.MessageListnerMaping.getInstance().get("all").then(function(e){parseInt(l.id)>e&&N.MessageListnerMaping.getInstance().set("all",parseInt(l.id))},function(e){N.MessageListnerMaping.getInstance().set("all",parseInt(l.id))}),g.affix==m.MessageConstatnts.PAGINATION.AFFIX.APPEND?(g.id<parseInt(l.id)&&0<g.id&&(g.id=parseInt(l.id)),g.timestamp<l.sentAt&&0<g.timestamp&&(g.timestamp=l.sentAt),g.updatedAt<l.updatedAt&&0<g.updatedAt&&(g.updatedAt=l.updatedAt)):(g.id>parseInt(l.id)&&(g.id=parseInt(l.id)),g.timestamp>l.sentAt&&(g.timestamp=l.sentAt),g.updatedAt>l.updatedAt&&(g.updatedAt=l.updatedAt)),g.id&&(g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.ID]=g.id),g.timestamp&&(g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=g.timestamp),g.updatedAt&&(g.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.UPDATED_AT]=g.updatedAt),t.push(f.MessageController.trasformJSONMessge(l))})}else t=[];s(t)},function(e){t(new C.CometChatException(e.error))})}catch(e){t(new C.CometChatException(e))}})},e.prototype.createEndpoint=function(){this.parentMessageId?(this.endpointName="getThreadMessages",this.listId=this.parentMessageId.toString(),this.hideReplies&&(this.hideReplies=!1,delete this.paginationMeta[m.MessageConstatnts.PAGINATION.KEYS.HIDE_REPLIES])):(T.isFalsy(this.guid)||T.isFalsy(this.uid))&&T.isFalsy(this.guid)?(T.isFalsy(this.uid)?this.endpointName="getMessages":this.endpointName="getUserMessages",this.listId=this.uid):(this.endpointName="getGroupMessages",this.listId=this.guid)},e.prototype.makeData=function(){var e={};e[m.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,e[m.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,(T.isFalsy(this.guid)||T.isFalsy(this.uid))&&T.isFalsy(this.guid)&&T.isFalsy(this.uid)},e.prototype.getFilteredPreviousDataByReceiverId=function(t){return s(this,void 0,void 0,function(){var n,s=this;return a(this,function(e){switch(e.label){case 0:switch(n=[],t){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,r.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 2:return e.sent(),[3,9];case 3:return[4,r.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 4:e.sent(),e.label=5;case 5:return[4,r.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).filter(function(e){return t[e].sender.uid==s.uid}).map(function(e){n=n.concat([t[e]])})})];case 6:return e.sent(),[3,9];case 7:return[4,r.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 8:return e.sent(),[3,9];case 9:return[2,n]}})})},e.prototype.getFilteredNextDataByReceiverId=function(t){return s(this,void 0,void 0,function(){var n,s=this;return a(this,function(e){switch(e.label){case 0:switch(n=[],t){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,r.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 2:return e.sent(),[3,9];case 3:return[4,r.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 4:e.sent(),e.label=5;case 5:return[4,r.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).filter(function(e){return t[e].sender.uid==s.uid}).map(function(e){n=n.concat([t[e]])})})];case 6:return e.sent(),[3,9];case 7:return[4,r.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(e){return parseInt(e)>s.id}).map(function(e){n=n.concat([t[e]])})})];case 8:return e.sent(),[3,9];case 9:return[2,n]}})})},e}();t.DefaultMessagesRequest=o;var i=function(){function e(){this.maxLimit=m.DEFAULT_VALUES.MSGS_MAX_LIMIT,this.timestamp=0,this.id=m.DEFAULT_VALUES.DEFAULT_MSG_ID,this.unread=!1,this.HideMessagesFromBlockedUsers=!1,this.onlyUpdate=0,this.HideDeletedMessages=!1}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setGUID=function(e){return this.guid=e,this},e.prototype.setUID=function(e){return this.uid=e,this},e.prototype.setParentMessageId=function(e){return this.parentMessageId=e,this},e.prototype.setTimestamp=function(e){return void 0===e&&(e=T.getCurrentTime()),this.timestamp=e,this},e.prototype.setMessageId=function(e){return void 0===e&&(e=m.DEFAULT_VALUES.DEFAULT_MSG_ID),this.id=e,this},e.prototype.setUnread=function(e){return void 0===e&&(e=!1),this.unread=e,this},e.prototype.hideMessagesFromBlockedUsers=function(e){return void 0===e&&(e=!1),this.HideMessagesFromBlockedUsers=e,this},e.prototype.setSearchKeyword=function(e){return this.searchKey=e,this},e.prototype.setUpdatedAfter=function(e){return this.updatedAt=e,this},e.prototype.updatesOnly=function(e){return e&&(this.onlyUpdate=1),this},e.prototype.setCategory=function(e){return this.category=e,this},e.prototype.setCategories=function(e){return this.categories=e,this},e.prototype.setType=function(e){return this.type=e,this},e.prototype.setTypes=function(e){return this.types=e,this},e.prototype.hideReplies=function(e){return this.HideReplies=e,this},e.prototype.hideDeletedMessages=function(e){return this.HideDeletedMessages=e,this},e.prototype.build=function(){return this.category&&this.categories&&this.categories.push(this.category),this.type&&this.types&&this.types.push(this.type),new o(this)},e}();t.DefaultMessagesRequestBuilder=i},function(e,t,n){"use strict";t.__esModule=!0;var s=function(e){};t.CometChatExtension=s},function(e,t,n){"use strict";t.__esModule=!0;var r=n(5),s=n(1),o=n(8),i=n(2),a=n(0),c=function(){function e(e){this.next_page=1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(e)||(this.limit=e.limit,s.isFalsy(e.searchKeyword)||(this.searchKeyword=e.searchKeyword),s.isFalsy(e.direction)||(this.direction=e.direction))}return e.prototype.validateBlockedUsersBuilder=function(){if(void 0===this.limit)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.METHOD_COMPULSORY),"SET_LIMIT","SET_LIMIT","Set Limit")));if(isNaN(this.limit))return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(this.limit>a.DEFAULT_VALUES.USERS_MAX_LIMIT)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT",a.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<a.DEFAULT_VALUES.ZERO)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","setLimit()")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","setSearchKeyword()")));if(s.isFalsy(this.searchKeyword.trim()))return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(void 0!==this.direction){if(typeof this.direction!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.PARAMETER_MUST_BE_A_STRING),"SET_DIRECTION","SET_DIRECTION","setDirection()")));if(this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BOTH&&this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BLOCKED_BY_ME&&this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.HAS_BLOCKED_ME)return new i.CometChatException(a.UserErrors.INVALID_DIRECTION)}},e.prototype.fetchPrevious=function(){var s=this;return this.fetchingInProgress=!0,new Promise(function(t,n){try{0==s.next_page&&(t([]),s.fetchingInProgress=!1);var e=s.validateBlockedUsersBuilder();if(e instanceof i.CometChatException)return void n(e);if(!s.fetchingInProgress)return r.makeApiCall("blockedUsersList",{},s.getPreData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var n=[];e.data.map(function(e,t){n.push(o.UsersController.trasformJSONUser(e))}),t(n),s.fetchingInProgress=!1}t([]),s.fetchingInProgress=!1},function(e){n(new i.CometChatException(e.error)),s.fetchingInProgress=!1});t([])}catch(e){s.fetchingInProgress=!1,n(new i.CometChatException(e))}})},e.prototype.fetchNext=function(){var s=this;return new Promise(function(n,t){try{if(s.fetchingInProgress)s.fetchingInProgress=!1,n([]);else{s.fetchingInProgress=!0;var e=s.validateBlockedUsersBuilder();if(e instanceof i.CometChatException)return void t(e);r.makeApiCall("blockedUsersList",{},s.getNextData()).then(function(e){if(e.meta&&(s.total_pages=e.meta.pagination.total_pages),0<e.data.length){s.pagination=e.meta.pagination;var t=[];e.data.map(function(e){t.push(o.UsersController.trasformJSONUser(e))}),n(t)}else n([]);s.fetchingInProgress=!1},function(e){s.fetchingInProgress=!1,t(new i.CometChatException(e.error))})}}catch(e){s.fetchingInProgress=!1,t(new i.CometChatException(e))}})},e.prototype.getNextData=function(){var e={};if(e.per_page=this.limit,s.isFalsy(this.direction)||(e.direction=this.direction),s.isFalsy(this.searchKeyword)||(e.searchKey=this.searchKeyword),1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=this.next_page++}return e},e.prototype.getPreData=function(){var e={};return e.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(e.page=--this.next_page),e},e.MAX_LIMIT=2,e.DEFAULT_LIMIT=1,e.directions=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS,e}();t.BlockedUsersRequest=c;var u=function(){function e(){}return e.prototype.setLimit=function(e){return this.limit=e,this},e.prototype.setSearchKeyword=function(e){return this.searchKeyword=e,this},e.prototype.setDirection=function(e){return this.direction=e,this},e.prototype.blockedByMe=function(){return this.direction=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BLOCKED_BY_ME,this},e.prototype.hasBlockedMe=function(){return this.direction=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.HAS_BLOCKED_ME,this},e.prototype.build=function(){return new c(this)},e}();t.BlockedUsersRequestBuilder=u},function(e,t,n){"use strict";t.__esModule=!0;var E=n(7),d=n(0),h=n(8),p=n(16),S=n(27),s=n(3),r=n(2),o=n(1),i=function(){function e(){}return e.processMessage=function(e){try{return E.MessageController.trasformJSONMessge(e)}catch(e){o.Logger.error("CometChatHelper: processMessage",e)}},e.getConversationFromMessage=function(l){return new Promise(function(c,u){try{s.CometChat.getLoggedinUser().then(function(e){if(null!==e){var t=E.MessageController.trasformJSONMessge(l),n=t.receiverType,s=t.conversationId,r=void 0,o=E.MessageController.trasformJSONMessge(l);if(n==d.MessageConstatnts.RECEIVER_TYPE.USER){var i=h.UsersController.trasformJSONUser(t[d.MessageConstatnts.KEYS.SENDER]);r=i.getUid()==e.getUid()?h.UsersController.trasformJSONUser(t[d.MessageConstatnts.KEYS.RECEIVER]):i}else r=p.GroupsController.trasformJSONGroup(t[d.MessageConstatnts.KEYS.RECEIVER]);var a=S.ConversationController.trasformJSONConversation(s,n,o,r,0);c(a)}else u(d.UserErrors.USER_NOT_LOGGED_IN)},function(e){u(new r.CometChatException(e.error))})}catch(e){u(new r.CometChatException(e))}})},e}();t.CometChatHelper=i},function(e,t,n){"use strict";t.__esModule=!0;var s=n(0),r=function(){function e(e){this.sessionID=e.sessionID,this.defaultLayout=e.defaultLayout,this.isAudioOnly=e.isAudioOnly,this.region=e.region,this.user=e.user,this.mode=e.mode,this.domain=e.domain,this.ShowEndCallButton=e.ShowEndCallButton,this.ShowMuteAudioButton=e.ShowMuteAudioButton,this.ShowPauseVideoButton=e.ShowPauseVideoButton,this.ShowScreenShareButton=e.ShowScreenShareButton,this.ShowSwitchModeButton=e.ShowSwitchModeButton,this.StartAudioMuted=e.StartAudioMuted,this.StartVideoMuted=e.StartVideoMuted,this.localizedObject=e.localizedObject,this.analyticsSettings=e.analyticsSettings,this.appId=e.appId,this.customCSS=e.customCSS,this.ShowRecordingButton=e.ShowRecordingButton,this.StartRecordingOnCallStart=e.StartRecordingOnCallStart}return e.prototype.isRecordingButtonEnabled=function(){return this.ShowRecordingButton},e.prototype.shouldStartRecordingOnCallStart=function(){return this.StartRecordingOnCallStart},e.prototype.getCustomCSS=function(){return this.customCSS},e.prototype.getSessionId=function(){return this.sessionID},e.prototype.isAudioOnlyCall=function(){return this.isAudioOnly},e.prototype.getUser=function(){return this.user},e.prototype.getRegion=function(){return this.region},e.prototype.getAppId=function(){return this.appId},e.prototype.getDomain=function(){return this.domain},e.prototype.isDefaultLayoutEnabled=function(){return this.defaultLayout},e.prototype.getMode=function(){return this.mode},e.prototype.getStartWithAudioMuted=function(){return this.StartAudioMuted},e.prototype.getStartWithVideoMuted=function(){return this.StartVideoMuted},e.prototype.isEndCallButtonEnabled=function(){return this.ShowEndCallButton},e.prototype.isMuteAudioButtonEnabled=function(){return this.ShowMuteAudioButton},e.prototype.isPauseVideoButtonEnabled=function(){return this.ShowPauseVideoButton},e.prototype.isScreenShareButtonEnabled=function(){return this.ShowScreenShareButton},e.prototype.isModeButtonEnabled=function(){return this.ShowSwitchModeButton},e.prototype.getLocalizedStringObject=function(){return this.localizedObject},e.prototype.getAnalyticsSettings=function(){return this.analyticsSettings},e}();t.CallSettings=r;var o=function(){function e(){this.defaultLayout=!0,this.isAudioOnly=!1,this.mode=s.CallConstants.CALL_MODE.DEFAULT,this.ShowEndCallButton=!0,this.ShowMuteAudioButton=!0,this.ShowPauseVideoButton=!0,this.ShowScreenShareButton=!0,this.ShowSwitchModeButton=!0,this.StartAudioMuted=!1,this.StartVideoMuted=!1,this.localizedObject={},this.analyticsSettings={},this.ShowRecordingButton=!1,this.StartRecordingOnCallStart=!1}return e.prototype.setSessionID=function(e){return this.sessionID=e,this},e.prototype.enableDefaultLayout=function(e){return this.defaultLayout=e,this},e.prototype.setIsAudioOnlyCall=function(e){return this.isAudioOnly=e,this},e.prototype.setRegion=function(e){return this.region=e,this},e.prototype.setDomain=function(e){return this.domain=e,this},e.prototype.setUser=function(e){return this.user=e,this},e.prototype.setMode=function(e){return this.mode=e,this},e.prototype.showEndCallButton=function(e){return this.ShowEndCallButton=e,this},e.prototype.showMuteAudioButton=function(e){return this.ShowMuteAudioButton=e,this},e.prototype.showPauseVideoButton=function(e){return this.ShowPauseVideoButton=e,this},e.prototype.showScreenShareButton=function(e){return this.ShowScreenShareButton=e,this},e.prototype.showModeButton=function(e){return this.ShowSwitchModeButton=e,this},e.prototype.setLocalizedStringObject=function(e){return this.localizedObject=e,this},e.prototype.setAnalyticsSettings=function(e){return this.analyticsSettings=e,this},e.prototype.setAppId=function(e){return this.appId=e,this},e.prototype.startWithAudioMuted=function(e){return this.StartAudioMuted=e,this},e.prototype.startWithVideoMuted=function(e){return this.StartVideoMuted=e,this},e.prototype.setCustomCSS=function(e){return this.customCSS=e,this},e.prototype.showRecordingButton=function(e){return this.ShowRecordingButton=e,this},e.prototype.startRecordingOnCallStart=function(e){return this.StartRecordingOnCallStart=e,this},e.prototype.build=function(){return new r(this)},e}();t.CallSettingsBuilder=o},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=function(){function e(e){this.avatar="",s.isFalsy(e)||(this.uid=e.toString())}return e.prototype.setUID=function(e){this.uid=e?e.toString():""},e.prototype.getUID=function(){return this.uid.toString()},e.prototype.setName=function(e){this.name=e?e.toString():""},e.prototype.getName=function(){return this.name.toString()},e.prototype.setAvatar=function(e){this.avatar=e?e.toString():""},e.prototype.getAvatar=function(){return this.avatar.toString()},e.prototype.setJWT=function(e){this.jwt=e?e.toString():""},e.prototype.getJWT=function(){return this.jwt.toString()},e.prototype.setResource=function(e){this.resource=e?e.toString():""},e.prototype.getResource=function(){return this.resource.toString()},e}();t.RTCUser=r},function(e,t,n){"use strict";t.__esModule=!0;var s=n(1),r=function(){function e(e){this.id="",this.name="",e&&(s.isFalsy(e.id)||(this.id=e.id),s.isFalsy(e.name)||(this.name=e.name))}return e.prototype.getId=function(){return this.id},e.prototype.getName=function(){return this.name},e}();t.CCExtension=r},function(e,t,n){var i=n(64),a=n(65);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;++o)t[s+o]=r[o];return t||a(r)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var s=new Uint8Array(16);e.exports=function(){return n(s),s}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,s=r;return[s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]]].join("")}},function(e,t,n){function s(e){this.options=e||{locator:{}}}function l(){this.cdata=!1}function E(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function d(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function r(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function h(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var n=this.options,s=new S,r=n.domBuilder||new l,o=n.errorHandler,i=n.locator,a=n.xmlns||{},c=/\/x?html?$/.test(t),u=c?p.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return i&&r.setDocumentLocator(i),s.errorHandler=function(s,e,r){if(!s){if(e instanceof l)return e;s=e}var o={},i=s instanceof Function;function t(t){var n=s[t];!n&&i&&(n=2==s.length?function(e){s(t,e)}:s),o[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+d(r))}||function(){}}return r=r||{},t("warning"),t("error"),t("fatalError"),o}(o,r,i),s.domBuilder=n.domBuilder||r,c&&(a[""]="http://www.w3.org/1999/xhtml"),a.xml=a.xml||"http://www.w3.org/XML/1998/namespace",e&&"string"==typeof e?s.parse(e,a,u):s.errorHandler.error("invalid doc source"),r.doc},l.prototype={startDocument:function(){this.doc=(new a).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,s){var r=this.doc,o=r.createElementNS(e,n||t),i=s.length;h(this,o),this.currentElement=o,this.locator&&E(this.locator,o);for(var a=0;a<i;a++){e=s.getURI(a);var c=s.getValue(a),u=(n=s.getQName(a),r.createAttributeNS(e,n));this.locator&&E(s.getLocator(a),u),u.value=u.nodeValue=c,o.setAttributeNode(u)}},endElement:function(e,t,n){var s=this.currentElement;s.tagName;this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&E(this.locator,n),h(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=r.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&E(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=r.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&E(this.locator,s),h(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var s=this.doc.implementation;if(s&&s.createDocumentType){var r=s.createDocumentType(e,t,n);this.locator&&E(this.locator,r),h(this,r)}},warning:function(e){},error:function(e){},fatalError:function(e){throw new i(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){l.prototype[e]=function(){return null}});var p=n(67),o=n(68),S=o.XMLReader,i=o.ParseError,a=t.DOMImplementation=n(42).DOMImplementation;t.XMLSerializer=n(42).XMLSerializer,t.DOMParser=s,t.__DOMHandler=l},function(e,t){t.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},function(e,t){var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),r=new RegExp("^"+n.source+s.source+"*(?::"+n.source+s.source+"*)?$"),d=0,h=1,p=2,S=3,g=4,C=5,_=6,f=7;function L(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,L)}function o(){}function D(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function U(e,t,s,n,r,o){function i(e,t,n){e in s.attributeNames&&o.fatalError("Attribute "+e+" redefined"),s.addValue(e,t,n)}for(var a,c=++t,u=d;;){var l=e.charAt(c);switch(l){case"=":if(u===h)a=e.slice(t,c),u=S;else{if(u!==p)throw new Error("attribute equal must after attrName");u=S}break;case"'":case'"':if(u===S||u===h){if(u===h&&(o.warning('attribute value must after "="'),a=e.slice(t,c)),t=c+1,!(0<(c=e.indexOf(l,t))))throw new Error("attribute value no end '"+l+"' match");i(a,E=e.slice(t,c).replace(/&#?\w+;/g,r),t-1),u=C}else{if(u!=g)throw new Error('attribute value must after "="');i(a,E=e.slice(t,c).replace(/&#?\w+;/g,r),t),o.warning('attribute "'+a+'" missed start quot('+l+")!!"),t=c+1,u=C}break;case"/":switch(u){case d:s.setTagName(e.slice(t,c));case C:case _:case f:u=f,s.closed=!0;case g:case h:case p:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),u==d&&s.setTagName(e.slice(t,c)),c;case">":switch(u){case d:s.setTagName(e.slice(t,c));case C:case _:case f:break;case g:case h:"/"===(E=e.slice(t,c)).slice(-1)&&(s.closed=!0,E=E.slice(0,-1));case p:u===p&&(E=a),u==g?(o.warning('attribute "'+E+'" missed quot(")!'),i(a,E.replace(/&#?\w+;/g,r),t)):("http://www.w3.org/1999/xhtml"===n[""]&&E.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+E+'" missed value!! "'+E+'" instead!!'),i(E,E,t));break;case S:throw new Error("attribute value missed!!")}return c;case"":l=" ";default:if(l<=" ")switch(u){case d:s.setTagName(e.slice(t,c)),u=_;break;case h:a=e.slice(t,c),u=p;break;case g:var E=e.slice(t,c).replace(/&#?\w+;/g,r);o.warning('attribute "'+E+'" missed quot(")!!'),i(a,E,t);case C:u=_}else switch(u){case p:s.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),i(a,a,t),t=c,u=h;break;case C:o.warning('attribute space is required"'+a+'"!!');case _:u=h,t=c;break;case S:u=g,t=c;break;case f:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function w(e,t,n){for(var s=e.tagName,r=null,o=e.length;o--;){var i=e[o],a=i.qName,c=i.value;if(0<(d=a.indexOf(":")))var u=i.prefix=a.slice(0,d),l=a.slice(d+1),E="xmlns"===u&&l;else u=null,E="xmlns"===(l=a)&&"";i.localName=l,!1!==E&&(null==r&&(r={},T(n,n={})),n[E]=r[E]=c,i.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(E,c))}for(o=e.length;o--;){(u=(i=e[o]).prefix)&&("xml"===u&&(i.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(i.uri=n[u||""]))}var d=s.indexOf(":");l=e.localName=0<d?(u=e.prefix=s.slice(0,d),s.slice(d+1)):(u=null,s);var h=e.uri=n[u||""];if(t.startElement(h,l,s,e),!e.closed)return e.currentNSMap=n,e.localNSMap=r,!0;if(t.endElement(h,l,s),r)for(u in r)t.endPrefixMapping(u)}function b(e,t,n,s,r){if(/^(?:script|textarea)$/i.test(n)){var o=e.indexOf("</"+n+">",t),i=e.substring(t+1,o);if(/[&<]/.test(i))return/^script$/i.test(n)||(i=i.replace(/&#?\w+;/g,s)),r.characters(i,0,i.length),o}return t+1}function G(e,t,n,s){var r=s[n];return null==r&&((r=e.lastIndexOf("</"+n+">"))<t&&(r=e.lastIndexOf("</"+n)),s[n]=r),r<t}function T(e,t){for(var n in e)t[n]=e[n]}function Y(e,t,n,s){switch(e.charAt(t+2)){case"-":return"-"!==e.charAt(t+3)?-1:t<(r=e.indexOf("--\x3e",t+4))?(n.comment(e,t+4,r-t-4),r+3):(s.error("Unclosed comment"),-1);default:if("CDATA["==e.substr(t+3,6)){var r=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,r-t-9),n.endCDATA(),r+3}var o=function(e,t){var n,s=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=t,r.exec(e);for(;n=r.exec(e);)if(s.push(n),n[1])return s}(e,t),i=o.length;if(1<i&&/!doctype/i.test(o[0][0])){var a=o[1][0],c=!1,u=!1;3<i&&(/^public$/i.test(o[2][0])?(c=o[3][0],u=4<i&&o[4][0]):/^system$/i.test(o[2][0])&&(u=o[3][0]));var l=o[i-1];return n.startDTD(a,c,u),n.endDTD(),l.index+l[0].length}}return-1}function x(e,t,n){var s=e.indexOf("?>",t);if(s){var r=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return n.processingInstruction(r[1],r[2]),s+2}return-1}return-1}function F(){this.attributeNames={}}(L.prototype=new Error).name=L.name,o.prototype={parse:function(e,t,n){var s=this.domBuilder;s.startDocument(),T(t,t={}),function(n,e,s,r,o){function i(e){var t=e.slice(1,-1);return t in s?s[t]:"#"===t.charAt(0)?function(e){{if(65535<e){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}}(parseInt(t.substr(1).replace("x","0x"))):(o.error("entity not found:"+e),e)}function t(e){if(p<e){var t=n.substring(p,e).replace(/&#?\w+;/g,i);E&&a(p),r.characters(t,0,e-p),p=e}}function a(e,t){for(;u<=e&&(t=l.exec(n));)c=t.index,u=c+t[0].length,E.lineNumber++;E.columnNumber=e-c+1}var c=0,u=0,l=/.*(?:\r\n?|\n)|.*$/g,E=r.locator,d=[{currentNSMap:e}],h={},p=0;for(;;){try{var S=n.indexOf("<",p);if(S<0){if(!n.substr(p).match(/^\s*$/)){var g=r.doc,C=g.createTextNode(n.substr(p));g.appendChild(C),r.currentElement=C}return}switch(p<S&&t(S),n.charAt(S+1)){case"/":var _=n.indexOf(">",S+3),f=n.substring(S+2,_),T=d.pop();_<0?(f=n.substring(S+2).replace(/[\s<].*/,""),o.error("end tag name: "+f+" is not complete:"+T.tagName),_=S+1+f.length):f.match(/\s</)&&(f=f.replace(/[\s<].*/,""),o.error("end tag name: "+f+" maybe not complete"),_=S+1+f.length);var m=T.localNSMap,A=T.tagName==f,I=A||T.tagName&&T.tagName.toLowerCase()==f.toLowerCase();if(I){if(r.endElement(T.uri,T.localName,f),m)for(var R in m)r.endPrefixMapping(R);A||o.fatalError("end tag name: "+f+" is not match the current start tagName:"+T.tagName)}else d.push(T);_++;break;case"?":E&&a(S),_=x(n,S,r);break;case"!":E&&a(S),_=Y(n,S,r,o);break;default:E&&a(S);var N=new F,O=d[d.length-1].currentNSMap,_=U(n,S,N,O,i,o),y=N.length;if(!N.closed&&G(n,_,N.tagName,h)&&(N.closed=!0,s.nbsp||o.warning("unclosed xml attribute")),E&&y){for(var P=D(E,{}),M=0;M<y;M++){var v=N[M];a(v.offset),v.locator=D(E,{})}r.locator=P,w(N,r,O)&&d.push(N),r.locator=E}else w(N,r,O)&&d.push(N);"http://www.w3.org/1999/xhtml"!==N.uri||N.closed?_++:_=b(n,_,N.tagName,i,r)}}catch(e){if(e instanceof L)throw e;o.error("element parse error: "+e),_=-1}p<_?p=_:t(Math.max(S,p)+1)}}(e,t,n,s,this.errorHandler),s.endDocument()}},F.prototype={setTagName:function(e){if(!r.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!r.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=o,t.ParseError=L}])});